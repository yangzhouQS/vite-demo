/**
 * vite-demo v0.0.0
 * Copyright 2021-2022 yangzhou6688
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t="undefined"==typeof window||void 0===window.window;let e,o;const n={get find(){return e||(e=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const o=n.findIndex(t,e);return o>=0?t[o]:void 0},e)},get findIndex(){return o||(o=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:o}=t;for(let n=0;n<o;n++){if(e(t[n],n,t))return n}return-1},o)}};const{IE:r,Chrome:s,Firefox:i,Edge:l,Safari:c}=function(){if(t)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};{const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}}();function a(t,e){for(const o in t)e(t[o],o,t)}function h(t,e){const o=[],n={};for(const r in t)o.push(r),Object.defineProperty(n,r,{get(){const o=t[r];return void 0===o?e[r]:o},set(e){t[r]=e},configurable:!0,enumerable:!0});for(const r in e)o.indexOf(r)>=0||Object.defineProperty(n,r,{get(){const o=t[r];return void 0===o?e[r]:o},set(e){t[r]=e},configurable:!0,enumerable:!0});return n}function u(...t){const e={};return t.forEach((t=>{for(const o in t)Object.defineProperty(e,o,{get:()=>t[o],set(e){t[o]=e},configurable:!0,enumerable:!0})})),e}function d(t,e){for(;e.parentElement;){const o=e.parentElement;if(t===o)return!0;e=o}return!1}function g(t,e,...o){let n=t;for(let t=0;t<o.length&&null!=n;t++)n=e(n,o[t]);return n}function f(t,...e){return g(t,((t,e)=>t[e]),...e)}function _(t,...e){return"function"==typeof t?t(...e):t}function C(t){return Boolean(t&&"function"==typeof t.then)}function p(t,e){return C(t)?t.then((t=>e(t))):e(t)}function w(t,e){return t.col===e.col&&t.row===e.row}function m(t,e,o){return t.start.col<=e&&e<=t.end.col&&t.start.row<=o&&o<=t.end.row}const y=r,b=l,x=s?16777216:i?17895588:10737433,v={setReadonly:function(t,e,o){Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:o})},isObject:function(t){return t===Object(t)}},E={endsWith:function(t,e,o){const n=t.toString();("number"!=typeof o||!isFinite(o)||Math.floor(o)!==o||o>n.length)&&(o=n.length),o-=e.length;const r=n.lastIndexOf(e,o);return-1!==r&&r===o},genChars:function(t){const e=/([\uD800-\uDBFF][\uDC00-\uDFFF]|\r\n|[^\uD800-\uDFFF])([\u180B-\u180D]|[\uFE00-\uFE0F]|\uDB40[\uDD00-\uDDEF])?/g;return{next(){const o=e.exec(t);return null!==o?o[0]:null}}},genWords:function(t){const e=/[!-~]+|[^!-~\s]+|\s+/g;return{next(){const o=e.exec(t);return null!==o?o[0]:null}}}},L={getMouseButtons:function(t){return null!=t.buttons?t.buttons:null!=t.which?3===t.which||2===t.which?4:t.which:0===t.button||1===t.button?1:2===t.button?2:0},getKeyCode:function(t){return t.keyCode||t.which},isTouchEvent:function(t){return!!t.changedTouches},cancel:function(t){t.preventDefault(),t.stopPropagation()}},R={toBoxArray:function(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:t:[t,t,t,t]}},B=Function.prototype,I={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",DBLTAP_CELL:"dbltap_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",KEYDOWN:"keydown",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",MOUSEOVER_CELL:"mouseover_cell",MOUSEOUT_CELL:"mouseout_cell",TOUCHSTART_CELL:"touchstart_cell",CONTEXTMENU_CELL:"contextmenu_cell",INPUT_CELL:"input_cell",PASTE_CELL:"paste_cell",DELETE_CELL:"delete_cell",EDITABLEINPUT_CELL:"editableinput_cell",MODIFY_STATUS_EDITABLEINPUT_CELL:"modify_status_editableinput_cell",RESIZE_COLUMN:"resize_column",SCROLL:"scroll",FOCUS_GRID:"focus_grid",BLUR_GRID:"blur_grid"};function S(t,e,{action:o,mouseOver:n,mouseOut:r}){function s(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(I.CLICK_CELL,(e=>{s(e.col,e.row)&&(C(t.getRowRecord(e.row))||o({col:e.col,row:e.row}))})),t.listen(I.MOUSEOVER_CELL,(e=>{s(e.col,e.row)&&(C(t.getRowRecord(e.row))||n&&!n({col:e.col,row:e.row})||(t.getElement().style.cursor="pointer"))})),t.listen(I.MOUSEOUT_CELL,(e=>{s(e.col,e.row)&&(r&&r({col:e.col,row:e.row}),t.getElement().style.cursor="")}))]}function T(t,e,{action:o,acceptKeys:n=[]}){return n=[...n,13,32],[t.listen(I.KEYDOWN,(r=>{if(-1===n.indexOf(r.keyCode))return;if(t.keyboardOptions?.moveCellOnEnter&&13===r.keyCode)return;const s=t.selection.select;var i,l;(i=s.col,l=s.row,t.getLayoutCellId(i,l)===e)&&(C(t.getRowRecord(s.row))||(o({col:s.col,row:s.row}),L.cancel(r.event)))}))]}class k{_disabled;constructor(t={}){this._disabled=t.disabled||!1}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.onChangeDisabledInternal()}onChangeDisabledInternal(){}}function A(t,e,o){return!!e.disabled||D(t,e,o)}function O(t,e,o){return!!e.readOnly||D(t,e,o)}function M(t){if("number"==typeof t)return 0===t?1:0;if("string"==typeof t){if("false"===t)return"true";if("off"===t)return"on";if(/^0+$/.exec(t))return t.replace(/^(0*)0$/,"$11");if("true"===t)return"false";if("on"===t)return"off";if(/^0*1$/.exec(t))return t.replace(/^(0*)1$/,"$10")}return!t}function D(t,e,o){if("function"==typeof t){const n=e.getRowRecord(o);return!!C(n)||!!t(n)}return!!t}class F extends k{_action;constructor(t={}){super(t),this._action=t.action||(()=>{})}get editable(){return!1}get action(){return this._action}set action(t){this._action=t}clone(){return new F(this)}getState(t){return{}}bindGridEvent(t,e){const o=this.getState(t),n=e=>{if(A(this.disabled,t,e.row))return;const o=t.getRowRecord(e.row);this._action(o,u(e,{grid:t}))};return[...S(t,e,{action:n,mouseOver:e=>{if(A(this.disabled,t,e.row))return!1;o.mouseActiveCell={col:e.col,row:e.row};const n=t.getCellRange(e.col,e.row);return t.invalidateCellRange(n),!0},mouseOut:e=>{delete o.mouseActiveCell;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),...T(t,e,{action:n})]}onPasteCellRangeBox(){}onDeleteCellRangeBox(){}}const W=t?global.Symbol:window.Symbol?window.Symbol:(()=>{function t(){const t="abcdefghijklmnopqrstuvwxyz0123456789",e=t.length;let o="";for(let n=0;n<10;n++)o+=t[Math.floor(Math.random()*e)];return o}return e=>e?`#${e}_${t()}`:`#_${t()}`})(),P={};function H(t){return t?P[t]?P[t]:P[t]=W(t):W()}function z(){return H("protected")}function V(){return H("chkcol.stateID")}function $(){return H("rdcol.stateID")}function N(){return H("btncol.stateID")}function U(){return H("check_header.stateID")}const j=N();class K extends k{_readOnly;constructor(t={}){super(t),this._readOnly=t.readOnly||!1}get editable(){return!0}get readOnly(){return this._readOnly}set readOnly(t){this._readOnly=t,this.onChangeReadOnlyInternal()}onChangeReadOnlyInternal(){}}function G(t,e,o,n){let r;return t*=3,e*=3,o*=3,n*=3,function(s){let i,l,c,a,h,u,d;if(s<0||1<s)throw new Error(`${s}`);i=r||s;do{l=1-i,c=l*l,a=i*i,h=a*i,u=t*c*i+o*l*a+h,d=s-u,i+=.5*d}while(1e-4<Math.abs(d));return r=i,e*c*i+n*l*a+h}}const Y={linear:t=>t,easeIn:G(.42,0,1,1),easeOut:G(0,0,.58,1),easeInOut:G(.42,0,.58,1)},q=t?()=>{}:window.requestAnimationFrame||(t=>setTimeout(t,1));function X(){return Date.now()}function J(t,e,o){const n=X(),r=null==o?Y.easeInOut:"string"==typeof o?Y[o]:o;let s=!1;const i=(o,i)=>{const l=()=>{const c=X()-n;s?i&&i():c>=t?(e(1),o&&o()):(e(r(c/t)),q(l))};return l},l=()=>{s=!0};if("undefined"!=typeof Promise){const t=new Promise(((t,o)=>{const n=i(t,o);e(0),n()}));return t.cancel=l,t}{const t=i((()=>{}),(()=>{}));return e(0),t(),{cancel:l}}}const Z=V();class Q extends K{clone(){return new Q(this)}bindGridEvent(t,e){let o=t[Z];o||(o={block:{},elapsed:{}},v.setReadonly(t,Z,o));const n=o,r=e=>{const o=t.getCellRange(e.col,e.row),r=`${o.start.col}:${o.start.row}`;if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||n.block[r])return;const s=t.doChangeValue(e.col,e.row,M);if(s){const e=()=>{J(200,(e=>{1===e?delete n.elapsed[r]:n.elapsed[r]=e,t.invalidateCellRange(o)}))};C(s)?(n.block[r]=!0,s.then((()=>{delete n.block[r],e()}))):e()}};function s(o,n){return t.getLayoutCellId(o,n)===e}return[...S(t,e,{action:r,mouseOver:e=>{if(A(this.disabled,t,e.row))return!1;n.mouseActiveCell={col:e.col,row:e.row};const o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:e=>{delete n.mouseActiveCell;const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)}}),...T(t,e,{action:e=>{const o=t.selection.range,{col:n}=t.selection.select;for(let{row:t}=o.start;t<=o.end.row;t++)s(n,t)&&r({col:n,row:t})}}),t.listen(I.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;if(!w(o.start,o.end))return;if(!s(e.col,e.row))return;L.cancel(e.event);const n=e.normalizeValue.trim();t.doGetCellValue(e.col,e.row,(o=>{if(`${M(o)}`.trim()===n)r({col:e.col,row:e.row});else if(tt(o,n)){const o=t.getRowRecord(e.row);C(o)||t.fireListeners("rejected_paste_values",{detail:[{col:e.col,row:e.row,record:o,define:t.getColumnDefine(e.col,e.row),pasteValue:n}]})}}))}))]}onPasteCellRangeBox(t,e,o,n){if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row))return;const r=o.trim();t.doGetCellValue(e.col,e.row,(o=>{`${M(o)}`.trim()===r?t.doChangeValue(e.col,e.row,M):tt(o,r)&&n.reject()}))}onDeleteCellRangeBox(){}}function tt(t,e){if((null!=t?`${t}`.trim():"")===e)return!1;const o=M(t);return`${o}`.trim()!==e&&`${M(o)}`.trim()!==e}class et extends K{constructor(t={}){super(t)}bindGridEvent(t,e){const o=e=>!O(this.readOnly,t,e.row)&&!A(this.disabled,t,e.row)&&(this.onOpenCellInternal(t,e),!0),n=(e,o)=>{O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||this.onInputCellInternal(t,e,o)};function r(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(I.INPUT_CELL,(t=>{r(t.col,t.row)&&n({col:t.col,row:t.row},t.value)})),t.listen(I.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;w(o.start,o.end)&&r(e.col,e.row)&&(L.cancel(e.event),n({col:e.col,row:e.row},e.normalizeValue))})),t.listen(I.DBLCLICK_CELL,(t=>{r(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(I.DBLTAP_CELL,(t=>{r(t.col,t.row)&&(o({col:t.col,row:t.row}),L.cancel(t.event))})),t.listen(I.KEYDOWN,(e=>{if(113!==e.keyCode&&13!==e.keyCode)return;const n=t.selection.select;r(n.col,n.row)&&o({col:n.col,row:n.row})&&e.stopCellMoving()})),t.listen(I.SELECTED_CELL,(e=>{this.onChangeSelectCellInternal(t,{col:e.col,row:e.row},e.selected)})),t.listen(I.SCROLL,(()=>{this.onGridScrollInternal(t)})),t.listen(I.EDITABLEINPUT_CELL,(e=>!!r(e.col,e.row)&&(!O(this.readOnly,t,e.row)&&!A(this.disabled,t,e.row)))),t.listen(I.MODIFY_STATUS_EDITABLEINPUT_CELL,(e=>{if(!r(e.col,e.row))return;if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row))return;const o=t.getCellRange(e.col,e.row);if(o.start.col!==o.end.col||o.start.row!==o.end.row){const{input:n}=e,r=t.getCellRect(e.col,e.row),s=t.getCellRangeRect(o);n.style.top=`${(parseFloat(n.style.top)+(s.top-r.top)).toFixed()}px`,n.style.left=`${(parseFloat(n.style.left)+(s.left-r.left)).toFixed()}px`,n.style.width=`${s.width.toFixed()}px`,n.style.height=`${s.height.toFixed()}px`}this.onSetInputAttrsInternal(t,{col:e.col,row:e.row},e.input)}))]}onPasteCellRangeBox(t,e,o){O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(()=>this.isSupportMultilineValue()?o:o.replace(/\r?\n/g," ")))}onDeleteCellRangeBox(t,e){O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(()=>""))}isSupportMultilineValue(){return!1}}let ot=1;class nt{_listeners={};on(t,e,o,...n){t.addEventListener&&t.addEventListener(e,o,...n);const r={target:t,type:e,listener:o,options:n},s=ot++;return this._listeners[s]=r,s}once(t,e,o,...n){const r=this.on(t,e,((...t)=>{this.off(r),o(...t)}),...n);return r}tryWithOffEvents(t,e,o){const n=[];try{a(this._listeners,(o=>{o.target===t&&o.type===e&&(o.target.removeEventListener&&o.target.removeEventListener(o.type,o.listener,...o.options),n.push(o))})),o()}finally{n.forEach((t=>{t.target.addEventListener&&t.target.addEventListener(t.type,t.listener,...t.options)}))}}off(t){if(null==t)return;const e=this._listeners[t];e&&(delete this._listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...o){a(this._listeners,(n=>{n.target===t&&n.type===e&&n.listener.call(n.target,...o)}))}hasListener(t,e){let o=!1;return a(this._listeners,(n=>{n.target===t&&n.type===e&&(o=!0)})),o}clear(){a(this._listeners,(t=>{t.target.removeEventListener&&t.target.removeEventListener(t.type,t.listener,...t.options)})),this._listeners={}}dispose(){this.clear(),this._listeners=null}}function rt(t,{classList:e,text:o,html:n}={}){const r=document.createElement(t);return e&&(Array.isArray(e)?r.classList.add(...e):r.classList.add(e)),o?r.textContent=o:n&&(r.innerHTML=n),r}function st(t){if(Array.isArray(t)){const e=[];return t.forEach((t=>{e.push(...st(t))})),e}const e=function(t){if(function(t){return!(!t.nodeType||!t.nodeName)}(t))return t;const e=rt("div",{html:t});return Array.prototype.slice.call(e.childNodes)}(t);return Array.isArray(e)?e:[e]}function it(t){t.dataset.disableBeforeTabIndex=`${t.tabIndex}`,t.tabIndex=-1,Array.prototype.slice.call(t.children,0).forEach(it)}function lt(t){return null!=t.tabIndex&&t.tabIndex>-1}function ct(t){let e=t.previousSibling;for(;e&&!lt(e);)e=e.previousSibling;return e}function at(t){let e=t.nextSibling;for(;e&&!lt(e);)e=e.nextSibling;return e}function ht(t,e){if("number"===t.type&&"-"===e){t.type="";let e=new nt;const o=()=>{e&&(e.dispose(),e=null)};e.once(t,"input",(e=>{t.type="number",o()})),e.once(t,"blur",(t=>{o()}))}t.value=e??""}function ut(t,e,o){const{classList:n,type:r}=t;n&&o.classList.add(...n),o.type=r||""}class dt{_handler;_input;_beforePropEditor;_activeData;_attaching;static setInputAttrs(t,e,o){ut(t,0,o)}constructor(){this._handler=new nt,this._input=(require("@/columns/action/internal/InlineInputElement.css"),rt("input",{classList:"cheetah-grid__inline-input"})),this._bindInputEvents()}dispose(){const t=this._input;this.detach(),this._handler.dispose(),delete this._input,this._beforePropEditor=null,t.parentElement?.removeChild(t)}attach(t,e,o,n,r){const s=this._input,i=this._handler;if(this._beforePropEditor){const{classList:t}=this._beforePropEditor;t&&s.classList.remove(...t)}s.style.font=t.font||"16px sans-serif";const{element:l,rect:c}=t.getAttachCellsArea(t.getCellRange(o,n));s.style.top=`${c.top.toFixed()}px`,s.style.left=`${c.left.toFixed()}px`,s.style.width=`${c.width.toFixed()}px`,s.style.height=`${c.height.toFixed()}px`,l.appendChild(s),ut(e,0,s),ht(s,r),this._activeData={grid:t,col:o,row:n,editor:e},this._beforePropEditor=e;i.tryWithOffEvents(s,"blur",(()=>{(()=>{s.focus();const t=s.value.length;try{if(void 0!==s.selectionStart)return s.selectionStart=t,void(s.selectionEnd=t)}catch(t){}if(document.selection){const e=s.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}})()})),this._attaching=!0,setTimeout((()=>{delete this._attaching}))}detach(t){if(this._isActive()){const{grid:e,col:o,row:n}=this._activeData,r=this._input;this._handler.tryWithOffEvents(r,"blur",(()=>{r.parentElement?.removeChild(r)}));const s=e.getCellRange(o,n);e.invalidateCellRange(s),t&&e.focus()}this._activeData=null}doChangeValue(){if(!this._isActive())return;const t=this._input,{value:e}=t,{grid:o,col:n,row:r}=this._activeData;o.doChangeValue(n,r,(()=>e))}_isActive(){const t=this._input;return!(!t||!t.parentElement)&&!!this._activeData}_bindInputEvents(){const t=this._handler,e=this._input,o=t=>t.stopPropagation();t.on(e,"click",o),t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"compositionstart",(t=>{e.classList.add("composition")})),t.on(e,"compositionend",(t=>{e.classList.remove("composition")})),t.on(e,"keydown",(t=>{if(e.classList.contains("composition"))return;const o=L.getKeyCode(t);13===o?this._onKeydownEnter(t):9===o&&this._onKeydownTab(t)})),t.on(e,"blur",(t=>{this.doChangeValue(),this.detach()}))}_onKeydownEnter(t){if(!this._isActive()||this._attaching)return;const{grid:e}=this._activeData;this.doChangeValue(),this.detach(!0),L.cancel(t),e.keyboardOptions?.moveCellOnEnter&&e.onKeyDownMove(t)}_onKeydownTab(t){if(!this._isActive())return;const{grid:e}=this._activeData;e.keyboardOptions?.moveCellOnTab&&(this.doChangeValue(),this.detach(!0),e.onKeyDownMove(t))}}const gt=H("inline_input_editor.stateID");let ft=null,_t=0;function Ct(t,e,o,n){const r=function(t){let e=t[gt];return e||(e={},v.setReadonly(t,gt,e)),e}(t);ft||(ft=new dt),r.element||(r.element=ft,_t++,t.addDisposable({dispose(){_t--,_t||(ft?.dispose(),ft=null,r.element=null)}})),ft.attach(t,o,e.col,e.row,n)}function pt(t){ft&&ft.detach(t)}function wt(t){ft&&ft.doChangeValue()}class mt extends et{_classList;_type;constructor(t={}){super(t),this._classList=t.classList,this._type=t.type}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get type(){return this._type}set type(t){this._type=t}clone(){return new mt(this)}onInputCellInternal(t,e,o){Ct(t,e,this,o)}onOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{Ct(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){wt(),pt()}onGridScrollInternal(t){wt(),pt(!0)}onChangeDisabledInternal(){pt(!0)}onChangeReadOnlyInternal(){pt(!0)}onSetInputAttrsInternal(t,e,o){dt.setInputAttrs(this,t,o)}}const yt="cheetah-grid__inline-menu",bt=`${yt}__menu-item`,xt=`${yt}--hidden`,vt=`${yt}--shown`,Et=`${bt}--empty`;function Lt(t){let e=t;for(;e&&!e.classList.contains(bt);)if(e=e.parentElement,!e||e.classList.contains(yt))return null;return e}function Rt(t,e,o){o.style.top=`${e.top.toFixed()}px`,o.style.left=`${e.left.toFixed()}px`,o.style.width=`${e.width.toFixed()}px`,o.style.lineHeight=`${e.height.toFixed()}px`,t.appendChild(o)}function Bt({classList:t,label:e,value:o,html:n},r){const s=rt("li",{classList:bt});if(s.tabIndex=0,s.dataset.valueindex=`${r}`,t&&s.classList.add(...Array.isArray(t)?t:[t]),e){const t=rt("span",{text:e});s.appendChild(t)}else n&&(i=s,st(n).forEach((t=>{i.appendChild(t)})));var i;return""!==o&&null!=o||s.classList.add(Et),s}class It{_handler;_menu;_beforePropEditor;_activeData;constructor(){this._handler=new nt,this._menu=(require("@/columns/action/internal/InlineMenuElement.css"),rt("ul",{classList:yt})),this._bindMenuEvents()}dispose(){const t=this._menu;this.detach(),this._handler.dispose(),delete this._menu,this._beforePropEditor=null,t.parentElement?.removeChild(t)}attach(t,e,o,n,r,s){const i=this._menu;if(this._beforePropEditor){const{classList:t}=this._beforePropEditor;t&&i.classList.remove(...t)}const l=e.options(s);!function(t,e,o,n,r,s,i){const{classList:l}=e;i.classList.remove(vt),i.classList.add(xt),function(t){let e;for(;e=t.firstChild;)t.removeChild(e)}(i),i.style.font=t.font||"16px sans-serif";let c=null,a=null;s.forEach(((t,e)=>{const o=Bt(t,e);i.appendChild(o),t.value===r&&(a=o,o.dataset.select="select"),o.classList.contains(Et)&&(c=o)}));const h=a||c||i.children[0];l&&i.classList.add(...l);const u=Array.prototype.slice.call(i.children,0),d=u.indexOf(h),{element:g,rect:f}=t.getAttachCellsArea(t.getCellRange(o,n));f.width++,Rt(g,f,i);let _=0,C=0;for(let t=0;t<u.length;t++){const{offsetHeight:e}=u[t];t<d&&(_+=e),C+=e}f.offsetTop(-_),i.style.transformOrigin=`center ${_+Math.ceil(u[d].offsetHeight/2)}px 0px`,Rt(g,f,i);const p=i.getBoundingClientRect(),w=(C-p.height)/2,m=p.top-w;let y=m;const b=y+C,x=window.innerHeight;b>x-20&&(y-=b-x+20);y<20&&(y=20),y!==m&&(f.offsetTop(-(m-y)),Rt(g,f,i)),h&&h.focus(),i.classList.remove(xt),i.classList.add(vt)}(t,e,o,n,r,l,i),this._activeData={grid:t,col:o,row:n,editor:e,options:l},this._beforePropEditor=e}detach(t){if(this._isActive()){const{grid:e,col:o,row:n}=this._activeData;!function(t,e,o,n){n.classList.remove(vt),n.classList.add(xt),it(n)}(0,0,0,this._menu);const r=e.getCellRange(o,n);e.invalidateCellRange(r),t&&e.focus()}this._activeData=null}_doChangeValue(t){if(!this._isActive())return;const{grid:e,col:o,row:n,options:r}=this._activeData,s=r[Number(t)];if(s){const{value:t}=s;e.doChangeValue(o,n,(()=>t))}}_isActive(){const t=this._menu;return!(!t||!t.parentElement)&&!!this._activeData}_bindMenuEvents(){const t=this._handler,e=this._menu,o=t=>t.stopPropagation();t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"click",(t=>{t.stopPropagation();const e=Lt(t.target);if(!e)return;const{valueindex:o}=e.dataset;this._doChangeValue(o||""),this.detach(!0)})),t.on(e,"keydown",(t=>{const o=Lt(t.target);if(!o)return;const n=L.getKeyCode(t);if(13===n)this._onKeydownEnter(e,o,t);else if(27===n)this.detach(!0),L.cancel(t);else if(38===n){const e=ct(o);e&&(e.focus(),L.cancel(t))}else if(40===n){const e=at(o);e&&(e.focus(),L.cancel(t))}else 9===n&&this._onKeydownTab(e,o,t)}))}_onKeydownEnter(t,e,o){const n=this._isActive()?this._activeData.grid:null,{valueindex:r}=e.dataset;this._doChangeValue(r||""),this.detach(!0),L.cancel(o),n&&n.keyboardOptions?.moveCellOnEnter&&n.onKeyDownMove(o)}_onKeydownTab(t,e,o){if(this._isActive()){const{grid:t}=this._activeData;if(t.keyboardOptions?.moveCellOnTab){const{valueindex:n}=e.dataset;return this._doChangeValue(n||""),this.detach(!0),void t.onKeyDownMove(o)}}if(o.shiftKey){if(!ct(e)){const e=t.querySelectorAll(`.${bt}`);let n=e[e.length-1];lt(n)||(n=ct(n)),n&&(n.focus(),L.cancel(o))}}else if(!at(e)){let e=t.querySelector(`.${bt}`);lt(e)||(e=at(e)),e&&(e.focus(),L.cancel(o))}}}const St=H();let Tt=1;class kt{[St]={listeners:{},listenerData:{}};listen(t,e){const o=this[St].listeners[t]||(this[St].listeners[t]=[]);o.push(e);const n=Tt++;return this[St].listenerData[n]={type:t,listener:e,remove:()=>{delete this[St].listenerData[n];const r=o.indexOf(e);o.splice(r,1),this[St].listeners[t].length||delete this[St].listeners[t]}},n}unlisten(t){this[St]&&this[St].listenerData[t].remove()}addEventListener(t,e){this.listen(t,e)}removeEventListener(t,e){this[St]&&a(this[St].listenerData,((o,n)=>{o.type===t&&o.listener===e&&this.unlisten(n)}))}hasListeners(t){return!!this[St]&&!!this[St].listeners[t]}fireListeners(t,...e){if(!this[St])return[];const o=this[St].listeners[t];return o?o.map((t=>t.call(this,...e))).filter((t=>null!=t)):[]}dispose(){delete this[St]}}const At={CHANGE_STYLE:"change_style"};let Ot,Mt,Dt,Ft,Wt,Pt,Ht,zt,Vt,$t,Nt;class Ut extends kt{_bgColor;static get EVENT_TYPE(){return At}static get DEFAULT(){return Ot||(Ot=new Ut)}constructor({bgColor:t}={}){super(),this._bgColor=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this.doChangeStyle()}doChangeStyle(){this.fireListeners(At.CHANGE_STYLE)}clone(){return new Ut(this)}}class jt extends Ut{_textAlign;_textBaseline;static get DEFAULT(){return Mt||(Mt=new jt)}constructor(t={}){super(t),this._textAlign=t.textAlign||"left",this._textBaseline=t.textBaseline||"middle"}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t,this.doChangeStyle()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.doChangeStyle()}clone(){return new jt(this)}}class Kt extends jt{_color;_font;_padding;_textOverflow;static get DEFAULT(){return Dt||(Dt=new Kt)}constructor(t={}){super(t),this._color=t.color,this._font=t.font,this._padding=t.padding,this._textOverflow=t.textOverflow||"clip"}get color(){return this._color}set color(t){this._color=t,this.doChangeStyle()}get font(){return this._font}set font(t){this._font=t,this.doChangeStyle()}get padding(){return this._padding}set padding(t){this._padding=t,this.doChangeStyle()}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t,this.doChangeStyle()}clone(){return new Kt(this)}}class Gt extends Kt{_buttonBgColor;static get DEFAULT(){return Ft||(Ft=new Gt)}constructor(t={}){super(h(t,{textAlign:"center"}));const{buttonBgColor:e}=t;this._buttonBgColor=e}get buttonBgColor(){return this._buttonBgColor}set buttonBgColor(t){this._buttonBgColor=t,this.doChangeStyle()}clone(){return new Gt(this)}}class Yt extends jt{_uncheckBgColor;_checkBgColor;_borderColor;static get DEFAULT(){return Wt||(Wt=new Yt)}constructor(t={}){super(h(t,{textAlign:"center"}));const{uncheckBgColor:e,checkBgColor:o,borderColor:n}=t;this._uncheckBgColor=e,this._checkBgColor=o,this._borderColor=n}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.doChangeStyle()}clone(){return new Yt(this)}}class qt extends Kt{static get DEFAULT(){return Pt||(Pt=new qt)}constructor(t={}){super(h(t,{textAlign:"center"}))}clone(){return new qt(this)}}class Xt extends jt{_imageSizing;_margin;static get DEFAULT(){return Ht||(Ht=new Xt)}constructor(t={}){super(h(t,{textAlign:"center"})),this._imageSizing=t.imageSizing,this._margin=t.margin||4}get imageSizing(){return this._imageSizing}set imageSizing(t){this._imageSizing=t,this.doChangeStyle()}get margin(){return this._margin}set margin(t){this._margin=t,this.doChangeStyle()}clone(){return new Xt(this)}}class Jt extends Kt{_appearance;static get DEFAULT(){return zt||(zt=new Jt)}constructor(t={}){super(t);const{appearance:e}=t;this._appearance=e}get appearance(){return this._appearance||"menulist-button"}set appearance(t){this._appearance=t,this.doChangeStyle()}clone(){return new Jt(this)}}class Zt extends Kt{_lineHeight;_autoWrapText;_lineClamp;static get DEFAULT(){return Vt||(Vt=new Zt)}constructor(t={}){super(h(t,{textBaseline:"top"})),this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp}clone(){return new Zt(this)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}}class Qt extends Kt{static get DEFAULT(){return $t||($t=new Qt)}constructor(t={}){super(h(t,{textAlign:"right"}))}clone(){return new Qt(this)}}const te=t=>t>80?"#20a8d8":t>50?"#4dbd74":t>20?"#ffc107":"#f86c6b";class ee extends Kt{_barColor;_barBgColor;_barHeight;static get DEFAULT(){return Nt||(Nt=new ee)}constructor(t={}){super(t),this._barColor=t.barColor||te,this._barBgColor=t.barBgColor||"#f0f3f5",this._barHeight=t.barHeight||3}get barColor(){return this._barColor}set barColor(t){this._barColor=t,this.doChangeStyle()}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t,this.doChangeStyle()}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t,this.doChangeStyle()}clone(){return new ee(this)}}let oe;class ne extends jt{_checkColor;_uncheckBorderColor;_checkBorderColor;_uncheckBgColor;_checkBgColor;static get DEFAULT(){return oe||(oe=new ne)}constructor(t={}){super(h(t,{textAlign:"center"}));const{checkColor:e,uncheckBorderColor:o,checkBorderColor:n,uncheckBgColor:r,checkBgColor:s}=t;this._checkColor=e,this._uncheckBorderColor=o,this._checkBorderColor=n,this._uncheckBgColor=r,this._checkBgColor=s}get checkColor(){return this._checkColor}set checkColor(t){this._checkColor=t,this.doChangeStyle()}get uncheckBorderColor(){return this._uncheckBorderColor}set uncheckBorderColor(t){this._uncheckBorderColor=t,this.doChangeStyle()}get checkBorderColor(){return this._checkBorderColor}set checkBorderColor(t){this._checkBorderColor=t,this.doChangeStyle()}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}clone(){return new ne(this)}}const{EVENT_TYPE:re}=Ut;function se(t,e,o=Kt){return t?t instanceof Ut?t:"function"==typeof t?se(t(e),e,o):e&&t in e?se(e[t],e,o):new o(t):o.DEFAULT}var ie=Object.freeze({__proto__:null,EVENT_TYPE:re,BaseStyle:Ut,Style:Kt,NumberStyle:Qt,CheckStyle:Yt,RadioStyle:ne,ButtonStyle:Gt,ImageStyle:Xt,IconStyle:qt,PercentCompleteBarStyle:ee,MultilineTextStyle:Zt,MenuStyle:Jt,of:se});const{setReadonly:le}=v,ce=H("col.fadein_stateID");function ae(t){let e=t[ce];return e||(e={cells:{}},le(t,ce,e)),e}function he(t,e,o,n,r,s){return i=>{const l=ae(t),c=`${o}:${e}`;1===i?delete l.cells[c]:l.cells[c]={opacity:i},s(),r();const a=l.cells[c];if(a){const t=n.getContext();t.globalAlpha=1-a.opacity;try{s()}finally{t.globalAlpha=1}}}}const ue={animate(t,e,o,n,r,s){const i=ae(t),l=[he(t,e,o,n,r,s)];i.activeFadeins=l,J(500,(t=>{l.forEach((e=>e(t))),1===t&&delete i.activeFadeins}))},margeAnimate(t,e,o,n,r,s){const i=ae(t);i.activeFadeins?i.activeFadeins.push(he(t,e,o,n,r,s)):r()}};class de{_fadeinWhenCallbackInPromise;constructor(t){this.onDrawCell=this.onDrawCell.bind(this),this._fadeinWhenCallbackInPromise=t?.fadeinWhenCallbackInPromise}get fadeinWhenCallbackInPromise(){return this._fadeinWhenCallbackInPromise}get StyleClass(){return Ut}onDrawCell(t,e,o,n){const{style:r,getRecord:s,drawCellBase:i}=e,l=n.getGridCanvasHelper();i();const c=s();let a;if(C(c))a=c;else if(C(t))a=t;else{const t=e.getMessage();C(t)&&(a=t)}if(a){const s=Date.now();return Promise.all([c,t,a.then((()=>t)).then((()=>e.getMessage()))]).then((({0:t,1:c,2:a})=>{if(!o.toCurrentContext().getDrawRect())return;const h=Date.now()-s,u=()=>{const s=o.toCurrentContext();if(!s.getDrawRect())return;const i=se(r,t,this.StyleClass);this.drawInternal(this.convertInternal(c),s,i,l,n,e),this.drawMessageInternal(a,s,i,l,n,e)};if(function(t,e){return null!=t.fadeinWhenCallbackInPromise?t.fadeinWhenCallbackInPromise:!!e.configure("fadeinWhenCallbackInPromise")}(this,n)){const{col:t,row:e}=o;h<80?ue.margeAnimate(n,t,e,o,u,i):ue.animate(n,t,e,o,u,i)}else u()}))}{const s=se(r,c,this.StyleClass);this.drawInternal(this.convertInternal(t),o,s,l,n,e),this.drawMessageInternal(e.getMessage(),o,s,l,n,e);const{col:a,row:h}=o,u=`${a}:${h}`,d=n[ce]?.cells[u];if(d){const t=o.getContext();t.globalAlpha=1-d.opacity;try{i()}finally{t.globalAlpha=1}}return}}convertInternal(t){return null!=t?t:""}drawMessageInternal(t,e,o,n,r,s){s.messageHandler.drawCellMessage(t,e,o,n,r,s)}bindGridEvent(t,e){return[]}getCopyCellValue(t,e,o){return t}}let ge;const fe=(t,e)=>{switch(e%3){case 0:return"#979797";case 1:return"#008fb5";case 2:return"#f1c109"}return"#979797"};class _e extends Ut{_branchColors;_margin;_circleSize;_branchLineWidth;_mergeStyle;static get DEFAULT(){return ge||(ge=new _e)}constructor(t={}){super(t),this._branchColors=t.branchColors||fe,this._margin=t.margin||4,this._circleSize=t.circleSize||16,this._branchLineWidth=t.branchLineWidth||4,this._mergeStyle="straight"===t.mergeStyle?"straight":"bezier"}get branchColors(){return this._branchColors}set branchColors(t){this._branchColors=t,this.doChangeStyle()}get margin(){return this._margin}set margin(t){this._margin=t,this.doChangeStyle()}get circleSize(){return this._circleSize}set circleSize(t){this._circleSize=t,this.doChangeStyle()}get branchLineWidth(){return this._branchLineWidth}set branchLineWidth(t){this._branchLineWidth=t,this.doChangeStyle()}get mergeStyle(){return this._mergeStyle}set mergeStyle(t){this._mergeStyle=t,this.doChangeStyle()}clone(){return new _e(this)}}const Ce=H("branch_graph_col.stateID");class pe{fromIndex;toIndex;colorIndex;point;constructor({fromIndex:t,toIndex:e,colorIndex:o,point:n}){this.fromIndex=t,this.toIndex=e,this.colorIndex=o,this.point=n}}class we{index;commit;lines;tag;constructor({index:t,commit:e=!1,lines:o=[],tag:n}){this.index=t,this.commit=e,this.lines=o,this.tag=n}static mergeLines(t){const e=t.filter((t=>null!=t.fromIndex&&null!=t.toIndex)),o=t.filter((t=>null!=t.fromIndex&&null==t.toIndex)),n=t.filter((t=>null==t.fromIndex&&null!=t.toIndex));return o.forEach((t=>{for(let e=0;e<n.length;e++){const o=n[e];if(!o.point&&t.colorIndex===o.colorIndex){t.toIndex=o.toIndex,n.splice(e,1);break}}e.push(t)})),e.concat(n)}static merge(t,e){return t?new we({index:t.index,commit:t.commit||e.commit,lines:we.mergeLines(t.lines.concat(e.lines)),tag:t.tag||e.tag}):e}}function me(t,e){const o=[...t].reverse();for(let t=0;t<o.length;t++){const n=o[t][e];if(n){n.lines=we.mergeLines(n.lines.concat([new pe({toIndex:e,colorIndex:e})]));for(let n=0;n<t;n++){o[n][e]=new we({index:e,lines:[new pe({fromIndex:e,toIndex:e,colorIndex:e})]})}return!0}}return!1}function ye(t,e){const{timeline:o}=t,n=[];(Array.isArray(e)?e:[e]).forEach((e=>{if(!e)return;let o;if("branch"===e.command){const n=v.isObject(e.branch)?e.branch.from:null,r=v.isObject(e.branch)?e.branch.to:e.branch;o=function({timeline:t,branches:e},o,n){const r=null!=o?e.indexOf(o):-1;let s=e.indexOf(n);if(s<0&&(s=e.length,e.push(n)),r<0)return new we({index:s});{const e=function(){for(let e=t.length-1;e>=0;e--){const o=t[e][r];if(o&&o.commit)return e}return-1}();if(-1===e)return null;const o=e+1,n=new we({index:s,lines:[new pe({fromIndex:r,colorIndex:s})]});let i,l=null;if(o<t.length){const e=t[o];i=e[s]=we.merge(e[s],n)}else i=n,l=n;const c=t[e][r];return c.lines=we.mergeLines(c.lines.concat([new pe({toIndex:s,colorIndex:s,point:i})])),l}}(t,n,r)}else if("commit"===e.command){const{branch:n}=e;o=function({timeline:t,branches:e},o){const n=e.indexOf(o);if(n<0)return null;const r=new we({index:n,commit:!0});return me(t,n)&&(r.lines=we.mergeLines(r.lines.concat([new pe({fromIndex:n,colorIndex:n})]))),r}(t,n)}else if("merge"===e.command){const{from:n,to:r}=e.branch;o=function({timeline:t,branches:e},o,n){const r=e.indexOf(o),s=e.indexOf(n);if(s<0||r<0)return new we({index:s,commit:!0});const i=new we({index:s,commit:!0,lines:[new pe({fromIndex:r,colorIndex:r}),new pe({fromIndex:s,colorIndex:s})]}),l=[...t],c=l.pop();return c&&(c[r]=we.merge(c[r],new we({index:s,lines:[new pe({toIndex:s,colorIndex:r})]}))),me(l,r)&&c&&(c[r].lines=we.mergeLines(c[r].lines.concat([new pe({fromIndex:r,colorIndex:r})]))),me(t,s),i}(t,n,r)}else if("tag"===e.command){const{branch:n,tag:r}=e;o=function({branches:t},e,o){let n=t.indexOf(e);return n<0&&(n=t.length,t.push(e)),new we({index:n,tag:o})}(t,n,r)}o&&o.index>-1&&(n[o.index]=we.merge(n[o.index],o))})),o.push(n)}function be(t,e,o){const n={branches:[],timeline:[]};return function(t,e,o){const{dataSource:n}=t,r=[];let s;for(let t=0;t<n.length;t++){const o=n.getField(t,e);if(C(o)){const t=r.length;r.push(void 0),s=s?s.then((()=>o)).then((e=>{r[t]=e})):o.then((e=>{r[t]=e}))}else r.push(o)}s?s.then((()=>o(r))):o(r)}(e,o,(e=>{"top"!==t&&(e=[...e].reverse()),e.forEach((t=>{ye(n,t)}))})),n}class xe extends de{_start;_cache;constructor(t={}){super(t),this._start=t.start||"bottom",this._cache=null!=t.cache&&t.cache}get StyleClass(){return _e}clearCache(t){delete t[Ce]}onDrawCell(t,e,o,n){if(this._cache){const t=n[Ce]||(n[Ce]=new Map),{col:e,row:r}=o,s=n.getField(e,r);t.has(s)||t.set(s,be(this._start,n,s))}return super.onDrawCell(t,e,o,n)}clone(){return new xe(this)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{col:i,row:l}=e,c=r.getField(i,l),{timeline:a,branches:h}=(this._cache?r[Ce]?.get(c):null)??be(this._start,r,c),{upLineIndexKey:u,downLineIndexKey:d}="top"!==this._start?{upLineIndexKey:"toIndex",downLineIndexKey:"fromIndex"}:{upLineIndexKey:"fromIndex",downLineIndexKey:"toIndex"},g="top"!==this._start?a[a.length-(l-r.frozenRowCount)-1]:a[l-r.frozenRowCount],{branchColors:f,branchLineWidth:C,circleSize:p,mergeStyle:w,margin:m,bgColor:y}=o;y&&s({bgColor:y});const b=e.getRect(),x=p/2,v=b.width-2*m;n.drawWithClip(e,(t=>{t.textAlign="left",t.textBaseline="middle";const e=function(t,e,o,n,r,s){let i=Math.max(o/r.length+1,5);s.forEach((e=>{e.forEach(((e,r)=>{if(!(r<=0)&&e.tag){const s=t.measureText(e.tag).width;i*r+2*n+4+s>o&&(i=Math.max((o-2*n-4-s)/r,5))}}))}));const l=[];let c=e;return r.forEach((()=>{l.push(Math.ceil(c+n)),c+=i})),l}(t,b.left+m,v,x,h,a),o=b.top+b.height/2;g.map(((t,e)=>t?t.lines.map((t=>({colorIndex:t.colorIndex,upLineIndex:t[u],downLineIndex:t[d],pointIndex:e}))):[])).reduce(((t,e)=>t.concat(e)),[]).sort(((t,e)=>e.colorIndex-t.colorIndex)).forEach((n=>{const s=e[n.pointIndex];!function(t,e,o,n,r,s,i,{branchXPoints:l,branchColors:c,branchLineWidth:a,mergeStyle:h},{col:u,row:d,branches:g}){if(null!=r||null!=s){if(e.strokeStyle=_(c,g[i],i),e.lineWidth=a,e.lineCap="round",e.beginPath(),null!=r){const s=l[r],i=t.getCellRelativeRect(u,d-1),c=i.top+i.height/2;e.moveTo(s,c),"bezier"===h?e.bezierCurveTo(s,(n+c)/2,o,(n+c)/2,o,n):e.lineTo(o,n)}else e.moveTo(o,n);if(null!=s){const r=l[s],i=t.getCellRelativeRect(u,d+1),c=i.top+i.height/2;"bezier"===h?e.bezierCurveTo(o,(n+c)/2,r,(n+c)/2,r,c):e.lineTo(r,c)}e.stroke()}}(r,t,s,o,n.upLineIndex,n.downLineIndex,n.colorIndex,{margin:m,branchXPoints:e,branchLineWidth:C,branchColors:f,mergeStyle:w},{width:v,col:i,row:l,branches:h})})),g.forEach(((n,r)=>{if(n&&n.commit){const n=e[r];t.fillStyle=_(f,h[r],r),t.beginPath(),t.arc(n,o,x,0,2*Math.PI,!0),t.fill(),t.closePath()}})),g.forEach(((n,r)=>{n&&n.tag&&(t.fillStyle=_(f,h[r],r),t.fillText(n.tag,e[r]+x+4,o))}))}))}}const ve=["content","font","color","className","tagName","isLiga","width","src","svg","name","path"];const Ee={},Le={};function Re(t){if(!t)return t;if(Array.isArray(t))return t;const e={};let o=0;ve.forEach((e=>{const n=t[e];n&&(o=Array.isArray(n)?Math.max(o,n.length):Math.max(o,1))})),ve.forEach((n=>{const r=function(t,e){const o=[];if(Array.isArray(t)){o.push(...t);for(let n=t.length;n<e;n++)o.push(null)}else for(let n=0;n<e;n++)o.push(t);return o}(t[n],o);e[n]=r}));const n=[];for(let t=0;t<o;t++){const o={};ve.forEach((n=>{const r=e[n][t];o[n]=r})),n.push(o)}return n}function Be(t){const e={};for(const o in t)"className"!==o&&Se(o)&&(e[o]=t[o]);if(t.className){const o=function(t,e){const o=Le[t]||(Le[t]={});if(o[e])return o[e];const n=Ee[t]||(Ee[t]=document.createElement(t));n.className=e,document.body.appendChild(n);try{const t=(document.defaultView||window).getComputedStyle(n,"::before");let r=t.getPropertyValue("content");r.length>=3&&('"'===r[0]||"'"===r[0])&&r[0]===r[r.length-1]&&(r=r.substr(1,r.length-2));let s=t.getPropertyValue("font");s||(s=`${t.getPropertyValue("font-style")} ${t.getPropertyValue("font-variant")} ${t.getPropertyValue("font-weight")} ${t.getPropertyValue("font-size")}/${t.getPropertyValue("line-height")} ${function(t){const e=[],o=t.split(/,\s*/);for(let t=0;t<o.length;t++){const n=o[t].replace(/['"]/g,"");-1!==n.indexOf(" ")||/^\d/.test(n)?e.push(`'${n}'`):e.push(n)}return e.join(",")}(t.getPropertyValue("font-family"))}`);const i=t.getPropertyValue("color"),l=n.clientWidth,c=(t.getPropertyValue("font-feature-settings")||"").indexOf("liga")>-1;return o[e]={content:r,font:s,color:i,width:l,isLiga:c}}finally{document.body.removeChild(n)}}(t.tagName||"i",t.className);for(const n in o)Se(n)&&null==t[n]&&(e[n]=o[n])}return e}const Ie=ve;function Se(t){return ve.indexOf(t)>=0}function Te(t,e,o,n){let r;if(t)if(C(t))t.then((t=>{Te(t,e.toCurrentContext(),o,n)}));else{const n=function(t){const e=Re(t);return e?e.map((t=>Be(t))):e}(t);n.forEach((t=>{t.font&&t.content&&o.testFontLoad(t.font,t.content,e)})),r=n}n(r,e)}class ke extends de{get StyleClass(){return Kt}clone(){return new ke(this)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,color:a,font:h,bgColor:u,padding:d,textOverflow:g}=o;u&&s({bgColor:u});const f=null!=t?String(t):"";n.testFontLoad(h,f,e),Te(i(),e,n,((t,e)=>{n.text(f,e,{textAlign:l,textBaseline:c,color:a,font:h,padding:d,textOverflow:g,icons:t})}))}}const Ae=N();class Oe extends ke{_caption;constructor(t={}){super(t),this._caption=t.caption}get StyleClass(){return Gt}get caption(){return this._caption}withCaption(t){const e=this.clone();return e._caption=t,e}clone(){return new Oe(this)}convertInternal(t){return this._caption||super.convertInternal(t)}getCopyCellValue(t){return this._caption||t}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,bgColor:a,color:h,buttonBgColor:u,font:d,padding:g,textOverflow:f}=o;a&&s({bgColor:a});const _=null!=t?String(t):"";n.testFontLoad(d,_,e);const{col:C,row:p}=e,w=r.getCellRange(C,p);let y=!1;const b=r[Ae];if(b)if(b.mouseActiveCell&&m(w,b.mouseActiveCell.col,b.mouseActiveCell.row))y=!0;else{const{select:t}=e.getSelection();m(w,t.col,t.row)&&(y=!0)}Te(i(),e,n,((t,e)=>{n.button(_,e,{textAlign:l,textBaseline:c,bgColor:u,color:h,font:d,padding:g,shadow:y?{color:"rgba(0, 0, 0, 0.48)",blur:6,offsetY:3}:{},textOverflow:f,icons:t})}))}}function Me(t){if("string"==typeof t){if("false"===t)return!1;if("off"===t)return!1;if(/^0+$/.exec(t))return!1}return Boolean(t)}const De=V();class Fe extends de{get StyleClass(){return Yt}clone(){return new Fe(this)}convertInternal(t){return Me(t)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,borderColor:c,checkBgColor:a,uncheckBgColor:h,bgColor:u}=o;u&&s({bgColor:u});const{col:d,row:g}=e,f=r.getCellRange(d,g),_=`${f.start.col}:${f.start.row}`,C=r[De]?.elapsed[_],p={textAlign:i,textBaseline:l,borderColor:c,checkBgColor:a,uncheckBgColor:h};null!=C&&(p.animElapsedTime=C),n.checkbox(t,e,p)}}class We extends ke{_tagName;_className;_content;_name;_iconWidth;constructor(t={}){super(t),this._tagName=t.tagName||"i",this._className=t.className,this._content=t.content,this._name=t.name,this._iconWidth=t.iconWidth}get StyleClass(){return qt}clone(){return new We(this)}drawInternal(t,e,o,n,r,s){const i=Number(t);if(isNaN(i))s.getIcon=()=>null;else{const t={};Ie.forEach((e=>{t[e]=o[e]})),t.className=this._className,t.tagName=this._tagName,this._content&&(t.content=this._content),t.name=this._name,this._iconWidth&&(t.width=this._iconWidth),s.getIcon=()=>function(t,e){e===1/0&&(e=0);const o=[];for(let n=0;n<e;n++)o.push(t);return o}(t,i)}super.drawInternal("",e,o,n,r,s)}}const Pe={};function He(t,e){const o=e||t.font;if(Pe[o])return Pe[o];const n=t.font;try{t.font=o;const e=t.measureText("ã‚").width;return Pe[o]={width:e,height:e}}finally{t.font=n}}function ze(t,e,o,n,{offset:r=0,padding:{left:s=0,right:i=0,top:l=0,bottom:c=0}={}}={}){const a=t.textAlign||"left",h=t.textBaseline||"middle";t.textAlign=a,t.textBaseline=h;let u=e.left+r+s;"right"===a||"end"===a?u=e.right-o-r-i:"center"===a&&(u=e.left+(e.width-o+s-i)/2);let d=e.top+r+l;return"bottom"===h||"alphabetic"===h||"ideographic"===h?d=e.bottom-n-r-c:"middle"===h&&(d=e.top+(e.height-n+l-c)/2),{x:u,y:d}}class Ve{_list;_map;_cacheSize;constructor(t){this._list=[],this._map={},this._cacheSize=t||50}get(t){const e=this._map[t];if(e){const e=this._list,o=e.indexOf(t);e.splice(o,1),e.push(t)}return e}put(t,e){const o=this._list,n=this._map;if(n[t]){const e=o.indexOf(t);o.splice(e,1)}if(n[t]=e,o.push(t),o.length>this._cacheSize){delete n[o.shift()||""]}}}const $e={};function Ne(t,e){return p(e,(e=>{const o=t.get(e);if(o)return o;const n=function(t){if("undefined"==typeof Promise)return console.error("Promise is not loaded. load Promise before this process."),{then(){return this}};const e=new Image,o=new Promise((t=>{e.onload=()=>{t(e)}}));return e.onerror=()=>{const e=t.length>200?`${t.substr(0,200)}...`:t;throw console.warn(`cannot load: ${e}`),new Error(`IMAGE LOAD ERROR: ${e}`)},e.src=t,o}(e).then((o=>(t.put(e,o),o)));return t.put(e,n),n}))}function Ue(t,e,o){return Ne($e[t]||($e[t]=new Ve(e)),o)}class je extends de{get StyleClass(){return Xt}onDrawCell(t,e,o,n){return super.onDrawCell(Ue("ImageColumn",50,t),e,o,n)}clone(){return new je(this)}drawInternal(t,e,o,n,r,{drawCellBase:s}){if(t){const{textAlign:r,textBaseline:i,margin:l,bgColor:c}=o;c&&s({bgColor:c}),n.drawWithClip(e,(n=>{n.textAlign=r,n.textBaseline=i;const s=e.getRect();if("keep-aspect-ratio"===o.imageSizing){const{width:e,height:o}=function(t,e,o,n){let r=t,s=e;return r>o&&(r=o,s=r*e/t),s>n&&(s=n,r=s*t/e),{width:r,height:s}}(t.width,t.height,s.width-2*l,s.height-2*l),r=ze(n,s,e,o,{offset:l});n.drawImage(t,0,0,t.width,t.height,r.x,r.y,e,o)}else n.drawImage(t,0,0,t.width,t.height,s.left+l,s.top+l,s.width-2*l,s.height-2*l)}))}}}function Ke(t){if(!t)return[];if(Array.isArray(t))return t.map((t=>function(t,e){const o={};for(const e in t)o[e]=t[e];for(const t in e)o[t]=e[t];return o}(t,{label:t.caption||t.label})));if("string"==typeof t)return Ke(JSON.parse(t));const e=[];for(const o in t)e.push({value:o,label:t[o]});return e}function Ge(t){return"function"==typeof t?e=>Ke(t(e)):()=>Ke(t)}class Ye extends de{_options;constructor(t={}){super(t),this._options=Ke(t.options)}get StyleClass(){return Jt}clone(){return new Ye(this)}get options(){return this._options}withOptions(t){const e=this.clone();return e._options=Ke(t),e}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,font:a,bgColor:h,padding:u,textOverflow:d,appearance:g}=o;let{color:f}=o;h&&s({bgColor:h});const _=this._convertInternal(t),C=null!=_?String(_):"";n.testFontLoad(a,C,e),Te(i(),e,n,((e,o)=>{const r=n.toBoxPixelArray(u||0,o,a),s=r.slice(0);s[1]+=26;const i=r.slice(0);i[1]+=8,null!=f||null!=t&&""!==t||(f="rgba(0, 0, 0, .38)"),n.text(C,o,{textAlign:l,textBaseline:c,color:f,font:a,padding:s,textOverflow:d,icons:e}),"menulist-button"===g?n.text("",o,{textAlign:"right",textBaseline:c,color:f,font:a,icons:[{path:"M0 2 5 7 10 2z",width:10,color:"rgba(0, 0, 0, .54)"}],padding:i}):"none"!==g&&console.warn(`unsupported appearance:${g}`)}))}convertInternal(t){return t}_convertInternal(t){const e=this._options;for(let o=0;o<e.length;o++){const n=e[o];if(n.value===t){t=n.label;break}}return super.convertInternal(t)}getCopyCellValue(t){return this._convertInternal(t)}}class qe extends de{constructor(t={}){super(t)}get StyleClass(){return Zt}clone(){return new qe(this)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,color:a,font:h,bgColor:u,padding:d,lineHeight:g,autoWrapText:f,lineClamp:_,textOverflow:C}=o;u&&s({bgColor:u});const p=null!=t?String(t):"",w=p.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(h,p,e),Te(i(),e,n,((t,e)=>{n.multilineText(w,e,{textAlign:l,textBaseline:c,color:a,font:h,padding:d,lineHeight:g,autoWrapText:f,lineClamp:_,textOverflow:C,icons:t})}))}}let Xe;class Je extends ke{_format;static get defaultFotmat(){return Xe||(Xe=new Intl.NumberFormat)}static set defaultFotmat(t){Xe=t}constructor(t={}){super(t),this._format=t.format}get StyleClass(){return Qt}clone(){return new Je(this)}get format(){return this._format}withFormat(t){const e=this.clone();return e._format=t,e}convertInternal(t){const e=Number(t);if(isNaN(e)){const e=super.convertInternal(t);return null!=e?String(e):""}return(this._format||Je.defaultFotmat).format(e)}}class Ze extends ke{_min;_max;_formatter;constructor(t={}){super(t),this._min=t.min||0,this._max=t.max||this._min+100,this._formatter=t.formatter||(t=>t)}get StyleClass(){return ee}clone(){return new Ze(this)}drawInternal(t,e,o,n,r,s){super.drawInternal(this._formatter(t),e,o,n,r,s);const{barColor:i,barBgColor:l,barHeight:c}=o;let a=null!=t?String(t):"";E.endsWith(a,"%")&&(a=a.slice(0,-1));const h=Number(a);if(isNaN(h))return;const u=h<this._min?0:h>this._max?1:(h-this._min)/(this._max-this._min);n.drawWithClip(e,(t=>{const o=e.getRect(),n=o.width-4-1,r=o.bottom-2-c-1,s=o.left+2;t.fillStyle=_(l,100*u)||"#f0f3f5",t.beginPath(),t.rect(s,r,n,c),t.fill();const a=Math.min(n*u,n);t.fillStyle=_(i,100*u)||"#20a8d8",t.beginPath(),t.rect(s,r,a,c),t.fill()}))}}const Qe=$();class to extends de{get StyleClass(){return ne}clone(){return new to(this)}convertInternal(t){return Me(t)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,checkColor:c,uncheckBorderColor:a,checkBorderColor:h,uncheckBgColor:u,checkBgColor:d,bgColor:g}=o;g&&s({bgColor:g});const{col:f,row:_}=e,C=r.getCellRange(f,_),p=`${C.start.col}:${C.start.row}`,w=r[Qe]?.elapsed[p],m={textAlign:i,textBaseline:l,checkColor:c,uncheckBorderColor:a,checkBorderColor:h,uncheckBgColor:u,checkBgColor:d};null!=w&&(m.animElapsedTime=w),n.radioButton(t,e,m)}}const eo={DEFAULT:new ke,NUMBER:new Je,CHECK:new Fe,RADIO:new to,BUTTON:new Oe,IMAGE:new je,MULTILINETEXT:new qe};function oo(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return eo[e]||oo(null)}return t}return eo.DEFAULT}var no=Object.freeze({__proto__:null,Column:ke,NumberColumn:Je,CheckColumn:Fe,RadioColumn:to,ButtonColumn:Oe,ImageColumn:je,PercentCompleteBarColumn:Ze,IconColumn:We,BranchGraphColumn:xe,MenuColumn:Ye,MultilineTextColumn:qe,of:oo});const ro=H("inline_menu_editor.stateID");let so=null,io=0;function lo(t,e,o,n,r){const s=function(t){let e=t[ro];return e||(e={},v.setReadonly(t,ro,e)),e}(t);so||(so=new It),s.element||(s.element=so,io++,t.addDisposable({dispose(){io--,io||(so?.dispose(),so=null,s.element=null)}})),so.attach(t,o,e.col,e.row,n,r)}function co(t){so&&so.detach(t)}class ao extends K{_classList;_options;constructor(t={}){super(t),this._classList=t.classList,this._options=Ge(t.options)}dispose(){}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get options(){return this._options}set options(t){this._options=Ge(t)}clone(){return new ao(this)}onChangeDisabledInternal(){co(!0)}onChangeReadOnlyInternal(){co(!0)}bindGridEvent(t,e){const o=e=>!O(this.readOnly,t,e.row)&&!A(this.disabled,t,e.row)&&(t.doGetCellValue(e.col,e.row,(o=>{const n=t.getRowRecord(e.row);C(n)||lo(t,e,this,o,n)})),!0);function n(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(I.CLICK_CELL,(t=>{n(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(I.KEYDOWN,(e=>{if(113!==e.keyCode&&13!==e.keyCode)return;const r=t.selection.select;n(r.col,r.row)&&o({col:r.col,row:r.row})&&e.stopCellMoving()})),t.listen(I.SELECTED_CELL,(t=>{co()})),t.listen(I.SCROLL,(()=>{co(!0)})),t.listen(I.MOUSEOVER_CELL,(e=>{n(e.col,e.row)&&(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||(t.getElement().style.cursor="pointer"))})),t.listen(I.MOUSEMOVE_CELL,(e=>{n(e.col,e.row)&&(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||t.getElement().style.cursor||(t.getElement().style.cursor="pointer"))})),t.listen(I.MOUSEOUT_CELL,(e=>{n(e.col,e.row)&&(t.getElement().style.cursor="")})),t.listen(I.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;if(!w(o.start,o.end))return;if(!n(e.col,e.row))return;if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row))return;const r=t.getRowRecord(e.row);if(C(r))return;const s=this._pasteDataToOptionValue(e.normalizeValue,t,e,r);s?(L.cancel(e.event),p(t.doChangeValue(e.col,e.row,(()=>s.value)),(()=>{const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)}))):t.fireListeners("rejected_paste_values",{detail:[{col:e.col,row:e.row,record:r,define:t.getColumnDefine(e.col,e.row),pasteValue:e.normalizeValue}]})}))]}onPasteCellRangeBox(t,e,o,n){if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row))return;const r=t.getRowRecord(e.row);if(C(r))return;const s=this._pasteDataToOptionValue(o,t,e,r);s?t.doChangeValue(e.col,e.row,(()=>s.value)):n.reject()}onDeleteCellRangeBox(t,e){if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row))return;const o=t.getRowRecord(e.row);if(C(o))return;const n=this._pasteDataToOptionValue("",t,e,o);n&&t.doChangeValue(e.col,e.row,(()=>n.value))}_pasteDataToOptionValue(t,e,o,r){const s=this._options(r),i=ho(t,s);if(i)return i;const l=e.getColumnType(o.col,o.row);if(function(t){if(t instanceof Ye)return!0;if(Array.isArray(t.options))return!0;return!1}(l)){const e=uo(t),o=n.find(l.options,(t=>uo(t.label)===e));if(o)return ho(o.value,s)}}}function ho(t,e){const o=uo(t),r=n.find(e,(t=>uo(t.value)===o));if(r)return r}function uo(t){return null==t?"":`${t}`.trim()}const go=$();class fo extends K{_group;_checkAction;constructor(t={}){super(t),this._group=t.group,this._checkAction=t.checkAction}clone(){return new fo(this)}get group(){return this._group}set group(t){this._group=t}get checkAction(){return this._checkAction}set checkAction(t){this._checkAction=t}bindGridEvent(t,e){let o=t[go];o||(o={block:{},elapsed:{}},v.setReadonly(t,go,o));const n=o,r=e=>{this._action(t,e)};return[...S(t,e,{action:r,mouseOver:e=>{if(A(this.disabled,t,e.row))return!1;n.mouseActiveCell={col:e.col,row:e.row};const o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:e=>{delete n.mouseActiveCell;const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)}}),...T(t,e,{action:r}),t.listen(I.PASTE_CELL,(o=>{if(o.multi)return;const n=t.selection.range;if(!w(n.start,n.end))return;if(s=o.col,i=o.row,t.getLayoutCellId(s,i)!==e)return;var s,i;L.cancel(o.event);const l=o.normalizeValue.trim();if(Co(l)){const e=t.getRowRecord(o.row);C(e)||t.fireListeners("rejected_paste_values",{detail:[{col:o.col,row:o.row,record:e,define:t.getColumnDefine(o.col,o.row),pasteValue:l}]})}else Me(l)&&r({col:o.col,row:o.row})}))]}onPasteCellRangeBox(t,e,o,n){if(O(this.readOnly,t,e.row)||A(this.disabled,t,e.row))return;const r=o.trim();Co(r)?n.reject():Me(r)&&this._action(t,{col:e.col,row:e.row})}onDeleteCellRangeBox(){}_action(t,e){const o=t[go],n=t.getCellRange(e.col,e.row),r=`${n.start.col}:${n.start.row}`;O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||o.block[r]||t.doGetCellValue(e.col,e.row,(o=>{if(Me(o))return;if(this._checkAction){const o=t.getRowRecord(e.row);return void this._checkAction(o,u(e,{grid:t}))}if(this._group){const o=t[go];return void this._group({grid:t,col:e.col,row:e.row}).forEach((({col:n,row:r})=>{const s=t.getCellRange(n,r),i=`${s.start.col}:${s.start.row}`;O(this.readOnly,t,e.row)||A(this.disabled,t,e.row)||o.block[i]||_o(t,n,r,n===e.col&&r===e.row)}))}const n=t.getField(e.col,e.row),r=t.getRecordStartRowByRecordIndex(t.getRecordIndexByRow(e.row)),{dataSource:s}=t.dataSource,i=function(t){const e=[],{rowCount:o,recordRowCount:n}=t;for(let r=t.frozenRowCount;r<o;r+=n){const o=t.getRowRecord(r);e.push({row:r,record:o})}return e}(t);for(let o=0;o<s.length;o++){const l=s.get(o),c=i.find((t=>t.record===l));c?_o(t,e.col,c.row,c.row===r):p(s.getField(o,n),(t=>{Me(t)&&s.setField(o,n,M(t))}))}}))}}function _o(t,e,o,n){t.doGetCellValue(e,o,(r=>{if(Me(r)===n)return;const s=t[go],i=t.getCellRange(e,o),l=`${i.start.col}:${i.start.row}`,c=t.doChangeValue(e,o,M);if(c){const e=()=>{J(200,(e=>{1===e?delete s.elapsed[l]:s.elapsed[l]=e,t.invalidateCellRange(i)}))};C(c)?(s.block[l]=!0,c.then((()=>{delete s.block[l],e()}))):e()}}))}function Co(t){return M(M(t))!==t}const po="cheetah-grid__small-dialog-input",wo=`${po}__input`,mo=`${po}--hidden`,yo=`${po}--shown`;function bo(t,e){e.tryWithOffEvents(t,"blur",(()=>{(()=>{t.focus();const e=t.value.length;try{if(void 0!==t.selectionStart)return t.selectionStart=e,void(t.selectionEnd=e)}catch(t){}if(document.selection){const o=t.createTextRange();o.collapse(),o.moveEnd("character",e),o.moveStart("character",e),o.select()}})()}))}function xo(t,e,o){const{type:n}=t;o.type=n||""}class vo{_handler;_dialog;_input;_beforePropEditor;_activeData;_attaching;_beforeValue;static setInputAttrs(t,e,o){xo(t,0,o)}constructor(){this._handler=new nt,this._dialog=function(){require("@/columns/action/internal/SmallDialogInputElement.css");const t=rt("div",{classList:[po,mo]}),e=rt("input",{classList:wo});return e.readOnly=!0,e.tabIndex=-1,t.appendChild(e),t}(),this._input=this._dialog.querySelector(`.${wo}`),this._bindDialogEvents()}dispose(){const t=this._dialog;this.detach(),this._handler.dispose(),delete this._dialog,delete this._input,this._beforePropEditor=null,t.parentElement&&t.parentElement.removeChild(t)}attach(t,e,o,n,r){const s=this._handler,i=this._dialog,l=this._input;this._beforePropEditor&&function(t,e,o,n){const{classList:r}=n;r&&e.classList.remove(...r),delete e.dataset.helperText,o.type=""}(0,i,l,this._beforePropEditor),delete i.dataset.errorMessage,i.classList.remove(yo),i.classList.add(mo),l.readOnly=!0,l.tabIndex=0;const{element:c,rect:a}=t.getAttachCellsArea(t.getCellRange(o,n));i.style.top=`${a.top.toFixed()}px`,i.style.left=`${a.left.toFixed()}px`,i.style.width=`${a.width.toFixed()}px`,l.style.height=`${a.height.toFixed()}px`,c.appendChild(i),ht(l,r),l.style.font=t.font||"16px sans-serif";const h={grid:t,col:o,row:n,editor:e};this._onInputValue(l,h),y?setTimeout((()=>bo(l,s))):bo(l,s),i.classList.add(yo),i.classList.remove(mo),l.readOnly=!1,function(t,e,o,n){const{classList:r,helperText:s}=n;r&&e.classList.add(...r),s&&"function"!=typeof s&&(e.dataset.helperText=s),xo(n,0,o)}(0,i,l,e),this._activeData=h,this._beforePropEditor=e,this._attaching=!0,setTimeout((()=>{delete this._attaching}))}detach(t){if(this._isActive()){const e=this._dialog,o=this._input;e.classList.remove(yo),e.classList.add(mo),o.readOnly=!0,o.tabIndex=-1;const{grid:n,col:r,row:s}=this._activeData,i=n.getCellRange(r,s);n.invalidateCellRange(i),t&&n.focus()}this._activeData=null,this._beforeValue=null}_doChangeValue(){if(!this._isActive())return!1;const t=this._input,{value:e}=t;return p(this._validate(e),(o=>{if(o&&e===t.value){const{grid:t,col:o,row:n}=this._activeData;return t.doChangeValue(o,n,(()=>e)),!0}return!1}))}_isActive(){const t=this._dialog;return!(!t||!t.parentElement)&&!!this._activeData}_bindDialogEvents(){const t=this._handler,e=this._dialog,o=this._input,n=t=>t.stopPropagation();t.on(e,"click",n),t.on(e,"dblclick",n),t.on(e,"mousedown",n),t.on(e,"touchstart",n),t.on(o,"compositionstart",(t=>{o.classList.add("composition")})),t.on(o,"compositionend",(t=>{o.classList.remove("composition"),this._onInputValue(o)}));const r=t=>{o.classList.contains("composition")||this._onInputValue(o)};t.on(o,"keyup",r),t.on(o,"keypress",r),t.on(o,"keydown",(t=>{if(o.classList.contains("composition"))return;const e=L.getKeyCode(t);27===e?(this.detach(!0),L.cancel(t)):13===e?this._onKeydownEnter(t):this._onInputValue(o)}))}_onKeydownEnter(t){if(this._attaching)return;const e=this._input,{value:o}=e;p(this._doChangeValue(),(n=>{if(n&&o===e.value){const e=this._isActive()?this._activeData.grid:null;this.detach(!0),e?.keyboardOptions?.moveCellOnEnter&&e.onKeyDownMove(t)}})),L.cancel(t)}_onInputValue(t,e){const o=this._beforeValue,{value:n}=t;o!==n&&this._onInputValueChange(n,e),this._beforeValue=n}_onInputValueChange(t,e){e=e||this._activeData;const o=this._dialog,{grid:n,col:r,row:s,editor:i}=e;if("function"==typeof i.helperText){const e=i.helperText(t,{grid:n,col:r,row:s});e?o.dataset.helperText=e:delete o.dataset.helperText}"errorMessage"in o.dataset&&this._validate(t,!0)}_validate(t,e){const o=this._dialog,n=this._input,{grid:r,col:s,row:i,editor:l}=this._activeData;let c="";return l.inputValidator&&(c=l.inputValidator(t,{grid:r,col:s,row:i})),p(c,(c=>(c||!l.validator||e||(c=l.validator(t,{grid:r,col:s,row:i})),p(c,(e=>(e&&t===n.value?o.dataset.errorMessage=e:delete o.dataset.errorMessage,!e))))))}}const Eo=H("small_dialog_input_editor.stateID");let Lo=null,Ro=0;function Bo(t,e,o,n){const r=function(t){let e=t[Eo];return e||(e={},v.setReadonly(t,Eo,e)),e}(t);Lo||(Lo=new vo),r.element||(r.element=Lo,Ro++,t.addDisposable({dispose(){Ro--,Ro||(Lo?.dispose(),Lo=null,r.element=null)}})),Lo.attach(t,o,e.col,e.row,n)}function Io(t){Lo&&Lo.detach(t)}class So extends et{_helperText;_inputValidator;_validator;_classList;_type;constructor(t={}){super(t),this._helperText=t.helperText,this._inputValidator=t.inputValidator,this._validator=t.validator,this._classList=t.classList,this._type=t.type}dispose(){}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get type(){return this._type}set type(t){this._type=t}get helperText(){return this._helperText}get inputValidator(){return this._inputValidator}get validator(){return this._validator}clone(){return new So(this)}onInputCellInternal(t,e,o){Bo(t,e,this,o)}onOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{Bo(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){Io()}onGridScrollInternal(t){Io(!0)}onChangeDisabledInternal(){Io(!0)}onChangeReadOnlyInternal(){Io(!0)}onSetInputAttrsInternal(t,e,o){vo.setInputAttrs(this,t,o)}}const To={CHECK:new class extends Q{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},INPUT:new class extends So{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},RADIO:new class extends fo{get disabled(){return this._disabled}get readOnly(){return this._readOnly}}};function ko(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return To[e]||ko(null)}return t}}var Ao=Object.freeze({__proto__:null,ACTIONS:To,BaseAction:k,Editor:K,Action:F,CheckEditor:Q,RadioEditor:fo,ButtonAction:class extends F{getState(t){let e=t[j];return e||(e={},v.setReadonly(t,j,e)),e}},SmallDialogInputEditor:So,InlineInputEditor:mt,InlineMenuEditor:ao,of:ko}),Oo=Object.freeze({__proto__:null,action:Ao,type:no,style:ie});function Mo(t){return 9===t||10===t||12===t||13===t||32===t}function Do(t){return t>=48&&t<=57}function Fo(t){return 46===t}function Wo(t){return function(t){return function(t){return t>=97&&t<=122}(t)||function(t){return t>=65&&t<=90}(t)}(t)||37===t}function Po(t){return new Error(`calc parse error: ${t}`)}const Ho={"*":3,"/":3,"+":2,"-":2};function zo(t,e){function o(t){const o=t.pop(),n=t.pop(),r=t.pop();if(!(r&&r.nodeType&&n&&2===n.type&&o&&o.nodeType))throw Po(e);return{nodeType:11,left:r,op:n,right:o}}const r=[];for(;t.length;){const s=t.shift();if(0===s.type&&"("===s.value){let o=0;const s=n.findIndex(t,(t=>{if(0===t.type&&"("===t.value)o++;else if(0===t.type&&")"===t.value){if(!o)return!0;o--}return!1}));if(-1===s)throw Po(e);r.push(zo(t.splice(0,s),e)),t.shift()}else if(2===s.type){if(r.length>=3){const t=r[r.length-2].value;Ho[s.value]<=Ho[t]&&r.push(o(r))}r.push(s)}else if(1===s.type){const{value:t,unit:e}=s;r.push({nodeType:10,value:t,unit:e})}else 3===s.type&&r.push({nodeType:12,value:s.value})}for(;r.length>1;)r.push(o(r));return r[0]}function Vo(t){return zo(function(t){const e=t.replace(/calc\(/g,"(").trim(),o=[],n=e.length;for(let i=0;i<n;i++){const n=e[i],l=n.charCodeAt(0);if("("===n||")"===n)o.push({value:n,type:0});else if("*"===n||"/"===n)o.push({value:n,type:2});else if("+"===n||"-"===n)i=r(n,i+1)-1;else if(Do(l)||Fo(l))i=s(n,i+1)-1;else if(!Mo(l))throw Po(t)}function r(t,r){if(r<n){const o=e[r],n=o.charCodeAt(0);if(Do(n)||Fo(n))return s(t+o,r+1)}return o.push({value:t,type:2}),r}function s(r,s){let l=s;for(;l<n;l++){const o=e[l],n=o.charCodeAt(0);if(Do(n))r+=o;else{if("."!==o){if(Wo(n))return i(r,o,l+1);break}if(r.indexOf(".")>=0)throw Po(t);r+=o}}if("."===r)throw Po(t);return o.push({value:parseFloat(r),type:3}),l}function i(t,r,s){let i=s;for(;i<n;i++){const t=e[i];if(!Wo(t.charCodeAt(0)))break;r+=t}return o.push({value:parseFloat(t),unit:r,type:1}),i}return o}(t),t)}function $o(t,e){if(11===t.nodeType){const o=$o(t.left,e),n=$o(t.right,e);switch(t.op.value){case"+":return o+n;case"-":return o-n;case"*":return o*n;case"/":return o/n;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if(10===t.nodeType)switch(t.unit){case"%":return t.value*e.full/100;case"em":return t.value*e.em;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if(12===t.nodeType)return t.value;throw new Error("calc error.")}function No(t,e){return $o(Vo(t),e)}function Uo(t,e){return"string"==typeof t?No(t.trim(),e):t-0}const jo=new nt;let Ko,Go=1;function Yo(){t?Go=1:(Go=Math.ceil(window.devicePixelRatio||1),Go>1&&Go%2!=0&&(Go+=1))}Yo(),t||jo.on(window,"resize",Yo);let qo=function(){require("@/internal/style.css"),Ko=function(){const t=document.createElement("div"),e=document.createElement("div"),{style:o}=t;o.position="fixed",o.height="50px",o.width="50px",o.overflow="scroll",o.opacity="0",o.pointerEvents="none";const{style:n}=e;n.height="100%",n.width="100%",e.textContent="x",t.appendChild(e),document.body.appendChild(t);const r=t.getBoundingClientRect().width,s=e.getBoundingClientRect().width;return document.body.removeChild(t),Math.ceil(r-s)}()||10;const t=document.createElement("style");t.setAttribute("type","text/css"),t.setAttribute("data-name","cheetah-grid"),t.innerHTML=`\n.cheetah-grid .grid-scroll-end-point {\n\twidth: ${Ko}px;\n\theight: ${Ko}px;\n}\n.cheetah-grid > canvas {\n\twidth: -webkit-calc(100% - ${Ko}px);\n\twidth: calc(100% - ${Ko}px);\n\theight: -webkit-calc(100% - ${Ko}px);\n\theight: calc(100% - ${Ko}px);\n}\n\t\t`,document.head.appendChild(t)};function Xo(){return Ko}function Jo(t){return"\n"!==t[t.length-1]?t:"\r"===t[t.length-2]?t.slice(0,-2):t.slice(0,-1)}function Zo(t,e){const o=Jo(t),{values:n,colCount:r}=function(t,{trimOnPaste:e}){const o=t.length,n=e?t=>t.trim():t=>t;let r=1,s=[];const i=[s];let l="";for(let e=0;e<o;e++){const o=t[e];if("\t"!==o)if("\n"!==o){if('"'===o&&!l.trim()){const t=c(e+1);if(t){({cell:l}=t),e=t.next-1;continue}}l+=o}else l=n(l),"\r"===l[l.length-1]&&(l=l.slice(0,-1)),s.push(l),r=Math.max(r,s.length),s=[],i.push(s),l="";else s.push(n(l)),l=""}return s.push(n(l)),r=Math.max(r,s.length),{values:i,colCount:r};function c(e){let n="",r=e;for(;r<o;){const e=t[r];if('"'!==e){n+=e,r++;continue}if('"'===t[r+1]){n+='"',r+=2;continue}let s=r+1;for(;s<o;){const e=t[s];if(e.trim())return null;if("\t"===e||"\n"===e)break;s++}return{cell:n,next:s}}return null}}(o,e);return{colCount:r,rowCount:n.length,getCellValue:(t,e)=>n[e]?.[t]??""}}class Qo{_keys=[];_vals={};_sorted=!1;put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}remove(t){delete this._vals[t];const e=this._keys.indexOf(t);e<0||(this._keys.splice(e,1),this._sorted=!1)}get(t){return this._vals[t]}has(t){return null!=this._vals[t]}each(t,e,o){const{_keys:n}=this,{length:r}=n;this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let s=((t,e)=>{let o=0,n=t.length-1;for(;o<=n;){const r=Math.floor((o+n)/2);if(t[r]===e)return r;t[r]>e?n=r-1:o=r+1}return n<0?0:n})(n,t);s<r;s++){const r=n[s];if(t<=r&&r<=e)o(this.get(r),r);else if(e<r)return}}}class tn{_left;_top;_width;_height;_right;_bottom;constructor(t,e,o,n){this._left=t,this._top=e,this._width=o,this._height=n}static bounds(t,e,o,n){return new tn(t,e,o-t,n-e)}static max(t,e){return tn.bounds(Math.min(t.left,e.left),Math.min(t.top,e.top),Math.max(t.right,e.right),Math.max(t.bottom,e.bottom))}get left(){return this._left}set left(t){const{right:e}=this;this._left=t,this.right=e}get top(){return this._top}set top(t){const{bottom:e}=this;this._top=t,this.bottom=e}get width(){return this._width}set width(t){this._width=t,this._right=void 0}get height(){return this._height}set height(t){this._height=t,this._bottom=void 0}get right(){return void 0!==this._right?this._right:this._right=this.left+this.width}set right(t){this._right=t,this.width=t-this.left}get bottom(){return void 0!==this._bottom?this._bottom:this._bottom=this.top+this.height}set bottom(t){this._bottom=t,this.height=t-this.top}offsetLeft(t){this._left+=t,this._right=void 0}offsetTop(t){this._top+=t,this._bottom=void 0}copy(){return new tn(this.left,this.top,this.width,this.height)}intersection(t){const e=Math.max(this.left,t.left),o=Math.min(this.left+this.width,t.left+t.width);if(e<=o){const n=Math.max(this.top,t.top),r=Math.min(this.top+this.height,t.top+t.height);if(n<=r)return tn.bounds(e,n,o,r)}return null}contains(t){return this.left<=t.left&&this.left+this.width>=t.left+t.width&&this.top<=t.top&&this.top+this.height>=t.top+t.height}inPoint(t,e){return this.left<=t&&this.left+this.width>=t&&this.top<=e&&this.top+this.height>=e}}const en=x-1e3;class on{_handler;_scrollable;_height;_width;_endPointElement;_p=1;constructor(){this._handler=new nt,this._scrollable=document.createElement("div"),this._scrollable.classList.add("grid-scrollable"),this._height=0,this._width=0,this._endPointElement=document.createElement("div"),this._endPointElement.classList.add("grid-scroll-end-point"),this._update(),this._scrollable.appendChild(this._endPointElement)}calcTop(t){const e=t-this.scrollTop;return this._scrollable.scrollTop+e}getElement(){return this._scrollable}setScrollSize(t,e){this._width=t,this._height=e,this._update()}get scrollWidth(){return this._width}set scrollWidth(t){this._width=t,this._update()}get scrollHeight(){return this._height}set scrollHeight(t){this._height=t,this._update()}get scrollLeft(){return Math.max(Math.ceil(this._scrollable.scrollLeft),0)}set scrollLeft(t){this._scrollable.scrollLeft=t}get scrollTop(){return Math.max(Math.ceil(this._scrollable.scrollTop/this._p),0)}set scrollTop(t){this._scrollable.scrollTop=t*this._p}onScroll(t){this._handler.on(this._scrollable,"scroll",t)}dispose(){this._handler.dispose()}_update(){let t;if(this._height>en){const e=Xo(),{offsetHeight:o}=this._scrollable,n=en-o+e,r=this._height-o+e;this._p=n/r,t=en}else this._p=1,t=this._height;this._endPointElement.style.top=`${t.toFixed()}px`,this._endPointElement.style.left=`${this._width.toFixed()}px`}}const{isTouchEvent:nn,getMouseButtons:rn,getKeyCode:sn,cancel:ln}=L,cn=z();function an(t){navigator.vibrate&&nn(t)&&navigator.vibrate(50)}function hn(t){const e=this.getTargetRowAtInternal(t);if(null!=e)return e;const o=(e,o)=>{let n=o;for(let o=e;o>=0;o--){const e=n-kn.call(this,o);if(e<=t&&t<n)return{top:e,row:o};n=e}return null},n=(e,o)=>{let n=o-kn.call(this,e);const{rowCount:r}=this[cn];for(let o=e;o<r;o++){const e=n+kn.call(this,o);if(n<=t&&t<e)return{top:n,row:o};n=e}return null},r=Math.min(Math.ceil(t/this[cn].defaultRowHeight),this.rowCount-1),s=An.call(this,0,r);return t>=s?n(r,s):o(r,s)}function un(t,e){let o=0;const{colCount:n}=t[cn];for(let r=0;r<n;r++){const n=o+In(t,r);if(n>e)return{left:o,col:r};o=n}return null}function dn(t,e){if(!t[cn].frozenRowCount)return null;let{top:o}=t[cn].scroll;const n=t[cn].frozenRowCount;for(let r=0;r<n;r++){const n=o+kn.call(t,r);if(n>e)return{top:o,row:r};o=n}return null}function gn(t,e){if(!t[cn].frozenColCount)return null;let{left:o}=t[cn].scroll;const n=t[cn].frozenColCount;for(let r=0;r<n;r++){const n=o+In(t,r);if(n>e)return{left:o,col:r};o=n}return null}function fn(t){if(!t[cn].frozenRowCount)return null;const{top:e}=t[cn].scroll;let o=0;const n=t[cn].frozenRowCount;for(let e=0;e<n;e++)o+=kn.call(t,e);return new tn(t[cn].scroll.left,e,t[cn].canvas.width,o)}function _n(t){if(!t[cn].frozenColCount)return null;const{left:e}=t[cn].scroll;let o=0;const n=t[cn].frozenColCount;for(let e=0;e<n;e++)o+=In(t,e);return new tn(e,t[cn].scroll.top,o,t[cn].canvas.height)}function Cn(t,e,o,n,r,s,i,l,c,a,h){const u=new tn(o-l.left,s-l.top,n,i),d=tn.bounds(Math.max(o,a)-l.left,Math.max(s,c)-l.top,u.right,u.bottom);if(d.height>0&&d.width>0){t.save();try{const o=function(t,e,o){return t[cn].drawCells[o]?t[cn].drawCells[o][e]:null}(this,e,r);o&&o.cancel();const n=new Jn(e,r,t,u,d,!!o,this[cn].selection,h),s=this.onDrawCell(e,r,n);if(C(s)){!function(t,e,o,n){t[cn].drawCells[o]||(t[cn].drawCells[o]={}),t[cn].drawCells[o][e]=n}(this,e,r,n);const t=e;n._delayMode(this,(()=>{!function(t,e,o){t[cn].drawCells[o]&&(delete t[cn].drawCells[o][e],0===Object.keys(t[cn].drawCells[o]).length&&delete t[cn].drawCells[o])}(this,t,r)})),s.then((()=>{n.terminate()}))}}finally{t.restore()}}}function pn(t,e,o,n,r,s,i,l,c,a,h){const{colCount:u}=t[cn],d=(o,n)=>{if(o>=u-1&&t[cn].canvas.width>n-c.left){const o=n-c.left;e.save(),e.beginPath(),e.fillStyle=t.underlayBackgroundColor||"#F6F6F6",e.rect(o,i-c.top,t[cn].canvas.width-o,l),e.fill(),e.restore()}};let g=0;if(o){let n=o.left;const u=t[cn].frozenColCount;for(let{col:g}=o;g<u;g++){const o=In(t,g);if(Cn.call(t,e,g,n,o,s,i,l,c,a,0,h),n+=o,r<=n)return void d(g,n)}g=n}let f=n.left;for(let{col:o}=n;o<u;o++){const n=In(t,o);if(Cn.call(t,e,o,f,n,s,i,l,c,a,g,h),f+=n,r<=f)return void d(o,f)}d(u-1,f)}function wn(){return this._getInitContext()}function mn(t,e){const o=zn(t),{rowCount:n}=t[cn],r=wn.call(t),s=hn.call(t,Math.max(o.top,e.top))||{top:An.call(t,0,n-1),row:n},i=un(t,Math.max(o.left,e.left))||{left:Tn(t,0,t[cn].colCount-1),col:t[cn].colCount},l=Math.min(o.bottom,e.bottom),c=Math.min(o.right,e.right),a=dn(t,Math.max(o.top,e.top)),h=gn(t,Math.max(o.left,e.left)),u=new qn,d=(e,s)=>{if(e>=n-1&&t[cn].canvas.height>s-o.top){const e=s-o.top;r.save(),r.beginPath(),r.fillStyle=t.underlayBackgroundColor||"#F6F6F6",r.rect(0,e,t[cn].canvas.width,t[cn].canvas.height-e),r.fill(),r.restore()}};let g=0;if(a){let e=a.top;const n=t[cn].frozenRowCount;for(let{row:s}=a;s<n;s++){const n=kn.call(t,s);if(pn(t,r,h,i,c,s,e,n,o,0,u),e+=n,l<=e)return d(s,e),void u.draw(r)}g=e}let f=s.top;for(let{row:e}=s;e<n;e++){const n=kn.call(t,e);if(pn(t,r,h,i,c,e,f,n,o,g,u),f+=n,l<=f)return d(e,f),void u.draw(r)}d(n-1,f),u.draw(r)}function yn(t,e){return Math.round(Uo(e,t[cn].calcWidthContext))}function bn(t,e,o){const n=En(t,e);return Math.max(xn(n,o),0)}function xn(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}function vn(t,e){const o=t[cn].colWidthsMap.get(e);return o||t.defaultColWidth}function En(t,e){const o=t[cn].colWidthsLimit[e];if(!o)return null;const n={};return o.min&&(n.min=yn(t,o.min),n.minDef=o.min),o.max&&(n.max=yn(t,o.max),n.maxDef=o.max),n}function Ln(t){return Boolean(t&&"string"==typeof t&&"auto"===t.toLowerCase())}function Rn(t,e=!0){const o=t[cn].calcWidthContext.full;let n=0;const r=[];let s=0;const i=[];for(let l=0;l<t[cn].colCount;l++){const c=vn(t,l),a=En(t,l);if(Ln(c))a&&(i.push(a),a.min&&(n+=a.min)),s++;else{let e=c;if(a){const o=yn(t,e),r=xn(a,o);o!==r&&(e=`${r}px`),n+=r}r.push(e)}if(e&&n>o)return"0px"}if(i.length&&r.length){const n=(o-yn(t,`calc(${r.map((t=>"number"==typeof t?`${t}px`:t)).join(" + ")})`))/s;if(i.forEach((t=>{t.min&&n<t.min?(r.push(t.minDef),s--):t.max&&t.max<n&&(r.push(t.maxDef),s--)})),e&&s<=0)return`${n}px`}if(r.length){const t=[];let e=0;return r.forEach((o=>{"number"==typeof o?e+=o:t.push(o)})),t.push(`${e}px`),`calc((100% - (${t.join(" + ")})) / ${s})`}return 100/s+"%"}function Bn(t,e){return Ln(e)?yn(t,Rn(t)):yn(t,e)}function In(t,e){return bn(t,e,Bn(t,vn(t,e)))}function Sn(t,e,o){null!=o?t[cn].colWidthsMap.put(e,o):t[cn].colWidthsMap.remove(e)}function Tn(t,e,o){const n=Bn(t,t.defaultColWidth);let r=n*(o-e+1);t[cn].colWidthsMap.each(e,o,((e,o)=>{r+=bn(t,o,Bn(t,e))-n}));for(let s=e;s<=o;s++){if(t[cn].colWidthsMap.has(s))continue;const e=bn(t,s,n);e!==n&&(r+=e-n)}return r}function kn(t){const e=this.getRowHeightInternal(t);if(null!=e)return e;const o=this[cn].rowHeightsMap.get(t);return o||this[cn].defaultRowHeight}function An(t,e){const o=this.getRowsHeightInternal(t,e);if(null!=o)return o;const n=e-t+1;let r=this[cn].defaultRowHeight*n;return this[cn].rowHeightsMap.each(t,e,(t=>{r+=t-this[cn].defaultRowHeight})),r}function On(t){const e=this.getScrollHeightInternal(t);if(null!=e)return e;let o=this[cn].defaultRowHeight*this[cn].rowCount;return this[cn].rowHeightsMap.each(0,this[cn].rowCount-1,(t=>{o+=t-this[cn].defaultRowHeight})),o}function Mn(t){const{shiftKey:e}=t,o=sn(t),n=e?this.selection.focus:this.selection.select;if(37===o){if(t.ctrlKey||t.metaKey)r(this,null,"W");else if(!i.call(this,"W"))return;ln(t)}else if(38===o){if(t.ctrlKey||t.metaKey)r(this,"N",null);else if(!s.call(this,"N"))return;ln(t)}else if(39===o){if(t.ctrlKey||t.metaKey)r(this,null,"E");else if(!i.call(this,"E"))return;ln(t)}else if(40===o){if(t.ctrlKey||t.metaKey)r(this,"S",null);else if(!s.call(this,"S"))return;ln(t)}else if(36===o)t.ctrlKey||t.metaKey?r(this,"N","W"):r(this,null,"W"),ln(t);else if(35===o)t.ctrlKey||t.metaKey?r(this,"S","E"):r(this,null,"E"),ln(t);else if(this.keyboardOptions?.moveCellOnTab&&9===o){if(e){if(!i.call(this,"W",!1)){const t=this.getMoveUpRowByKeyDownInternal(n);if(0>t)return;Dn.call(this,this.colCount-1,t,!1)}}else if(!i.call(this,"E",!1)){const t=this.getMoveDownRowByKeyDownInternal(n);if(this.rowCount<=t)return;Dn.call(this,0,t,!1)}ln(t)}else if(this.keyboardOptions?.moveCellOnEnter&&13===o){if(e){if(!s.call(this,"N",!1)){const t=this.getMoveLeftColByKeyDownInternal(n);if(0>t)return;Dn.call(this,t,this.rowCount-1,!1)}}else if(!s.call(this,"S",!1)){const t=this.getMoveRightColByKeyDownInternal(n);if(this.colCount<=t)return;Dn.call(this,t,Math.min(this.frozenRowCount,this.rowCount-1),!1)}ln(t)}else this.keyboardOptions?.selectAllOnCtrlA&&65===o&&(t.ctrlKey||t.metaKey)&&(this.selection.range={start:{col:0,row:0},end:{col:this.colCount-1,row:this.rowCount-1}},this.invalidate(),ln(t));function r(t,o,r){const s="S"===o?t.rowCount-1:"N"===o?0:n.row,i="E"===r?t.colCount-1:"W"===r?0:n.col;Dn.call(t,i,s,e)}function s(t,o=e){const{col:r}=n;let s;if("S"===t){if(s=this.getMoveDownRowByKeyDownInternal(n),this.rowCount<=s)return this.makeVisibleCell(r,this.rowCount-1),!1}else if(s=this.getMoveUpRowByKeyDownInternal(n),s<0)return this.makeVisibleCell(r,0),!1;return Dn.call(this,r,s,o),!0}function i(t,o=e){const{row:r}=n;let s;if("E"===t){if(s=this.getMoveRightColByKeyDownInternal(n),this.colCount<=s)return this.makeVisibleCell(this.colCount-1,r),!1}else if(s=this.getMoveLeftColByKeyDownInternal(n),s<0)return this.makeVisibleCell(0,r),!1;return Dn.call(this,s,r,o),!0}}function Dn(t,e,o){const n=this.getOffsetInvalidateCells();function r(t){return n>0&&(t.start.col-=n,t.start.row-=n,t.end.col+=n,t.end.row+=n),t}const s=r(this.selection.range),i=this.getCellRangeRect(s);this.selection._setFocusCell(t,e,o),this.makeVisibleCell(t,e),this.focusCell(t,e);const l=r(this.selection.range),c=this.getCellRangeRect(l);if(c.intersection(i)){mn(this,tn.max(c,i))}else mn(this,i),mn(this,c)}function Fn(){const{focusControl:t}=this[cn],{col:e,row:o}=this[cn].selection.select,r=this.fireListeners(I.EDITABLEINPUT_CELL,{col:e,row:o}),s=n.findIndex(r,(t=>!!t))>=0;t.editMode=s,s&&(t.storeInputStatus(),t.setDefaultInputStatus(),this.fireListeners(I.MODIFY_STATUS_EDITABLEINPUT_CELL,{col:e,row:o,input:t.input}))}function Wn(t,e){let o;o=nn(e)?e.changedTouches[0]:e;const n=o.clientX||o.pageX+window.scrollX,r=o.clientY||o.pageY+window.scrollY,s=t[cn].canvas.getBoundingClientRect();if(s.right<=n)return null;if(s.bottom<=r)return null;return{x:n-s.left+t[cn].scroll.left,y:r-s.top+t[cn].scroll.top}}function Pn(){const t=this,{handler:e,element:o,scrollable:r}=t[cn],s=e=>{const o=Wn(t,e);if(!o)return{};const n=t.getCellAt(o.x,o.y);if(n.col<0||n.row<0)return{abstractPos:o,cell:n};return{abstractPos:o,cell:n,eventArgs:{col:n.col,row:n.row,event:e}}},i=e=>{if(t[cn].disableColumnResize)return!1;const o=t[cn].colWidthsLimit[e];return!(o&&o.min&&o.max)||o.max!==o.min};e.on(o,"mousedown",(e=>{const o=s(e),{abstractPos:r,eventArgs:l}=o;if(!r)return;if(l){const e=t.fireListeners(I.MOUSEDOWN_CELL,l);if(n.findIndex(e,(t=>!t))>=0)return}if(1!==rn(e)&&0!==e.buttons)return;const c=Hn(t,r.x,r.y);c>=0&&i(c)?t[cn].columnResizer.start(c,e):t[cn].cellSelector.start(e)})),e.on(o,"mouseup",(e=>{if(!t.hasListeners(I.MOUSEUP_CELL))return;const{eventArgs:o}=s(e);o&&t.fireListeners(I.MOUSEUP_CELL,o)}));let l=null,c=null,a=null;function h(){a&&(null!=a.timeoutId&&clearTimeout(a.timeoutId),a.timeoutId=setTimeout((()=>{a=null}),350))}function u(t){c&&(clearTimeout(c),c=null)}e.on(o,"touchstart",(e=>{null!=a?.timeoutId&&clearTimeout(a.timeoutId),a={};const{eventArgs:o}=s(e);if(o&&t.fireListeners(I.TOUCHSTART_CELL,o),l){if(o&&o.col===l.col&&o.row===l.row&&t.fireListeners(I.DBLTAP_CELL,o),l=null,e.defaultPrevented)return}else l=o,setTimeout((()=>{l=null}),350);e.targetTouches.length>1||(c=setTimeout((()=>{c=null;const o=Wn(t,e);if(!o)return;const n=Hn(t,o.x,o.y,15);n>=0&&i(n)?t[cn].columnResizer.start(n,e):t[cn].cellSelector.start(e)}),500))})),e.on(o,"touchcancel",(t=>{u(),h()})),e.on(o,"touchmove",u),e.on(o,"touchend",(e=>{h(),c&&(clearTimeout(c),t[cn].cellSelector.select(e),c=null)}));let d=!1,g=null,f=null;function _(e,o){t.fireListeners(I.MOUSEENTER_CELL,{col:e.col,row:e.row,related:o}),g=e}function C(e){const o=g;return g=null,o&&t.fireListeners(I.MOUSELEAVE_CELL,{col:o.col,row:o.row,related:e}),o||void 0}function p(e,o){t.fireListeners(I.MOUSEOVER_CELL,{col:e.col,row:e.row,related:o}),f=e}function w(e){const o=f;return f=null,o&&t.fireListeners(I.MOUSEOUT_CELL,{col:o.col,row:o.row,related:e}),o||void 0}const m=r.getElement();e.on(m,"mouseover",(t=>{d=!0})),e.on(m,"mouseout",(t=>{d=!1,w()})),e.on(o,"mouseleave",(t=>{C()})),e.on(o,"mousemove",(e=>{if(a)return;const n=s(e),{abstractPos:r,eventArgs:l}=n;if(l){const e=g;if(e)if(t.fireListeners(I.MOUSEMOVE_CELL,l),e.col!==l.col||e.row!==l.row){const t={col:l.col,row:l.row},e=w(t);_(t,C(t)),d&&p(t,e)}else d&&!f&&p({col:l.col,row:l.row});else{const e={col:l.col,row:l.row};_(e),d&&p(e),t.fireListeners(I.MOUSEMOVE_CELL,l)}}else w(),C();if(t[cn].columnResizer.moving(e)||t[cn].cellSelector.moving(e))return;const{style:c}=o;if(!r)return void("col-resize"===c.cursor&&(c.cursor=""));const h=Hn(t,r.x,r.y);h>=0&&i(h)?c.cursor="col-resize":"col-resize"===c.cursor&&(c.cursor="")})),e.on(o,"click",(e=>{if(t[cn].columnResizer.lastMoving(e)||t[cn].cellSelector.lastMoving(e))return;if(!t.hasListeners(I.CLICK_CELL))return;const{eventArgs:o}=s(e);o&&t.fireListeners(I.CLICK_CELL,o)})),e.on(o,"contextmenu",(e=>{if(!t.hasListeners(I.CONTEXTMENU_CELL))return;const{eventArgs:o}=s(e);o&&t.fireListeners(I.CONTEXTMENU_CELL,o)})),e.on(o,"dblclick",(e=>{if(!t.hasListeners(I.DBLCLICK_CELL))return;const{eventArgs:o}=s(e);o&&t.fireListeners(I.DBLCLICK_CELL,o)})),t[cn].focusControl.onKeyDown((e=>{t.fireListeners(I.KEYDOWN,e)})),t[cn].selection.listen(I.SELECTED_CELL,(e=>{t.fireListeners(I.SELECTED_CELL,e,e.selected)})),r.onScroll((e=>{!function(t,e){const o=t[cn].scroll.left,n=t[cn].scroll.top,r=t[cn].scrollable.scrollLeft-o,s=t[cn].scrollable.scrollTop-n;t[cn].scroll={left:t[cn].scrollable.scrollLeft,top:t[cn].scrollable.scrollTop};const{focus:i}=t[cn].selection,l=t.isFrozenCell(i.col,i.row);l&&(l?.col&&r||l?.row&&s)&&t.setFocusCursor(i.col,i.row);const c=zn(t);if(Math.abs(r)>=c.width||Math.abs(s)>=c.height)mn(t,c);else{if(t[cn].context.drawImage(t[cn].canvas,-r,-s),0!==r){const e=c.copy();if(r<0){if(e.width=-r,t[cn].frozenColCount>0){const o=_n(t);e.width+=o.width}}else r>0&&(e.left=e.right-r);mn(t,e),r>0&&t[cn].frozenColCount>0&&mn(t,_n(t))}if(0!==s){const e=c.copy();if(s<0){if(e.height=-s,t[cn].frozenRowCount>0){const o=fn(t);e.height+=o.height}}else s>0&&(e.top=e.bottom-s);mn(t,e),s>0&&t[cn].frozenRowCount>0&&mn(t,fn(t))}}}(t),t.fireListeners(I.SCROLL,{event:e})})),t[cn].focusControl.onKeyDownMove((e=>{Mn.call(t,e)})),t.listen("copydata",(e=>{const o=t.getCopyRangeInternal(e);let n="";for(let{row:e}=o.start;e<=o.end.row;e++){for(let{col:r}=o.start;r<=o.end.col;r++){const s=t.getCopyCellValue(r,e,o);let i;"string"==typeof s?i=s:null==s||"undefined"!=typeof Promise&&s instanceof Promise?i="":(i=`${s}`,/^\[object .*\]$/.exec(i)&&(i="")),n+=/[\t\n]/.test(i)?`"${i.replace(/"/g,'""')}"`:i,r<o.end.col&&(n+="\t")}n+="\n"}return n})),t[cn].focusControl.onCopy((e=>n.find(t.fireListeners("copydata",t[cn].selection.range),(t=>null!=t)))),t[cn].focusControl.onPaste((({value:e,event:o})=>{const{trimOnPaste:n}=t,r=Jo(e),{col:s,row:i}=t[cn].selection.select,l=/[\r\n\u2028\u2029\t]/.test(r);let c=null;const a={col:s,row:i,value:e,normalizeValue:n?r.trim():r,multi:l,get rangeBoxValues(){return c??(c=Zo(r,{trimOnPaste:n}))},event:o};t.fireListeners(I.PASTE_CELL,a)})),t[cn].focusControl.onInput((e=>{const{col:o,row:n}=t[cn].selection.select;t.fireListeners(I.INPUT_CELL,{col:o,row:n,value:e})})),t[cn].focusControl.onDelete((e=>{const{col:o,row:n}=t[cn].selection.select;t.fireListeners(I.DELETE_CELL,{col:o,row:n,event:e})})),t[cn].focusControl.onFocus((e=>{t.fireListeners(I.FOCUS_GRID,e),t[cn].focusedGrid=!0;const{col:o,row:n}=t[cn].selection.select;t.invalidateCell(o,n)})),t[cn].focusControl.onBlur((e=>{t.fireListeners(I.BLUR_GRID,e),t[cn].focusedGrid=!1;const{col:o,row:n}=t[cn].selection.select;t.invalidateCell(o,n)}))}function Hn(t,e,o,n=5){if(t[cn].frozenRowCount<=0)return-1;if(!fn(t).inPoint(e,o))return-1;const r=t.getCellAt(e,o),s=t.getCellRect(r.col,r.row);return e<s.left+n?r.col-1:s.right-n<e?r.col:-1}function zn(t){const{scroll:{left:e,top:o},canvas:{width:n,height:r}}=t[cn];return new tn(e,o,n,r)}function Vn(t,e){const o=e.copy(),n=zn(t);return o.offsetLeft(-n.left),o.offsetTop(-n.top),o}class $n{_grid;_handler;_events;_started;_moved;_mouseEndPoint;constructor(t){this._grid=t,this._handler=new nt,this._events={},this._started=!1,this._moved=!1}moving(t){return!!this._started}lastMoving(t){if(this.moving(t))return!0;const e=this._mouseEndPoint;if(!e)return!1;const o=Wn(this._grid,t);return null!=o&&o.x===e.x&&o.y===e.y}_bindMoveAndUp(t){const e=this._events,o=this._handler;nn(t)?(e.touchmove=o.on(document.body,"touchmove",(t=>this._mouseMove(t)),{passive:!1}),e.touchend=o.on(document.body,"touchend",(t=>this._mouseUp(t))),e.touchcancel=o.on(document.body,"touchcancel",(t=>this._mouseUp(t)))):(e.mousemove=o.on(document.body,"mousemove",(t=>this._mouseMove(t))),e.mouseup=o.on(document.body,"mouseup",(t=>this._mouseUp(t)))),this._started=!0,this._moved=!1}_mouseMove(t){nn(t)||1===rn(t)?(this._moved=this._moveInternal(t)||this._moved,ln(t)):this._mouseUp(t)}_moveInternal(t){return!1}_mouseUp(t){const e=this._events,o=this._handler;o.off(e.mousemove),o.off(e.touchmove),o.off(e.mouseup),o.off(e.touchend),o.off(e.touchcancel),this._started=!1,this._upInternal(t),this._moved&&(this._mouseEndPoint=Wn(this._grid,t),setTimeout((()=>{this._mouseEndPoint=null}),10))}_upInternal(t){}dispose(){this._handler.dispose()}}class Nn extends $n{_cell;start(t){const e=this._getTargetCell(t);e&&(Dn.call(this._grid,e.col,e.row,t.shiftKey),this._bindMoveAndUp(t),this._cell=e,ln(t),an(t))}select(t){const e=this._getTargetCell(t);e&&(Dn.call(this._grid,e.col,e.row,t.shiftKey),this._cell=e)}_moveInternal(t){const e=this._getTargetCell(t);if(!e)return!1;const{col:o,row:n}=this._cell,{col:r,row:s}=e;if(o===r&&n===s)return!1;const i=this._grid;Dn.call(i,r,s,!0);const l=r<o&&0<r?r-1:o<r&&r+1<i.colCount?r+1:r,c=s<n&&0<s?s-1:n<s&&s+1<i.rowCount?s+1:s;return l===r&&c===s||i.makeVisibleCell(l,c),this._cell=e,!0}_getTargetCell(t){const e=this._grid,o=Wn(e,t);if(!o)return null;const n=e.getCellAt(o.x,o.y);return n.col<0||n.row<0?null:n}}class Un extends $n{_targetCol;_x=-1;_preX=-1;_invalidateAbsoluteLeft=-1;constructor(t){super(t),this._targetCol=-1}start(t,e){let o;nn(e)?({pageX:o}=e.changedTouches[0]):({pageX:o}=e),this._x=o,this._preX=0,this._bindMoveAndUp(e),this._targetCol=t,this._invalidateAbsoluteLeft=Tn(this._grid,0,t-1),ln(e),an(e)}_moveInternal(t){const e=(nn(t)?t.changedTouches[0].pageX:t.pageX)-this._x,o=e-this._preX;this._preX=e;const n=this._grid.getColWidth(this._targetCol);let r=bn(this._grid,this._targetCol,n+o);r<10&&o<0&&(r=10),function(t){let e=null;for(let o=0;o<t[cn].colCount;o++)Ln(vn(t,o))&&Sn(t,o,e||(e=Rn(t,!1)))}(this._grid),Sn(this._grid,this._targetCol,r);const s=zn(this._grid);return s.left=this._invalidateAbsoluteLeft,mn(this._grid,s),this._grid.fireListeners(I.RESIZE_COLUMN,{col:this._targetCol}),!0}_upInternal(t){const e=this._grid;e.updateScroll()&&e.invalidate()}}function jn(t,e){const{type:o}=t;t.type="",t.value=e,o&&(t.type=o)}const Kn=["style","readonly"];class Gn extends kt{_grid;_scrollable;_handler;_input;_isComposition;_compositionEnd;_inputStatus;_keyDownMoveCallback;constructor(t,e,o,r){super(),this._grid=t,this._scrollable=o;const s=this._handler=new nt,i=this._input=document.createElement("input");let l;i.classList.add("grid-focus-control"),i.readOnly=!0,e.appendChild(i),s.on(i,"compositionstart",(e=>{i.classList.add("composition"),i.style.font=t.font||"16px sans-serif",this._isComposition=!0,this._compositionEnd&&(clearTimeout(this._compositionEnd),delete this._compositionEnd),t.focus()}));const c=t=>{l=i.value,this._isComposition||(""!==l&&jn(i,""),t||(l=""))},a=()=>{this._isComposition=!1,i.classList.remove("composition"),i.style.font="";const{value:t}=i;c(!1),i.readOnly||this.fireListeners("input",t),this._compositionEnd&&(clearTimeout(this._compositionEnd),delete this._compositionEnd)};s.on(i,"compositionend",(t=>{this._compositionEnd=setTimeout(a,1)})),r.listen("before_hook",(()=>{this._compositionEnd&&a()})),s.on(i,"keypress",(t=>{if(!this._isComposition){if(!i.readOnly&&t.key&&1===t.key.length)if(t.ctrlKey||t.metaKey)"c"===t.key||t.key;else{if(" "===t.key)return;this.fireListeners("input",t.key),ln(t)}c(!0)}})),s.on(i,"keydown",(t=>{if(this._isComposition)return void(this._compositionEnd&&(a(),ln(t)));const e=sn(t);let o=!1;const n={keyCode:e,event:t,stopCellMoving(){o=!0}};this.fireListeners("keydown",n),!i.readOnly&&l&&this.fireListeners("input",l),o||this.fireKeyDownMove(e,t),!this._grid.keyboardOptions?.deleteCellValueOnDel||46!==e&&8!==e||this.fireListeners("delete",t),c(!0)})),s.on(i,"keyup",(t=>{this._isComposition&&this._compositionEnd&&a(),c(!0)})),s.on(i,"input",(t=>{" "!==t.data&&"ã€€"!==t.data||this.fireListeners("input",t.data),c(!0)})),y&&s.on(document,"keydown",(t=>{if(t.target!==i)return;const e=sn(t);67===e&&t.ctrlKey?(jn(i,"dummy"),i.select(),setTimeout((()=>{jn(i,"")}),100)):86===e&&t.ctrlKey&&i.readOnly&&(i.readOnly=!1,setTimeout((()=>{i.readOnly=!0,jn(i,"")}),10))})),b&&s.once(document,"keydown",(o=>{if(!d(e,o.target))return;const n=document.createElement("input");t.getElement().appendChild(n),n.focus(),i.focus(),n.parentElement?.removeChild(n)})),s.on(document,"paste",(t=>{if(!d(e,t.target))return;let o;if(y)o=window.clipboardData.getData("Text");else{const{clipboardData:e}=t;e.items?o=e.getData("text/plain"):-1!==Array.prototype.indexOf.call(e.types,"text/plain")&&(o=e.getData("Text"))}null!=o&&o.length&&this.fireListeners("paste",{value:o,event:t})})),s.on(document,"copy",(t=>{if(this._isComposition)return;if(!d(e,t.target))return;jn(i,"");const o=n.find(this.fireListeners("copy"),(t=>null!=t));null!=o&&(ln(t),y?window.clipboardData.setData("Text",o):t.clipboardData.setData("text/plain",o))})),s.on(i,"focus",(t=>{this.fireListeners("focus",t)})),s.on(i,"blur",(t=>{this.fireListeners("blur",t)}))}fireKeyDownMove(t,e){const o=this._keyDownMoveCallback;o&&(this._isComposition||(37===t||38===t||39===t||40===t||36===t||35===t||this._grid.keyboardOptions?.moveCellOnTab&&9===t||this._grid.keyboardOptions?.moveCellOnEnter&&13===t||this._grid.keyboardOptions?.selectAllOnCtrlA&&65===t&&(e.ctrlKey||e.metaKey))&&o(e))}onKeyDownMove(t){this._keyDownMoveCallback=t}onKeyDown(t){return this.listen("keydown",t)}onInput(t){return this.listen("input",t)}onDelete(t){return this.listen("delete",t)}onCopy(t){return this.listen("copy",t)}onPaste(t){return this.listen("paste",t)}onFocus(t){return this.listen("focus",t)}onBlur(t){return this.listen("blur",t)}focus(){this._input.focus()}setFocusRect(t){const e=this._input,o=this._scrollable.calcTop(t.top);e.style.top=`${(o-Xo()).toFixed()}px`,e.style.left=`${t.left.toFixed()}px`,e.style.width=`${t.width.toFixed()}px`,e.style.height=`${t.height.toFixed()}px`}get editMode(){return!this._input.readOnly}set editMode(t){this._input.readOnly=!t}resetInputStatus(){const t=this._input;if(!t.classList.contains("grid-focus-control--stored-status"))return;const e=t.classList.contains("composition"),o=t.attributes,n=[];for(let t=0,e=o.length;t<e;t++){const e=o[t];Kn.indexOf(e.name)>=0||(this._inputStatus?.hasOwnProperty(e.nodeName)||n.push(e.name))}n.forEach((e=>{t.removeAttribute(e)}));for(const e in this._inputStatus)t.setAttribute(e,this._inputStatus[e]);e?(t.classList.add("composition"),t.style.font=this._grid.font||"16px sans-serif"):t.classList.remove("composition"),t.classList.remove("grid-focus-control--stored-status")}storeInputStatus(){const t=this._input;if(t.classList.contains("grid-focus-control--stored-status"))return;const e=this._inputStatus={},o=t.attributes;for(let t=0,n=o.length;t<n;t++){const n=o[t];Kn.indexOf(n.name)>=0||(e[n.name]=n.value)}t.classList.add("grid-focus-control--stored-status")}setDefaultInputStatus(){}get input(){return this._input}dispose(){super.dispose(),this._handler.dispose()}}class Yn extends kt{_grid;_sel;_focus;_start;_end;_isWraped;constructor(t){super(),this._grid=t,this._sel={col:0,row:0},this._focus={col:0,row:0},this._start={col:0,row:0},this._end={col:0,row:0}}get range(){const t=this._start,e=this._end;return{start:{col:Math.min(t.col,e.col),row:Math.min(t.row,e.row)},end:{col:Math.max(t.col,e.col),row:Math.max(t.row,e.row)}}}set range(t){this._callBeforeHooks();const e=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.col,t.end.col),r=Math.max(t.start.row,t.end.row);this._wrapFireSelectedEvent((()=>{this._sel={col:e,row:o},this._focus={col:e,row:o},this._start={col:e,row:o},this._end={col:n,row:r},Fn.call(this._grid)}))}get focus(){const{col:t,row:e}=this._focus;return{col:t,row:e}}get select(){const{col:t,row:e}=this._sel;return{col:t,row:e}}set select(t){this._callBeforeHooks(),this._wrapFireSelectedEvent((()=>{const{col:e=0,row:o=0}=t;this._setSelectCell(e,o),this._setFocusCell(e,o,!0,!0),Fn.call(this._grid)}))}_setSelectCell(t,e){this._wrapFireSelectedEvent((()=>{this._sel={col:t,row:e},this._start={col:t,row:e}}))}_setFocusCell(t,e,o,n){n||this._callBeforeHooks(),this._wrapFireSelectedEvent((()=>{o||this._setSelectCell(t,e),this._focus={col:t,row:e},this._end={col:t,row:e}}))}_wrapFireSelectedEvent(t){if(this._isWraped)t();else{this._isWraped=!0;try{const e={col:this._sel.col,row:this._sel.row,selected:!1,after:null};t();const o={col:this._sel.col,row:this._sel.row,selected:!0,before:{col:e.col,row:e.row}};e.after={col:o.col,row:o.row},this.fireListeners(I.SELECTED_CELL,e),this.fireListeners(I.SELECTED_CELL,o)}finally{this._isWraped=!1}}}_updateGridRange(){const{rowCount:t,colCount:e}=this._grid,o=[this._sel,this._focus,this._start,this._end];let n=!1;for(let r=0;r<o.length;r++)if(e<=o[r].col||t<=o[r].row){n=!0;break}return!!n&&(this._wrapFireSelectedEvent((()=>{o.forEach((o=>{o.col=Math.min(e-1,o.col),o.row=Math.min(t-1,o.row)}))})),!0)}_callBeforeHooks(){this.fireListeners("before_hook")}}class qn{_layers;constructor(){this._layers={}}addDraw(t,e){(this._layers[t]||(this._layers[t]=new Xn(t))).addDraw(e)}draw(t){const e=[];for(const t in this._layers)e.push(this._layers[t]);e.sort(((t,e)=>t.level-e.level)),e.forEach((e=>e.draw(t)))}}class Xn{_level;_list;constructor(t){this._level=t,this._list=[]}get level(){return this._level}addDraw(t){this._list.push(t)}draw(t){this._list.forEach((e=>{t.save();try{e(t)}finally{t.restore()}}))}}class Jn{_col;_row;_mode;_ctx;_rect;_drawRect;_drawing;_selection;_drawLayers;_childContexts;_cancel;_grid;_onTerminate;_rectFilter=null;constructor(t,e,o,n,r,s,i,l){this._col=t,this._row=e,this._mode=0,this._ctx=o,this._rect=n,this._drawRect=r,this._drawing=s,this._selection=i,this._drawLayers=l,this._childContexts=[]}get drawing(){return 0!==this._mode||this._drawing}get row(){return this._row}get col(){return this._col}cancel(){this._cancel=!0,this._childContexts.forEach((t=>{t.cancel()}))}getSelection(){return{select:this._selection.select,range:this._selection.range}}getContext(){return 0===this._mode?this._ctx:wn.call(this._grid)}getRect(){const t=this._rectFilter;return t?t(this._getRectInternal()):this._getRectInternal()}setRectFilter(t){this._rectFilter=t}getDrawRect(){if(this._cancel)return null;if(0===this._mode)return this._drawRect;{if(this._isOutOfRange())return null;const t=this._grid.getCellRect(this._col,this._row);return this._toRelativeDrawRect(t)}}_isOutOfRange(){const{colCount:t,rowCount:e}=this._grid;return t<=this._col||e<=this._row}toCurrentContext(){if(0===this._mode)return this;{const t=this._grid.getCellRect(this._col,this._row),e=Vn(this._grid,t),o=this._isOutOfRange()?null:this._toRelativeDrawRect(t),n=new Jn(this._col,this._row,this.getContext(),e,o,this.drawing,this._selection,this._drawLayers);return n.toCurrentContext=this.toCurrentContext.bind(this),this._childContexts.push(n),this._cancel&&n.cancel(),n._rectFilter=this._rectFilter,n}}addLayerDraw(t,e){this._drawLayers.addDraw(t,e)}_toRelativeDrawRect(t){const e=zn(this._grid);let o=t.copy();if(!o.intersection(e))return null;const n=this._grid,r=n.isFrozenCell(this._col,this._row);if(n.frozenColCount>=0&&(!r||!r.col)){const t=n.getCellRect(n.frozenColCount-1,this._row);o=tn.bounds(Math.max(o.left,t.right),o.top,o.right,o.bottom)}if(n.frozenRowCount>=0&&(!r||!r.row)){const t=n.getCellRect(this._col,n.frozenRowCount-1);o=tn.bounds(o.left,Math.max(o.top,t.bottom),o.right,o.bottom)}return o.intersection(e)?(o.offsetLeft(-e.left),o.offsetTop(-e.top),o):null}_delayMode(t,e){this._mode=1,this._ctx=null,this._rect=null,this._drawRect=null,this._grid=t,this._onTerminate=e}terminate(){0!==this._mode&&this._onTerminate?.()}_getRectInternal(){return 0===this._mode||this._rect?this._rect:this._grid.getCellRelativeRect(this._col,this._row)}}const Zn=cn;class Qn extends kt{[Zn];static get EVENT_TYPE(){return I}constructor(t={}){super();const{rowCount:e=10,colCount:o=10,frozenColCount:n=0,frozenRowCount:r=0,defaultRowHeight:s=40,defaultColWidth:i=80,font:l,underlayBackgroundColor:c,keyboardOptions:a,parentElement:h,disableColumnResize:u,trimOnPaste:d}=t,g=this[cn]={};qo(),qo=Function.prototype,g.element=function(){const t=document.createElement("div");return t.classList.add("cheetah-grid"),t}(),g.scrollable=new on,g.handler=new nt,g.selection=new Yn(this),g.focusControl=new Gn(this,g.scrollable.getElement(),g.scrollable,g.selection),g.canvas=function(t){const e=t.getContext("2d"),{getAttribute:o,setAttribute:n}=t;t.getAttribute=function(t){let e=o.call(this,t);return"width"!==t&&"height"!==t||(e=""+Number(e)/Go),e},t.setAttribute=function(t,o){const r="width"===t||"height"===t;r&&(o=""+Number(o)*Go);const s=n.call(this,t,o);return r&&e.scale(Go,Go),s},Object.defineProperty(t,"width",{get:()=>Number(t.getAttribute("width")),set:e=>{t.setAttribute("width",`${Math.floor(e)}`)},configurable:!0,enumerable:!0}),Object.defineProperty(t,"height",{get:()=>Number(t.getAttribute("height")),set:e=>{t.setAttribute("height",`${Math.floor(e)}`)},configurable:!0,enumerable:!0});const{drawImage:r}=e;return e.drawImage=function(e,...o){if(e!==t||1===Go)return r.call(this,e,...o);this.save();try{return this.scale(1/Go,1/Go),o.length>4?(o[4]*=Go,o[5]*=Go):(o[0]*=Go,o[1]*=Go),r.call(this,e,...o)}finally{this.restore()}},t}(document.createElement("canvas")),g.context=g.canvas.getContext("2d",{alpha:!1}),g.rowCount=e,g.colCount=o,g.frozenColCount=n,g.frozenRowCount=r,g.defaultRowHeight=s,g.defaultColWidth=i,g.font=l,g.underlayBackgroundColor=c,g.keyboardOptions=a,g.disableColumnResize=u,g.trimOnPaste=d??!1,g.rowHeightsMap=new Qo,g.colWidthsMap=new Qo,g.colWidthsLimit={},g.calcWidthContext={_:g,get full(){return this._.canvas.width},get em(){return He(this._.context,this._.font).width}},g.columnResizer=new Un(this),g.cellSelector=new Nn(this),g.drawCells={},g.cellTextOverflows={},g.focusedGrid=!1,g.element.appendChild(g.canvas),g.element.appendChild(g.scrollable.getElement()),g.scroll={left:0,top:0},this.updateScroll(),h?(h.appendChild(g.element),this.updateSize()):this.updateSize(),Pn.call(this),this.bindEventsInternal()}getElement(){return this[cn].element}get canvas(){return this[cn].canvas}focus(){const{col:t,row:e}=this[cn].selection.select;this.focusCell(t,e)}hasFocusGrid(){return this[cn].focusedGrid}get selection(){return this[cn].selection}get rowCount(){return this[cn].rowCount}set rowCount(t){if(this[cn].rowCount=t,this.updateScroll(),this[cn].selection._updateGridRange()){const{col:t,row:e}=this[cn].selection.focus;this.makeVisibleCell(t,e),this.setFocusCursor(t,e)}}get colCount(){return this[cn].colCount}set colCount(t){if(this[cn].colCount=t,this.updateScroll(),this[cn].selection._updateGridRange()){const{col:t,row:e}=this[cn].selection.focus;this.makeVisibleCell(t,e),this.setFocusCursor(t,e)}}get frozenColCount(){return this[cn].frozenColCount}set frozenColCount(t){this[cn].frozenColCount=t}get frozenRowCount(){return this[cn].frozenRowCount}set frozenRowCount(t){this[cn].frozenRowCount=t}get defaultRowHeight(){return this[cn].defaultRowHeight}set defaultRowHeight(t){this[cn].defaultRowHeight=t}get defaultColWidth(){return this[cn].defaultColWidth}set defaultColWidth(t){this[cn].defaultColWidth=t}get font(){return this[cn].font}set font(t){this[cn].font=t}get underlayBackgroundColor(){return this[cn].underlayBackgroundColor}set underlayBackgroundColor(t){this[cn].underlayBackgroundColor=t}get trimOnPaste(){return this[cn].trimOnPaste}set trimOnPaste(t){this[cn].trimOnPaste=t}get keyboardOptions(){return this[cn].keyboardOptions??null}set keyboardOptions(t){this[cn].keyboardOptions=t??void 0}configure(t,e){const o=this[cn].config||(this[cn].config={});return null!=e&&(o[t]=e),o[t]}updateSize(){const{canvas:t}=this[cn];t.style.width="",t.style.height="";const e=Math.floor(t.offsetWidth||t.parentElement.offsetWidth-Xo()),o=Math.floor(t.offsetHeight||t.parentElement.offsetHeight-Xo());t.width=e,t.height=o,t.style.width=`${e}px`,t.style.height=`${o}px`;const n=this[cn].selection.select;this[cn].focusControl.setFocusRect(this.getCellRect(n.col,n.row))}updateScroll(){const{scrollable:t}=this[cn],e=On.call(this),o=Tn(n=this,0,n[cn].colCount-1);var n;return(e!==t.scrollHeight||o!==t.scrollWidth)&&(t.setScrollSize(o,e),this[cn].scroll={left:t.scrollLeft,top:t.scrollTop},!0)}getRowHeight(t){return kn.call(this,t)}setRowHeight(t,e){!function(t,e,o){null!=o?t[cn].rowHeightsMap.put(e,o):t[cn].rowHeightsMap.remove(e)}(this,t,e)}getColWidth(t){return In(this,t)}setColWidth(t,e){Sn(this,t,e)}getMaxColWidth(t){const e=this[cn].colWidthsLimit[t];return e&&e.max||void 0}setMaxColWidth(t,e){const o=this[cn].colWidthsLimit[t]||(this[cn].colWidthsLimit[t]={});null!=e?o.max=e:delete o.max}getMinColWidth(t){const e=this[cn].colWidthsLimit[t];return e&&e.min||void 0}setMinColWidth(t,e){const o=this[cn].colWidthsLimit[t]||(this[cn].colWidthsLimit[t]={});null!=e?o.min=e:delete o.min}getCellRect(t,e){const o=this.isFrozenCell(t,e);let n=Tn(this,0,t-1);const r=In(this,t);o&&o.col&&(n+=this[cn].scroll.left);let s=An.call(this,0,e-1);const i=kn.call(this,e);return o&&o.row&&(s+=this[cn].scroll.top),new tn(n,s,r,i)}getCellRelativeRect(t,e){return Vn(this,this.getCellRect(t,e))}getCellsRect(t,e,o,n){const r=this.isFrozenCell(t,e),s=this.isFrozenCell(o,n);let i=Tn(this,0,t-1),l=Tn(this,t,o);if(r&&r.col){const e=this[cn].scroll.left;i+=e,s&&s.col||(l-=e,l=Math.max(l,Tn(this,t,this.frozenColCount-1)))}let c=An.call(this,0,e-1),a=An.call(this,e,n);if(r&&r.row){const t=this[cn].scroll.top;c+=t,s&&s.row||(a-=t,a=Math.max(a,Tn(this,e,this.frozenRowCount-1)))}return new tn(i,c,l,a)}getCellRangeRect(t){return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row)}isFrozenCell(t,e){const{frozenRowCount:o,frozenColCount:n}=this[cn],r=o>0&&e<o,s=n>0&&t<n;return r||s?{row:r,col:s}:null}getRowAt(t){const e=dn(this,t);if(e)return e.row;const o=hn.call(this,t);return o?o.row:-1}getColAt(t){const e=gn(this,t);if(e)return e.col;const o=un(this,t);return o?o.col:-1}getCellAt(t,e){return{row:this.getRowAt(e),col:this.getColAt(t)}}makeVisibleCell(t,e){const o=this.isFrozenCell(t,e);if(o&&o.col&&o.row)return;const n=this.getCellRect(t,e),r=function(t){let e=0;t[cn].frozenColCount>0&&(e=_n(t).width);let o=0;t[cn].frozenRowCount>0&&(o=fn(t).height);return new tn(t[cn].scrollable.scrollLeft+e,t[cn].scrollable.scrollTop+o,t[cn].canvas.width-e,t[cn].canvas.height-o)}(this);if(r.contains(n))return;const{scrollable:s}=this[cn];o&&o.col||(n.left<r.left?s.scrollLeft-=r.left-n.left:r.right<n.right&&(s.scrollLeft-=r.right-n.right)),o&&o.row||(n.top<r.top?s.scrollTop-=r.top-n.top:r.bottom<n.bottom&&(s.scrollTop-=r.bottom-n.bottom))}setFocusCursor(t,e){const{focusControl:o}=this[cn],n=o.editMode;o.setFocusRect(this.getCellRect(t,e)),Fn.call(this),n&&!o.editMode&&o.resetInputStatus()}focusCell(t,e){this.setFocusCursor(t,e),this[cn].focusControl.focus()}invalidateCell(t,e){this.invalidateGridRect(t,e)}invalidateGridRect(t,e,o=t,n=e){const r=this.getOffsetInvalidateCells();r>0&&(t-=r,e-=r,o+=r,n+=r);const s=zn(this),i=this.getCellsRect(t,e,o,n),l=s.intersection(i);if(l){const{frozenColCount:t,frozenRowCount:e}=this[cn];if(t>0&&o>=t){const t=_n(this);t.intersection(l)&&(l.left=Math.min(t.right-1,l.left))}if(e>0&&n>=e){const t=fn(this);t.intersection(l)&&(l.top=Math.min(t.bottom-1,l.top))}mn(this,l)}}invalidateCellRange(t){this.invalidateGridRect(t.start.col,t.start.row,t.end.col,t.end.row)}invalidate(){mn(this,zn(this))}get visibleRowCount(){const{frozenRowCount:t}=this,e=zn(this),o=t>0?e.top+An.call(this,0,t-1):e.top,n=hn.call(this,o);if(!n)return 0;const r=Math.max(n.top>=o?n.row:n.row+1,t);let s=An.call(this,0,r-1),i=0;const{rowCount:l}=this;for(let t=r;t<l;t++){const o=s+kn.call(this,t);if(e.bottom<o)break;i++,s=o}return i}get visibleColCount(){const{frozenColCount:t}=this,e=zn(this),o=t>0?e.left+Tn(this,0,t-1):e.left,n=un(this,o);if(!n)return 0;const r=Math.max(n.left>=o?n.col:n.col+1,t);let s=Tn(this,0,r-1),i=0;const{colCount:l}=this;for(let t=r;t<l;t++){const o=s+In(this,t);if(e.right<o)break;i++,s=o}return i}get topRow(){const{frozenRowCount:t}=this,e=zn(this),o=t>0?e.top+An.call(this,0,t-1):e.top,n=hn.call(this,o);return n?Math.max(n.top>=o?n.row:n.row+1,t):0}get leftCol(){const{frozenColCount:t}=this,e=zn(this),o=t>0?e.left+Tn(this,0,t-1):e.left,n=un(this,o);return n?Math.max(n.left>=o?n.col:n.col+1,t):0}get scrollTop(){return this[cn].scrollable.scrollTop}set scrollTop(t){this[cn].scrollable.scrollTop=t}get scrollLeft(){return this[cn].scrollable.scrollLeft}set scrollLeft(t){this[cn].scrollable.scrollLeft=t}getCopyCellValue(t,e,o){}getCellOverflowText(t,e){const o=`${t}:${e}`;return this[cn].cellTextOverflows[o]||null}setCellOverflowText(t,e,o){const n=`${t}:${e}`;o?this[cn].cellTextOverflows[n]="string"==typeof o?o.trim():o:delete this[cn].cellTextOverflows[n]}addDisposable(t){if(!t||!t.dispose||"function"!=typeof t.dispose)throw new Error("not disposable!");(this[cn].disposables=this[cn].disposables||[]).push(t)}dispose(){super.dispose();const t=this[cn];t.handler.dispose(),t.scrollable.dispose(),t.focusControl.dispose(),t.columnResizer.dispose(),t.cellSelector.dispose(),t.disposables&&(t.disposables.forEach((t=>t.dispose())),t.disposables=null);const{parentElement:e}=t.element;e&&e.removeChild(t.element)}getAttachCellsArea(t){return{element:this.getElement(),rect:Vn(this,this.getCellRangeRect(t))}}onKeyDownMove(t){Mn.call(this,t)}bindEventsInternal(){}getTargetRowAtInternal(t){}getRowsHeightInternal(t,e){}getRowHeightInternal(t){}getScrollHeightInternal(t){}getMoveLeftColByKeyDownInternal({col:t}){return t-1}getMoveRightColByKeyDownInternal({col:t}){return t+1}getMoveUpRowByKeyDownInternal({row:t}){return t-1}getMoveDownRowByKeyDownInternal({row:t}){return t+1}getOffsetInvalidateCells(){return 0}getCopyRangeInternal(t){return t}_getInitContext(){const t=this[cn].context;return t.fillStyle="white",t.strokeStyle="black",t.textAlign="left",t.textBaseline="top",t.lineWidth=1,t.font=this.font||"16px sans-serif",t}fireListeners(t,...e){return super.fireListeners(t,...e)}}var tr=Object.freeze({__proto__:null,DrawGrid:Qn,EVENT_TYPE:I});function er(t,e,o){return new Promise((n=>{const r=[],s=new Array(o);for(let e=0;e<o;e++){const o=t(e),n={v:o,f:o};s[e]=n,C(o)&&r.push(o.then((t=>{n.v=t,n.f=t})))}Promise.all(r).then((()=>null==e?s:function(t,e){return new Promise((o=>{const{length:n}=t,r=[];for(let o=0;o<n;o++){const n=t[o],s=e(n.v);C(s)?r.push(s.then((t=>{n.f=t}))):n.f=s}Promise.all(r).then((()=>o(t)))}))}(s,e))).then(n)}))}function or(t,e,o,n,r){const s=function(t,e){const o=new Array(e);for(let n=0;n<e;n++)o[n]=t(n);return o}(t,o);null!=r?s.sort(((t,e)=>n(r(t),r(e)))):s.sort(n);for(let t=0;t<o;t++)e(t,s[t])}function nr(t){return!!(v.isObject(t)&&t.get&&t.set)}const rr={UPDATE_LENGTH:"update_length",UPDATED_LENGTH:"updated_length",UPDATED_ORDER:"updated_order"};function sr(t,e){const o=_(t);if(C(o)){const t=o.then((t=>(e(t),t)));return e(t),t}return o}function ir(t,e,o){if(null==t)return;if(C(t))return t.then((t=>ir(t,e,o)));const n=nr(e)?e.get:e;if(n in t){return sr(t[n],o)}if("function"==typeof n){return sr(n(t),o)}const r=`${n}`.split(".");if(r.length<=1){return sr(t[n],o)}return sr(g(t,((t,e)=>ir(t,e,B)),...r),o)}function lr(t,e,o){if(null==t)return!1;const n=nr(e)?e.set:e;if(n in t)t[n]=o;else{if("function"==typeof n)return n(t,o);if("string"==typeof n){const e=`${n}`.split(".");let r=t;const{length:s}=e;for(let t=0;t<s;t++){const n=e[t];t===s-1?r[n]=o:r=r[n]||(r[n]={})}}else t[n]=o}return!0}function cr(t,e){if(!t)return e;const o=t[e];return null!=o?o:e}class ar extends kt{_get;_length;_source;_sortedIndexMap=null;static get EVENT_TYPE(){return rr}static ofArray(t){return new ar({get:e=>t[e],length:t.length,source:t})}constructor(t){super(),this._get=t?.get.bind(t)||void 0,this._length=t?.length||0,this._source=t?.source??t}get source(){return this._source}get(t){return this.getOriginal(cr(this._sortedIndexMap,t))}getField(t,e){return this.getOriginalField(cr(this._sortedIndexMap,t),e)}hasField(t,e){return this.hasOriginalField(cr(this._sortedIndexMap,t),e)}setField(t,e,o){return this.setOriginalField(cr(this._sortedIndexMap,t),e,o)}sort(t,e){const o=new Array(this._length),n="desc"!==e?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1;return function(t,e,o,n,r){if("undefined"!=typeof Promise)return er(t,r,o).then((t=>{t.sort(((t,e)=>n(t.f,e.f)));for(let n=0;n<o;n++)e(n,t[n].v)}));{or(t,e,o,n,r);const s={then:t=>(t(),s),catch:()=>s};return s}}((t=>null!=o[t]?o[t]:o[t]=t),((t,e)=>{o[t]=e}),this._length,n,(e=>this.getOriginalField(e,t))).then((()=>{this._sortedIndexMap=o,this.fireListeners(rr.UPDATED_ORDER)}))}get length(){return this._length}set length(t){if(this._length===t)return;const e=this.fireListeners(rr.UPDATE_LENGTH,t);n.findIndex(e,(t=>!t))>=0||(this._length=t,this.fireListeners(rr.UPDATED_LENGTH,this._length))}get dataSource(){return this}dispose(){super.dispose()}getOriginal(t){return sr(this._get(t),(e=>{this.recordPromiseCallBackInternal(t,e)}))}getOriginalField(t,e){if(null==e)return;return ir(this.getOriginal(t),e,(o=>{this.fieldPromiseCallBackInternal(t,e,o)}))}hasOriginalField(t,e){if(null==e)return!1;if("function"==typeof e)return!0;const o=this.getOriginal(t);return Boolean(o&&e in o)}setOriginalField(t,e,o){if(null==e)return!1;const n=this.getOriginal(t);return C(n)?n.then((t=>lr(t,e,o))):lr(n,e,o)}fieldPromiseCallBackInternal(t,e,o){}recordPromiseCallBackInternal(t,e){}static EMPTY=new ar({get(){},length:0})}class hr extends ar{_rCache;_fCache;static get EVENT_TYPE(){return ar.EVENT_TYPE}static ofArray(t){return new hr({get:e=>t[e],length:t.length,source:t})}constructor(t){super(t),this._rCache={},this._fCache={}}getOriginal(t){return this._rCache&&this._rCache[t]?this._rCache[t]:super.getOriginal(t)}getOriginalField(t,e){const o=this._fCache&&this._fCache[t];if(o){const t=o.get(e);if(t)return t}return super.getOriginalField(t,e)}setOriginalField(t,e,o){const n=this._fCache;return n&&n[t]&&delete n[t],super.setOriginalField(t,e,o)}clearCache(){this._rCache&&(this._rCache={}),this._fCache&&(this._fCache={})}fieldPromiseCallBackInternal(t,e,o){!function(t,e,o,n){(t[e]||(t[e]=new Map)).set(o,n)}(this._fCache,t,e,o)}recordPromiseCallBackInternal(t,e){this._rCache[t]=e}dispose(){super.dispose()}}class ur{_dataSource;_curIndex;_data;constructor(t){this._dataSource=t,this._curIndex=-1,this._data=[]}hasNext(){const t=this._curIndex+1;return this._dataSource.length>t}next(){const t=this._curIndex+1,e=this._getIndexData(t);return this._curIndex=t,e}movePrev(){this._curIndex--}_getIndexData(t,e){const o=this._dataSource,n=this._data;if(t<n.length)return n[t];if(o.length<=t)return;const r=this._dataSource.get(t);if(n[t]=r,C(r)&&(r.then((e=>{n[t]=e})),!e))for(let e=1;e<=100;e++)this._getIndexData(t+e,!0);return r}}class dr{_owner;_dataSourceItr;_filter;_filterdList;_queues;_cancel=!1;constructor(t,e,o){this._owner=t,this._dataSourceItr=new ur(e),this._filter=o,this._filterdList=[],this._queues=[]}get(t){if(this._cancel)return;const e=this._filterdList;if(t<e.length)return e[t];const o=this._queues,n=o[t];return n||(o[t]||this._findIndex(t))}cancel(){this._cancel=!0}_findIndex(t){if(window.Promise){const e=Date.now()+100;let o=0;return this._findIndexWithTimeout(t,(()=>(o++,o>=100&&(o=0,e<Date.now()))))}return this._findIndexWithTimeout(t,(()=>!1))}_findIndexWithTimeout(t,e){const o=this._filterdList,n=this._filter,r=this._dataSourceItr,s=this._queues;for(;r.hasNext();){if(this._cancel)return;const i=r.next();if(C(i)){r.movePrev();const e=i.then((e=>(s[t]=null,this.get(t))));return s[t]=e,e}if(n(i)&&(o.push(i),t<o.length))return o[t];if(e()){const e=new Promise((t=>{setTimeout((()=>{t()}),300)})).then((()=>(s[t]=null,this.get(t))));return s[t]=e,e}}this._owner.length=o.length}}var gr=Object.freeze({__proto__:null,DataSource:ar,CachedDataSource:hr,FilterDataSource:class extends ar{_dataSource;_handler;_filterData=null;static get EVENT_TYPE(){return ar.EVENT_TYPE}constructor(t,e){super(t),this._dataSource=t,this.filter=e;const o=this._handler=new nt;o.on(t,ar.EVENT_TYPE.UPDATED_ORDER,(()=>{this.filter=this.filter})),a(ar.EVENT_TYPE,(e=>{o.on(t,e,((...t)=>this.fireListeners(e,...t)))}))}get filter(){return this._filterData?._filter||null}set filter(t){this._filterData&&this._filterData.cancel(),this._filterData=t?new dr(this,this._dataSource,t):null,this.length=this._dataSource.length}getOriginal(t){return this._filterData?this._filterData.get(t):super.getOriginal(t)}sort(t,e){return this._dataSource.sort(t,e)}get source(){return this._dataSource.source}get dataSource(){return this._dataSource}dispose(){this._handler.dispose(),super.dispose()}}});class fr{_disabled;constructor(t={}){this._disabled=!!t.disabled||!1}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.onChangeDisabledInternal()}clone(){return new fr(this)}bindGridEvent(t,e){return[]}onChangeDisabledInternal(){}}function _r(t,e,{action:o,mouseOver:n,mouseOut:r}){function s(o,n){return t.getLayoutCellId(o,n)===e}let i;return[t.listen(I.CLICK_CELL,(t=>{s(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(I.MOUSEOVER_CELL,(e=>{s(e.col,e.row)&&(n&&!n({col:e.col,row:e.row})||(t.getElement().style.cursor="pointer",i=!0))})),t.listen(I.MOUSEMOVE_CELL,(e=>{s(e.col,e.row)&&i&&!t.getElement().style.cursor&&(t.getElement().style.cursor="pointer")})),t.listen(I.MOUSEOUT_CELL,(e=>{s(e.col,e.row)&&(r&&r({col:e.col,row:e.row}),t.getElement().style.cursor="",i=!1)}))]}function Cr(t,e,{action:o,acceptKeys:n=[]}){return n=[...n,13,32],[t.listen(I.KEYDOWN,(r=>{if(-1===n.indexOf(r.keyCode))return;if(t.keyboardOptions?.moveCellOnEnter&&13===r.keyCode)return;const s=t.selection.select;var i,l;(i=s.col,l=s.row,t.getLayoutCellId(i,l)===e)&&(o({col:s.col,row:s.row}),L.cancel(r.event))}))]}const pr=U();class wr extends fr{clone(){return new wr(this)}bindGridEvent(t,e){const o=function(t){let e=t[pr];return e||(e={elapsed:{},block:{}},v.setReadonly(t,pr,e)),e}(t),n=({col:e,row:n})=>{const r=t.getCellRange(e,n),s=`${r.start.col}:${r.start.row}`;if(this.disabled||o.block[s])return;const i=t.getHeaderValue(r.start.col,r.start.row);t.setHeaderValue(r.start.col,r.start.row,!i);J(200,(e=>{1===e?delete o.elapsed[s]:o.elapsed[s]=e,t.invalidateCellRange(r)}))};return[..._r(t,e,{action:n,mouseOver:e=>{if(this.disabled)return!1;o.mouseActiveCell={col:e.col,row:e.row};const n=t.getCellRange(e.col,e.row);return t.invalidateCellRange(n),!0},mouseOut:e=>{delete o.mouseActiveCell;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),...Cr(t,e,{action:n})]}}class mr extends fr{_sort;constructor(t={}){super(t),this._sort=t.sort??!0}get sort(){return this._sort}set sort(t){this._sort=t,this.onChangeDisabledInternal()}clone(){return new mr(this)}_executeSort(t,e){if("function"==typeof this._sort)this._sort({order:t.order||"asc",col:t.col,row:t.row,grid:e});else if("string"!=typeof this._sort||"true"===this._sort&&!function(t){if(t.dataSource.length>0){const e=t.dataSource.get(0);return null!=e&&"true"in e}return!1}(e)){const o=Math.min(e.recordRowCount-1,t.row)+e.frozenRowCount,n=e.getField(t.col,o);if(null==n)return;e.dataSource.sort(n,t.order||"asc")}else{const o=this._sort;e.dataSource.sort(o,t.order||"asc")}}bindGridEvent(t,e){return[..._r(t,e,{action:o=>{if(this.disabled)return;const n=t.sortState;let r;const s=t.getCellRange(o.col,o.row);var i,l;i=n.col,l=o.row,r=t.getLayoutCellId(i,l)===e?{col:s.start.col,row:s.start.row,order:"asc"===n.order?"desc":"asc"}:{col:s.start.col,row:s.start.row,order:"asc"},t.sortState=r,this._executeSort(r,t),t.invalidateGridRect(0,0,t.colCount-1,t.rowCount-1)},mouseOver:t=>!this.disabled})]}}class yr extends mr{get disabled(){return this._disabled}}const br={SORT:new yr,CHECK:new class extends wr{get disabled(){return this._disabled}}};function xr(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return br[e]||xr(null)}return t}}function vr(t){if(t.sort){if("function"==typeof t.sort){const e=t.sort;return new yr({sort:({order:o,col:n,grid:r})=>e.call(t,o,n,r)})}return"string"==typeof t.sort?new yr({sort:t.sort}):br.SORT}return xr(t.headerAction)}var Er=Object.freeze({__proto__:null,ACTIONS:br,BaseAction:fr,SortHeaderAction:mr,CheckHeaderAction:wr,of:xr,ofCell:vr});const Lr={CHANGE_STYLE:"change_style"};let Rr,Br,Ir,Sr,Tr,kr;class Ar extends kt{_bgColor;static get EVENT_TYPE(){return Lr}static get DEFAULT(){return Rr||(Rr=new Ar)}constructor({bgColor:t}={}){super(),this._bgColor=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this.doChangeStyle()}doChangeStyle(){this.fireListeners(Lr.CHANGE_STYLE)}clone(){return new Ar(this)}}class Or extends Ar{_textAlign;_textBaseline;static get DEFAULT(){return Br||(Br=new Or)}constructor(t={}){super(t),this._textAlign=t.textAlign||"left",this._textBaseline=t.textBaseline||"middle"}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t,this.doChangeStyle()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.doChangeStyle()}clone(){return new Or(this)}}class Mr extends Or{_color;_font;_padding;_textOverflow;static get DEFAULT(){return Ir||(Ir=new Mr)}constructor(t={}){super(t),this._color=t.color,this._font=t.font,this._padding=t.padding,this._textOverflow=t.textOverflow||"ellipsis"}get color(){return this._color}set color(t){this._color=t,this.doChangeStyle()}get font(){return this._font}set font(t){this._font=t,this.doChangeStyle()}get padding(){return this._padding}set padding(t){this._padding=t,this.doChangeStyle()}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t,this.doChangeStyle()}clone(){return new Mr(this)}}class Dr extends Mr{_uncheckBgColor;_checkBgColor;_borderColor;static get DEFAULT(){return Sr||(Sr=new Dr)}constructor(t={}){super(h(t,{textAlign:"center"}));const{uncheckBgColor:e,checkBgColor:o,borderColor:n}=t;this._uncheckBgColor=e,this._checkBgColor=o,this._borderColor=n}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.doChangeStyle()}clone(){return new Dr(this)}}class Fr extends Mr{_lineHeight;_autoWrapText;_lineClamp;static get DEFAULT(){return Tr||(Tr=new Fr)}constructor(t={}){super(t),this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp}clone(){return new Fr(this)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}}class Wr extends Fr{_sortArrowColor;_multiline;static get DEFAULT(){return kr||(kr=new Wr)}constructor(t={}){super(t),this._sortArrowColor=t.sortArrowColor,this._multiline=t.multiline}get sortArrowColor(){return this._sortArrowColor}set sortArrowColor(t){this._sortArrowColor=t,this.doChangeStyle()}get multiline(){return!!this._multiline}set multiline(t){this._multiline=t,this.doChangeStyle()}clone(){return new Wr(this)}}function Pr(t,e){return t?t instanceof Mr?t:"function"==typeof t?Pr(t(),e):new e(t):e.DEFAULT}var Hr=Object.freeze({__proto__:null,BaseStyle:Ar,Style:Mr,SortHeaderStyle:Wr,CheckHeaderStyle:Dr,MultilineTextHeaderStyle:Fr,of:Pr});class zr{constructor(t={}){this.onDrawCell=this.onDrawCell.bind(this)}get StyleClass(){return Ar}onDrawCell(t,e,o,n){const{style:r,drawCellBase:s}=e,i=n.getGridCanvasHelper();s(),this.drawInternal(this.convertInternal(t),o,Pr(r,this.StyleClass),i,n,e)}convertInternal(t){return"function"==typeof t&&(t=t()),null!=t?`${t}`:""}bindGridEvent(t,e){return[]}getCopyCellValue(t,e,o){return"function"==typeof t&&(t=t()),null!=t?t:""}}const Vr={},$r={get arrow_upward(){return{d:"M8 24l2.83 2.83L22 15.66V40h4V15.66l11.17 11.17L40 24 24 8 8 24z",width:48,height:48}},get arrow_downward(){return{d:"M40 24l-2.82-2.82L26 32.34V8h-4v24.34L10.84 21.16 8 24l16 16 16-16z",width:48,height:48}},get edit(){return{d:"M6 34.5V42h7.5l22.13-22.13-7.5-7.5L6 34.5zm35.41-20.41c.78-.78.78-2.05 0-2.83l-4.67-4.67c-.78-.78-2.05-.78-2.83 0l-3.66 3.66 7.5 7.5 3.66-3.66z",width:48,height:48}},get add(){return{d:"M38 26H26v12h-4V26H10v-4h12V10h4v12h12v4z",width:48,height:48}},get star(){return{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z",width:24,height:24}},get star_border(){return{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z",width:24,height:24}},get star_half(){return{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4V6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z",width:24,height:24}}};function Nr(){return u($r,Vr)}function Ur(){return"undefined"==typeof Path2D||b?require("./legacy/canvas/Path2DShim").Path2DShim:Path2D}function jr(t,e){return t.measureText(e).width}function Kr(t,e,o,n,r){const s=[];let i=o.next();for(let t=0;t<n&&null!==i;t++,i=o.next())s.push(i);let l=jr(t,s.join(""));if(l>r)for(;s.length;){if(l-=jr(t,s.pop()||""),l<=r)break}else if(l<r)for(;null!==i;){const e=jr(t,i);if(l+e>r)break;s.push(i),l+=e,i=o.next()}const c=s.join("").replace(/\s+$/,""),a=e.slice(c.length).replace(/^\s+/,"");return{before:c?new Gr(c):null,after:a?new Gr(a):null}}class Gr{_content;constructor(t){this._content=null!=t?t:""}width({ctx:t}){return jr(t,this._content)}font(){return null}color(){return null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){e.fillTextRect(t,this._content,o.left,o.top,o.width,o.height,{offset:n+1,padding:{left:r,right:s,top:i,bottom:l}})}canBreak(){return!!this._content}splitIndex(t){const e=this._content,o=E.genChars(e),n=[];let r=o.next();for(let e=0;e<t&&null!==r;e++,r=o.next())n.push(r);const s=n.join(""),i=e.slice(s.length);return{before:s?new Gr(s):null,after:i?new Gr(i):null}}breakWord(t,e){const o=this._content,n=this.width({ctx:t}),r=Math.floor(this._content.length*e/n);return Kr(t,o,E.genWords(o),r,e)}breakAll(t,e){const o=this._content,n=this.width({ctx:t}),r=Math.floor(this._content.length*e/n);return Kr(t,o,E.genChars(o),r,e)}toString(){return this._content}}class Yr extends Gr{_draw;_width;_color;constructor({draw:t,width:e,color:o}){super(),this._draw=t,this._width=e,this._color=o}width(t){return this._width}font(){return null}color(){return this._color??null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){this._draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l})}canBreak(){return!1}toString(){return""}}const qr={};let Xr,Jr;if(t)Xr=function(t,e,o){o()},Jr=function(){return!1};else{const t=document.fonts,e=!t;Xr=e?function(t,e,o){qr[`${t} @ ${e}`]?o():require("./legacy/fontwatch/FontWatchRunner").load(t,e,(()=>{qr[`${t} @ ${e}`]=!0,o()}),(()=>{qr[`${t} @ ${e}`]=!0,o()}))}:function(e,o,n){qr.all||qr[e]?n():(t.ready.then((()=>{qr.all=!0})),t.load(e).then((()=>{qr[e]=!0,n()})))},Jr=e?function(t,e){return!!qr[`${t} @ ${e}`]||(Xr(t,e,(()=>{})),!1)}:function(e,o){return!(!qr.all&&!qr[e])||(!!t.check(e)||(Xr(e,o,(()=>{})),!1))}}class Zr extends Gr{_icon;constructor(t){super(),this._icon=t||{}}width({ctx:t}){const e=this._icon;if(e.width)return e.width;if(e.font&&Jr(e.font,e.content||"")){t.save(),t.canvas.style.letterSpacing="normal";try{return t.font=e.font||t.font,t.measureText(e.content||"").width}finally{t.canvas.style.letterSpacing="",t.restore()}}return 0}font(){return this._icon.font??null}color(){return this._icon.color??null}canDraw(){const t=this._icon;return!t.font||Jr(t.font,t.content||"")}onReady(t){const e=this._icon;e.font&&!Jr(e.font,e.content||"")&&Xr(e.font,e.content||"",t)}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){const c=this._icon;if(c.content){t.canvas.style.letterSpacing="normal";try{t.font=t.font,e.fillTextRect(t,c.content,o.left,o.top,o.width,o.height,{offset:n+1,padding:{left:r,right:s,top:i,bottom:l}})}finally{t.canvas.style.letterSpacing=""}}}canBreak(){return!1}toString(){return""}}class Qr extends Gr{_src;_width;_height;_imageLeft;_imageTop;_imageWidth;_imageHeight;_onloaded;_inlineImgPromise=null;_inlineImg=null;constructor({src:t,width:e,height:o,imageLeft:n,imageTop:r,imageWidth:s,imageHeight:i}){super(),this._src=t,this._width=e,this._height=o,this._imageLeft=n,this._imageTop=r,this._imageWidth=s,this._imageHeight=i,this._onloaded=[],C(t)?t.then((t=>{this._src=t,this._loadImage(t)})):this._loadImage(t)}_loadImage(t){const e=this._inlineImgPromise=Ue("InlineImage",50,t);C(e)?e.then((t=>{this._inlineImg=t,this._onloaded.forEach((t=>t()))})):this._inlineImg=e}width(t){return this._width||(this._inlineImg?.width??0)}font(){return null}color(){return null}canDraw(){return!!this._inlineImg}onReady(t){(C(this._src)||C(this._inlineImgPromise))&&this._onloaded.push((()=>t()))}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){const c=this._inlineImg;e.drawInlineImageRect(t,c,this._imageLeft||0,this._imageTop||0,this._imageWidth||c.width,this._imageHeight||c.height,this._width||c.width,this._height||c.height,o.left,o.top,o.width,o.height,{offset:n+1,padding:{left:r,right:s,top:i,bottom:l}})}canBreak(){return!1}toString(){return""}}class ts extends Gr{_path;_width;_height;_color;constructor({path:t,width:e,height:o,color:n}){super();const r=Ur();this._path=new r(t),this._width=e,this._height=o,this._color=n}width(t){return this._width}font(){return null}color(){return this._color??null}canDraw(){return!0}onReady(t){}draw({ctx:t,rect:e,offset:o,offsetLeft:n,offsetRight:r,offsetTop:s,offsetBottom:i}){o++;const l={left:n,right:r,top:s,bottom:i};t.save();try{t.beginPath(),t.rect(e.left,e.top,e.width,e.height),t.clip();const n=ze(t,e,this._width,this._height,{offset:o,padding:l});t.translate(n.x,n.y),t.fill(this._path)}finally{t.restore()}}canBreak(){return!1}toString(){return""}}function es(t){const e="string"==typeof t?t:(new XMLSerializer).serializeToString(t);return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function os(t){if("string"==typeof t){return(new DOMParser).parseFromString(t,"image/svg+xml").children[0]}return t}class ns extends Qr{constructor({svg:t,width:e,height:o}){const n=p(t,os),r=C(n)?void 0:n.getAttribute("width")??void 0,s=C(n)?void 0:n.getAttribute("height")??void 0,i=null!=r?Number(r):void 0,l=null!=s?Number(s):void 0;super({src:p(t,es),width:e||i,height:o||l,imageWidth:i,imageHeight:l})}canBreak(){return!1}toString(){return""}}function rs(t,e,o,n,r,s,i,l,{offset:c=2,padding:a}={}){const h={left:r,top:s,width:i,height:l,right:r+i,bottom:s+l};t.save();try{t.beginPath(),t.rect(h.left,h.top,h.width,h.height),t.clip();const r=ze(t,h,o,n,{offset:c,padding:a});!function(t,e,o,n,r,s){e.save();try{const{width:i,height:l}=t,{ud:c,x:a=0,y:h=0}=t,u=(r=r||i)/i,d=(s=s||l)/(c?-l:l);o=o||0,n=c?(n||0)+-l*d:n||0,e.translate(o,n),e.scale(u,d),0===a&&0===h||e.translate(a,h);const g=Ur(),f=t.path2d=t.path2d||new g(t.d);e.fill(f)}finally{e.restore()}}(e,t,r.x,r.y,o,n)}finally{t.restore()}}function ss(t){if(t instanceof Gr)return t;if(!t)return null;if(function(t){return!(!t.font||!t.content)}(t))return new Zr(t);if(function(t){return!!t.src}(t))return new Qr({src:t.src,width:t.width,height:t.width});if(t.svg)return new ns({svg:t.svg,width:t.width,height:t.width});if(function(t){return!!t.path}(t))return new ts({path:t.path,width:t.width,height:t.width,color:t.color});const e=Nr();if(t.name&&e[t.name]){const o=e[t.name],n=t.width||Math.max(o.width,o.height);return new Yr({draw({ctx:t,rect:e,offset:r,offsetLeft:s,offsetRight:i,offsetTop:l,offsetBottom:c}){rs(t,o,n,n,e.left,e.top,e.width,e.height,{offset:r+1,padding:{left:s,right:i,top:l,bottom:c}})},width:n,height:n,color:t.color})}return new Zr(t)}function is(t){return null==t?null:t instanceof Gr?t:new Gr(t)}function ls(t,e){const o=[];if(t&&o.push(...t.map((t=>ss(t))).filter((t=>null!=t))),Array.isArray(e))o.push(...e.map((t=>is(t))).filter((t=>null!=t)));else{const t=is(e);t&&o.push(t)}return o}const cs=U();class as extends zr{get StyleClass(){return Dr}clone(){return new as(this)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,borderColor:a,checkBgColor:h,uncheckBgColor:u,bgColor:d,padding:g,color:f,font:_,textOverflow:C}=o;d&&s({bgColor:d});const{col:p,row:w}=e,m=r.getCellRange(p,w),y=`${m.start.col}:${m.start.row}`,{elapsed:{[y]:b}}=function(t){let e=t[cs];return e||(e={elapsed:{},block:{}},v.setReadonly(t,cs,e)),e}(r),x=r.getHeaderValue(m.start.col,m.start.row),E={textAlign:l,textBaseline:c,borderColor:a,checkBgColor:h,uncheckBgColor:u};null!=b&&(E.animElapsedTime=b);const L=n.buildCheckBoxInline(!!x,e,E);Te(i(),e,n,((e,o)=>{let r=[L];r=r.concat(ls(e,null!=t?String(t):"")),n.text(r,o,{textAlign:l,textBaseline:c,color:f,font:_,padding:g,textOverflow:C})}))}}class hs extends zr{get StyleClass(){return Mr}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,color:a,font:h,bgColor:u,padding:d,textOverflow:g}=o;u&&s({bgColor:u});const f=null!=t?String(t):"";Te(i(),e,n,((t,e)=>{n.text(f,e,{textAlign:l,textBaseline:c,color:a,font:h,padding:d,textOverflow:g,icons:t})}))}}class us extends zr{get StyleClass(){return Fr}clone(){return new us(this)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,color:a,font:h,bgColor:u,padding:d,lineHeight:g,autoWrapText:f,lineClamp:_,textOverflow:C}=o;u&&s({bgColor:u});const p=null!=t?String(t):"",w=p.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(h,p,e),Te(i(),e,n,((t,e)=>{n.multilineText(w,e,{textAlign:l,textBaseline:c,color:a,font:h,padding:d,lineHeight:g,autoWrapText:f,lineClamp:_,textOverflow:C,icons:t})}))}}class ds extends zr{get StyleClass(){return Wr}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c="middle",color:a,bgColor:h,font:u,padding:d,textOverflow:g,lineHeight:f,autoWrapText:_,lineClamp:C,sortArrowColor:p,multiline:w}=o;h&&s({bgColor:h});const y=null!=t?String(t):"";n.testFontLoad(u,y,e),Te(i(),e,n,((t,e)=>{const o=r.sortState;let s;const{col:i,row:h}=e;m(r.getCellRange(i,h),o.col,o.row)&&({order:s}=o);const b=e.getContext(),x={name:null!=s?"asc"===s?"arrow_downward":"arrow_upward":void 0,width:1.2*He(b,u).width,color:n.getColor(p||n.theme.header.sortArrowColor,i,h,b)||"rgba(0, 0, 0, 0.38)"};if(w){const o=y.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.multilineText(o,e,{textAlign:l,textBaseline:c,color:a,font:u,padding:d,lineHeight:f,autoWrapText:_,lineClamp:C,textOverflow:g,icons:t,trailingIcon:x})}else n.text(y,e,{textAlign:l,textBaseline:c,color:a,font:u,padding:d,textOverflow:g,icons:t,trailingIcon:x})}))}}const gs={DEFAULT:new hs,SORT:new ds,CHECK:new as,MULTILINETEXT:new us};function fs(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return gs[e]||fs(null)}return t}return gs.DEFAULT}function _s(t){return t.sort?gs.SORT:fs(t.headerType)}var Cs=Object.freeze({__proto__:null,BaseHeader:zr,Header:hs,SortHeader:ds,CheckHeader:as,MultilineTextHeader:us,of:fs,ofCell:_s}),ps=Object.freeze({__proto__:null,action:Er,type:Cs,style:Hr});const ws={};function ms(t,e,o){const n=t[e];return t[e]=o,n}var ys=Object.freeze({__proto__:null,theme:function(t,e){return null!=e?ms(ws,t,e):ws[t]},icon:function(t,e){return null!=e?ms(Vr,t,e):Vr[t]},icons:function(t){return function(t,e){for(const o in e)t[o]=e[o]}(Vr,t)}});const bs=H();function xs(t,e,o,n){return f(t,...o)||f(e,...o)||n&&f(t,...n)||n&&f(e,...n)}class vs{[bs];_checkbox=null;_radioButton=null;_button=null;_header=null;_messages=null;constructor(t,e){this[bs]={obj:t,superTheme:e}}get font(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["underlayBackgroundColor"])}get color(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["color"])}get frozenRowsColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["frozenRowsColor"],["color"])}get defaultBgColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["defaultBgColor"])}get frozenRowsBgColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["frozenRowsBgColor"],["defaultBgColor"])}get selectionBgColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["selectionBgColor"],["defaultBgColor"])}get highlightBgColor(){if(this.hasProperty(["highlightBgColor"])){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["highlightBgColor"])}return t=>{const e=t.row<t.grid.frozenRowCount?this.frozenRowsBgColor:this.defaultBgColor;return"function"==typeof e?e(t):e}}get borderColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["borderColor"])}get frozenRowsBorderColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["frozenRowsBorderColor"],["borderColor"])}get highlightBorderColor(){const{obj:t,superTheme:e}=this[bs];return xs(t,e,["highlightBorderColor"],["borderColor"])}get checkbox(){const{obj:t,superTheme:e}=this[bs];return this._checkbox||(this._checkbox={get uncheckBgColor(){return xs(t,e,["checkbox","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return xs(t,e,["checkbox","checkBgColor"],["borderColor"])},get borderColor(){return xs(t,e,["checkbox","borderColor"],["borderColor"])}})}get radioButton(){const{obj:t,superTheme:e}=this[bs];return this._radioButton||(this._radioButton={get checkColor(){return xs(t,e,["radioButton","checkColor"],["color"])},get uncheckBorderColor(){return xs(t,e,["radioButton","uncheckBorderColor"],["borderColor"])},get checkBorderColor(){return xs(t,e,["radioButton","checkBorderColor"],["borderColor"])},get uncheckBgColor(){return xs(t,e,["radioButton","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return xs(t,e,["radioButton","checkBgColor"],["defaultBgColor"])}})}get button(){const{obj:t,superTheme:e}=this[bs];return this._button||(this._button={get color(){return xs(t,e,["button","color"],["color"])},get bgColor(){return xs(t,e,["button","bgColor"],["defaultBgColor"])}})}get header(){const{obj:t,superTheme:e}=this[bs];return this._header||(this._header={get sortArrowColor(){return xs(t,e,["header","sortArrowColor"],["color"])}})}get messages(){const{obj:t,superTheme:e}=this[bs];return this._messages||(this._messages={get infoBgColor(){return xs(t,e,["messages","infoBgColor"])},get errorBgColor(){return xs(t,e,["messages","errorBgColor"])},get warnBgColor(){return xs(t,e,["messages","warnBgColor"])},get boxWidth(){return xs(t,e,["messages","boxWidth"])},get markHeight(){return xs(t,e,["messages","markHeight"])}})}hasProperty(t){const{obj:e,superTheme:o}=this[bs];return Es(e,t)||Es(o,t)}extends(t){return new vs(t,this)}}function Es(t,e){if(t instanceof vs)return t.hasProperty(e);{let o=t;if(!o)return!1;for(let t=0;t<e.length;t++){if(o=o[e[t]],!o)return!1}return!!o}}const Ls={};var Rs={color:"rgba(0, 0, 0, 0.87)",frozenRowsColor:"rgba(0, 0, 0, 0.54)",defaultBgColor:"#FFF",selectionBgColor:"#CCE0FF",borderColor:function(t){const{col:e,row:o,grid:n}=t,{colCount:r,frozenColCount:s,recordRowCount:i}=n;let l="#ccc7c7",c="#ccc7c7";if(i>1){const t=n.getRecordStartRowByRecordIndex(n.getRecordIndexByRow(o));t!==o&&(l=null),t+i-1!==o&&(c=null)}return s-1===e||r-1===e?[l,"#f2f2f2",c,null]:[l,null,c,null]},frozenRowsBorderColor:function(t){const{row:e,grid:{frozenRowCount:o}}=t;return o-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]},highlightBorderColor:"#5E9ED6",checkbox:{checkBgColor:"rgb(76, 73, 72)",borderColor:"rgba(0, 0, 0, 0.26)"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"rgb(76, 73, 72)",uncheckBorderColor:"rgb(189, 189, 189)"},button:{color:"#FFF",bgColor:"#2196F3"},header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},underlayBackgroundColor:"#FFF"};const Bs=new vs({color:"#000",defaultBgColor:function(t){const{row:e,grid:o}=t;return e<o.frozenRowCount?"#FFF":1&o.getRecordIndexByRow(e)?"#F6F6F6":"#FFF"},frozenRowsBgColor:function(t){const{col:e,grid:o,grid:{frozenRowCount:n},context:r}=t,{left:s,top:i}=o.getCellRelativeRect(e,0),{bottom:l}=o.getCellRelativeRect(e,n-1);return function(t,e,o,n,r,s){let i;const l=[];for(i in s)l.push(`${i}@${s[i]}`);const c=`${e}/${o}/${n}/${r}/${l.join(",")}`,a=Ls[c];if(a)return a;const h=t.createLinearGradient(e,o,e,r);for(i in s)h.addColorStop(Number(i),s[i]);return Ls[c]=h}(r,s,i,s,l,{0:"#FFF",1:"#D3D3D3"})},selectionBgColor:"#CCE0FF",borderColor:"#000",highlightBorderColor:"#5E9ED6",checkbox:{uncheckBgColor:"#FFF",checkBgColor:"rgb(76, 73, 72)",borderColor:"#000"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"#000",uncheckBorderColor:"#000",uncheckBgColor:"#FFF",checkBgColor:"#FFF"},button:{color:"#FFF",bgColor:"#2196F3"},header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},underlayBackgroundColor:"#F6F6F6"}),Is=new vs(Rs),Ss={BASIC:Bs,MATERIAL_DESIGN:Is};let Ts=Is;const ks={Theme:vs};function As(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const o=e.toLowerCase();if(t[o])return t[o];const n=e.toLowerCase();if(t[n])return t[n];for(const e in t)if(e.toLowerCase()===o)return t[e]}(Ds(),t);return e||null}return t instanceof vs?t:new vs(t)}function Os(){return Ts}function Ms(t){Ts=As(t)||Ts}function Ds(){return u(Ss,ws)}var Fs=Object.freeze({__proto__:null,BASIC:Bs,MATERIAL_DESIGN:Is,theme:ks,of:As,getDefault:Os,setDefault:Ms,getChoices:Ds});const{ceil:Ws,PI:Ps}=Math;function Hs(t,e,o,n,r,s){e[0]===e[1]&&e[0]===e[2]&&e[0]===e[3]?e[0]&&(t.strokeStyle=e[0],t.strokeRect(o,n,r,s)):function(o){for(let n=0;n<e.length;n++){const r=e[n],s=e[n-1];if(r){if(s!==r){s&&(t.strokeStyle=s,t.stroke());const e=o[n];t.beginPath(),t.moveTo(e.x,e.y)}const e=o[n+1];t.lineTo(e.x,e.y)}else s&&(t.strokeStyle=s,t.stroke())}const n=e[e.length-1];n&&(t.strokeStyle=n,t.stroke())}([{x:o,y:n},{x:o+r,y:n},{x:o+r,y:n+s},{x:o,y:n+s},{x:o,y:n}])}function zs(t,e,o,n,r,s){t.beginPath(),t.arc(e+s,o+s,s,-Ps,-.5*Ps,!1),t.arc(e+n-s,o+s,s,-.5*Ps,0,!1),t.arc(e+n-s,o+r-s,s,0,.5*Ps,!1),t.arc(e+s,o+r-s,s,.5*Ps,Ps,!1),t.closePath()}function Vs(t,e,o,n,r,s){zs(t,e,o,n,r,s),t.fill()}function $s(t,e,o,n,r,s){zs(t,e,o,n,r,s),t.stroke()}function Ns(t,e,o,n,r){const s=Math.min(n,r)/2;t.beginPath(),t.arc(e+s,o+s,s,0,2*Math.PI),t.closePath(),t.fill()}function Us(t,e,o,n,r){const s=Math.min(n,r)/2;t.beginPath(),t.arc(e+s,o+s,s,0,2*Math.PI),t.closePath(),t.stroke()}function js(t){return{width:He(t,null).width}}function Ks(t){return{width:He(t,null).width}}function Gs(t,e,o,n,{uncheckBgColor:r="#FFF",checkBgColor:s="rgb(76, 73, 72)",borderColor:i="#000",boxSize:l=js(t).width}={}){const c="number"==typeof n?n>1?1:n:1;t.save();try{t.fillStyle=n?s:r;const a=Ws(e),h=Ws(o),u=Ws(l);if(Vs(t,a-1,h-1,u+1,u+1,l/5),t.lineWidth=1,t.strokeStyle=i,$s(t,a-.5,h-.5,u,u,l/5),n){t.lineWidth=Ws(l/10),t.strokeStyle=r;let n=l/4,s=l/2*.9;const i=e+.2*l,a=o+l/2;c<.5&&(n*=2*c),t.beginPath(),t.moveTo(i,a),t.lineTo(i+n,a+n),c>.5&&(c<1&&(s*=2*(c-.5)),t.lineTo(i+n+s,a+n-s)),t.stroke()}}finally{t.restore()}}function Ys(t,e,o,n,{checkColor:r="rgb(76, 73, 72)",borderColor:s="#000",bgColor:i="#FFF",boxSize:l=Ks(t).width}={}){const c="number"==typeof n?n>1?1:n:1;t.save();try{t.fillStyle=i;const a=Ws(e),h=Ws(o),u=Ws(l);if(Ns(t,a-1,h-1,u+1,u+1),t.lineWidth=1,t.strokeStyle=s,Us(t,a-.5,h-.5,u,u),n){const e=u*c/2,o=(u-e)/2;t.fillStyle=r,Ns(t,Ws(100*(a-.5+o))/100,Ws(100*(h-.5+o))/100,Ws(100*e)/100,Ws(100*e)/100)}}finally{t.restore()}}function qs(t,e,o,n,r,s={}){const{backgroundColor:i="#FFF",bgColor:l=i,radius:c=4,shadow:a={}}=s;t.save();try{if(t.fillStyle=l,a){const{color:e="rgba(0, 0, 0, 0.24)",blur:o=1,offsetX:n=0,offsetY:r=2,offset:{x:s=n,y:i=r}={}}=a;t.shadowColor=e,t.shadowBlur=o,t.shadowOffsetX=s,t.shadowOffsetY=i}Vs(t,Ws(e),Ws(o),Ws(n),Ws(r),c)}finally{t.restore()}}var Xs=Object.freeze({__proto__:null,strokeColorsRect:Hs,roundRect:zs,fillRoundRect:Vs,strokeRoundRect:$s,fillCircle:Ns,strokeCircle:Us,fillTextRect:function(t,e,o,n,r,s,{offset:i=2,padding:l}={}){const c={left:o,top:n,width:r,height:s,right:o+r,bottom:n+s};t.save();try{t.beginPath(),t.rect(c.left,c.top,c.width,c.height),t.clip();const o=function(t,e,{offset:o=0,padding:{left:n=0,right:r=0,top:s=0,bottom:i=0}={}}={}){return ze(t,e,0,0,{offset:o,padding:{left:n,right:r,top:s,bottom:i}})}(t,c,{offset:i,padding:l});t.fillText(e,o.x,o.y)}finally{t.restore()}},drawInlineImageRect:function(t,e,o,n,r,s,i,l,c,a,h,u,{offset:d=2,padding:g}={}){const f={left:c,top:a,width:h,height:u,right:c+h,bottom:a+u};t.save();try{t.beginPath(),t.rect(f.left,f.top,f.width,f.height),t.clip();const c=ze(t,f,i,l,{offset:d,padding:g});t.drawImage(e,o,n,r,s,c.x,c.y,i,l)}finally{t.restore()}},measureCheckbox:js,measureRadioButton:Ks,drawCheckbox:Gs,drawRadioButton:Ys,drawButton:qs}),Js=Object.freeze({__proto__:null,canvashelper:Xs});let Zs=-1;class Qs{headers=[];columns=[];getHeader(t,e){const o=this.headers[e]||(this.headers[e]=[]);return o[t]||(o[t]={id:Zs--,define:{},headerType:fs(null)})}getBody(t,e){const o=this.columns[e]||(this.columns[e]=[]);return o[t]||(o[t]={id:Zs--,define:{},columnType:oo(null),style:null})}}let ti=0;class ei{_headerObjects;_headerObjectMap;_headerCellIds;_columns;bodyRowCount=1;_emptyDataCache=new Qs;constructor(t){this._columns=[],this._headerCellIds=[],this._headerObjects=this._addHeaders(0,t,[]),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{})}get columnWidths(){return this._columns}get headerRowCount(){return this._headerCellIds.length}get colCount(){return this._columns.length}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}getCellId(t,e){return this.headerRowCount<=e?this._columns[t].id:this._headerCellIds[e][t]}getHeader(t,e){const o=this.getCellId(t,e);return this._headerObjectMap[o]||this._emptyDataCache.getHeader(t,e)}getBody(t,e){return this._columns[t]||this._emptyDataCache.getBody(t,0)}getBodyLayoutRangeById(t){for(let e=0;e<this.colCount;e++)if(t===this._columns[e].id)return{start:{col:e,row:0},end:{col:e,row:0}};throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){const o={start:{col:t,row:e},end:{col:t,row:e}};if(this.headerRowCount<=e)return o;const n=this.getCellId(t,e);for(let r=t-1;r>=0&&n===this.getCellId(r,e);r--)o.start.col=r;for(let r=t+1;r<this.colCount&&n===this.getCellId(r,e);r++)o.end.col=r;for(let r=e-1;r>=0&&n===this.getCellId(t,r);r--)o.start.row=r;for(let r=e+1;r<this.headerRowCount&&n===this.getCellId(t,r);r++)o.end.row=r;return o}getRecordIndexByRow(t){return t<this.headerRowCount?-1:t-this.headerRowCount}getRecordStartRowByRecordIndex(t){return this.headerRowCount+t}_addHeaders(t,e,o){const n=[],r=this._headerCellIds[t]||this._newRow(t);return e.forEach((e=>{const s=this._columns.length,i=ti++,l={id:i,caption:e.caption,field:e.headerField||e.field,headerIcon:e.headerIcon,style:e.headerStyle,headerType:_s(e),action:vr(e),define:e};n[i]=l,r[s]=i;for(let e=t-1;e>=0;e--)this._headerCellIds[e][s]=o[e];if(e.columns)this._addHeaders(t+1,e.columns,[...o,i]).forEach((t=>n.push(t)));else{const o=e;this._columns.push({id:ti++,field:o.field,width:o.width,minWidth:o.minWidth,maxWidth:o.maxWidth,icon:o.icon,message:o.message,columnType:oo(o.columnType),action:ko(o.action),style:o.style,define:o});for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][s]=i}})),n}_newRow(t){const e=this._headerCellIds[t]=[];if(!this._columns.length)return e;const o=this._headerCellIds[t-1];for(let t=0;t<o.length;t++)e[t]=o[t];return e}}let oi=0;class ni{objects=[];objectGrid=[];objectMap={};columnCount=0;columnWidths=[];constructor(t,e){t.forEach(((t,o)=>{let n=0;t.forEach((t=>{const r=oi++,s=e(t,r);this.objects.push(s),this.objectMap[r]=s,n=this._findStartCell(n,o);const i=Number(t.rowSpan??1),l=Number(t.colSpan??1),c=o+i,a=n+l;for(let t=o;t<c;t++){const e=this._getObjectGridRow(t);for(let t=n;t<a;t++)e[t]=s}1===l&&this._setWidthDataIfAbsent(n,t),this._useColumnIndex(a-1),n=a}))}))}get rowCount(){return this.objectGrid.length}_findStartCell(t,e){const o=this._getObjectGridRow(e);for(let e=t;e<o.length;e++)if(!o[e])return e;return o.length}_getObjectGridRow(t){return this.objectGrid[t]||(this.objectGrid[t]=[])}_useColumnIndex(t){this.columnCount>t||(this.columnCount=t+1)}_setWidthDataIfAbsent(t,e){this.columnWidths[t]||null==e.width&&null==e.maxWidth&&null==e.minWidth||(this.columnWidths[t]={width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth})}}class ri{_header;_body;_columnWidths=[];_columnCount;_emptyDataCache=new Qs;constructor(t){const e=function(t){return Array.isArray(t)?{header:t,body:t}:t}(t),o=this._header=new ni(e.header,((t,e)=>({id:e,caption:t.caption,field:t.headerField||t.field,headerIcon:t.headerIcon,style:t.headerStyle,headerType:_s(t),action:vr(t),define:t}))),n=this._body=new ni(e.body,((t,e)=>({id:e,field:t.field,width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth,icon:t.icon,message:t.message,columnType:oo(t.columnType),action:ko(t.action),style:t.style,define:t}))),r=this._columnCount=Math.max(o.columnCount,n.columnCount);for(let t=0;t<r;t++){const e=o.columnWidths[t]||n.columnWidths[t]||{};this._columnWidths[t]=e}}get columnWidths(){return this._columnWidths}get headerRowCount(){return this._header.rowCount}get bodyRowCount(){return this._body.rowCount}get colCount(){return this._columnCount}get headerObjects(){return this._header.objects}get columnObjects(){return this._body.objects}getCellId(t,e){if(this.headerRowCount<=e){const o=(e-this.headerRowCount)%this.bodyRowCount;return this._body.objectGrid[o]?.[t]?.id}return this._header.objectGrid[e]?.[t]?.id}getHeader(t,e){const o=this.getCellId(t,e);return this._header.objectMap[o]||this._emptyDataCache.getHeader(t,e)}getBody(t,e){const o=this.getCellId(t,e);return this._body.objectMap[o]||this._emptyDataCache.getBody(t,e)}getBodyLayoutRangeById(t){for(let e=0;e<this.bodyRowCount;e++){const o=this._body.objectGrid[e];if(o)for(let n=0;n<this.colCount;n++)if(t===o[n]?.id)return this._getCellRange(this._body,n,e,0)}throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){if(this.headerRowCount<=e){const o=this.getRecordIndexByRow(e),n=this.getRecordStartRowByRecordIndex(o),r=(e-this.headerRowCount)%this.bodyRowCount;return this._getCellRange(this._body,t,r,n)}return this._getCellRange(this._header,t,e,0)}getRecordIndexByRow(t){if(t<this.headerRowCount)return-1;{const e=t-this.headerRowCount;return Math.floor(e/this.bodyRowCount)}}getRecordStartRowByRecordIndex(t){return this.headerRowCount+t*this.bodyRowCount}_getCellRange(t,e,o,n){const r={start:{col:e,row:o+n},end:{col:e,row:o+n}},{objectGrid:s}=t,i=s[o]?.[e]?.id;if(null==i)return r;for(let t=e-1;t>=0&&i===s[o]?.[t]?.id;t--)r.start.col=t;for(let n=e+1;n<t.columnCount&&i===s[o]?.[n]?.id;n++)r.end.col=n;for(let t=o-1;t>=0&&i===s[t]?.[e]?.id;t--)r.start.row=t+n;for(let l=o+1;l<t.rowCount&&i===s[l]?.[e]?.id;l++)r.end.row=l+n;return r}}function si(t,e,o){const{bgColor:n,color:r,boxWidth:s,markHeight:i}=e,l=t.getContext(),c=t.getRect();l.fillStyle=n;const a=c.copy();a.left=a.right-(Number(s)||24),l.fillRect(a.left,a.top,a.width,a.height-1);const h=r,u=Number(i)||20,d=u/5,g=a.left+(a.width-d)/2,f=a.top+(a.height-u)/2;o.fillRectWithState(new tn(g,f,d,u/5*3),t,{fillColor:h}),o.fillRectWithState(new tn(g,f+u/5*4,d,u/5),t,{fillColor:h})}class ii{_grid;_messageElement=null;constructor(t){this._grid=t}dispose(){this.detachMessageElement(),this._messageElement&&this._messageElement.dispose(),this._messageElement=null}_getMessageElement(){return this._messageElement||(this._messageElement=this.createMessageElementInternal())}attachMessageElement(t,e,o){this._getMessageElement().attach(this._grid,t,e,o)}moveMessageElement(t,e){this._getMessageElement().move(this._grid,t,e)}detachMessageElement(){this._getMessageElement()._detach()}drawCellMessage(t,e,o,n,r,s){this.drawCellMessageInternal(t,e,o,n,r,s)}}const li="cheetah-grid__message-element",ci=`${li}__message`,ai=`${li}--hidden`,hi=`${li}--shown`;class ui{_handler;_rootElement;_messageElement;constructor(){this._handler=new nt;const t=this._rootElement=function(){require("@/columns/message/internal/MessageElement.css");const t=rt("div",{classList:[li,ai]}),e=rt("span",{classList:[ci]});return t.appendChild(e),t}();this._messageElement=t.querySelector(`.${ci}`)}dispose(){this.detach(),this._handler.dispose(),delete this._rootElement,delete this._messageElement}attach(t,e,o,n){const r=this._rootElement,s=this._messageElement;r.classList.remove(hi),r.classList.add(ai),this._attachCell(t,e,o)?(r.classList.add(hi),r.classList.remove(ai),s.textContent=n.message):this._detach()}move(t,e,o){const n=this._rootElement;this._attachCell(t,e,o)?(n.classList.add(hi),n.classList.remove(ai)):this._detach()}detach(){this._detach()}_detach(){const t=this._rootElement;t.parentElement&&(t.parentElement.removeChild(t),t.classList.remove(hi),t.classList.add(ai))}_attachCell(t,e,o){const n=this._rootElement,{element:r,rect:s}=t.getAttachCellsArea(t.getCellRange(e,o)),{bottom:i,left:l,width:c}=s,{frozenRowCount:a,frozenColCount:h}=t;if(o>=a&&a>0){const{rect:o}=t.getAttachCellsArea(t.getCellRange(e,a-1));if(i<o.bottom)return!1}else if(i<0)return!1;if(e>=h&&h>0){const{rect:e}=t.getAttachCellsArea(t.getCellRange(h-1,o));if(l<e.right)return!1}else if(l<0)return!1;const{offsetHeight:u,offsetWidth:d}=r;return!(u<i)&&(!(d<l)&&(n.style.top=`${i.toFixed()}px`,n.style.left=`${l.toFixed()}px`,n.style.width=`${c.toFixed()}px`,n.parentElement!==r&&r.appendChild(n),!0))}}const di="cheetah-grid__error-message-element",gi=`${di}__message`;class fi extends ui{constructor(){super(),require("@/columns/message/internal/ErrorMessageElement.css"),this._rootElement.classList.add(di),this._messageElement.classList.add(gi)}}class _i extends ii{createMessageElementInternal(){return new fi}drawCellMessageInternal(t,e,o,n,r,s){const{bgColor:i}=o,{select:l}=e.getSelection();m(r.getCellRange(e.col,e.row),l.col,l.row)&&r.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{si(e,{bgColor:n.getColor(n.theme.messages.errorBgColor,e.col,e.row,t)||"#ff8a80",color:i,boxWidth:n.theme.messages.boxWidth,markHeight:n.theme.messages.markHeight},n)}))}}class Ci extends ii{createMessageElementInternal(){return new ui}drawCellMessageInternal(t,e,o,n,r,s){const{bgColor:i}=o,{select:l}=e.getSelection();m(r.getCellRange(e.col,e.row),l.col,l.row)&&r.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{!function(t,e,o){const{bgColor:n,color:r,boxWidth:s,markHeight:i}=e,l=t.getContext(),c=t.getRect();l.fillStyle=n;const a=c.copy();a.left=a.right-(Number(s)||24),l.fillRect(a.left,a.top,a.width,a.height-1);const h=r,u=Number(i)||20,d=u/5,g=a.left+(a.width-d)/2,f=a.top+(a.height-u)/2;o.fillRectWithState(new tn(g,f,d,u/5),t,{fillColor:h}),o.fillRectWithState(new tn(g,f+u/5*2,d,u/5*3),t,{fillColor:h})}(e,{bgColor:n.getColor(n.theme.messages.infoBgColor,e.col,e.row,t)||"#e0e0e0",color:i,boxWidth:n.theme.messages.boxWidth,markHeight:n.theme.messages.markHeight},n)}))}}const pi=u(I,{CHANGED_VALUE:"changed_value",CHANGED_HEADER_VALUE:"changed_header_value",REJECTED_PASTE_VALUES:"rejected_paste_values"}),wi="cheetah-grid__warning-message-element",mi=`${wi}__message`;class yi extends ui{constructor(){super(),require("@/columns/message/internal/WarningMessageElement.css"),this._rootElement.classList.add(wi),this._messageElement.classList.add(mi)}}class bi extends ii{createMessageElementInternal(){return new yi}drawCellMessageInternal(t,e,o,n,r,s){const{bgColor:i}=o,{select:l}=e.getSelection();m(r.getCellRange(e.col,e.row),l.col,l.row)&&r.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{si(e,{bgColor:n.getColor(n.theme.messages.warnBgColor,e.col,e.row,t)||"#ff9e80",color:i,boxWidth:n.theme.messages.boxWidth,markHeight:n.theme.messages.markHeight},n)}))}}const xi={type:"error",message:null},vi={error:t=>new _i(t),info:t=>new Ci(t),warning:t=>new bi(t)};function Ei(t){if(!t||C(t))return xi;if("string"==typeof t)return{type:"error",message:t,original:t};const e=t.type||"error";return e&&e in vi?{type:e.toLowerCase(),message:t.message,original:t}:{type:"error",message:`${t}`,original:t}}function Li(t){return!!Ei(t).message}class Ri{_grid;_messageInstances;_attachInfo=null;constructor(t,e){this._grid=t,this._messageInstances={},this._bindGridEvent(t,e)}dispose(){const t=this._messageInstances;for(const e in t)t[e]?.dispose();delete this._messageInstances,delete this._attachInfo}drawCellMessage(t,e,o,n,r,s){if(!Li(t))return;this._getMessageInstanceOfMessage(t).drawCellMessage(Ei(t),e,o,n,r,s)}_attach(t,e,o){const n=this._attachInfo,r=this._getMessageInstanceOfMessage(o);n&&n.instance!==r&&n.instance.detachMessageElement(),r.attachMessageElement(t,e,Ei(o)),this._attachInfo={col:t,row:e,instance:r}}_move(t,e){const o=this._attachInfo;if(!o||o.col!==t||o.row!==e)return;const{instance:n}=o;n.moveMessageElement(t,e)}_detach(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e.detachMessageElement(),this._attachInfo=null}_bindGridEvent(t,e){const o=o=>{const n=t=>{Li(t)?this._attach(o.col,o.row,t):this._detach()},r=e(o.col,o.row);if(C(r))return this._detach(),void r.then((e=>{const r=t.selection.select;r.col===o.col&&r.row===o.row&&n(e)}));n(r)};t.listen(pi.SELECTED_CELL,(t=>{t.selected&&(t.before.col===t.col&&t.before.row===t.row||o(t))})),t.listen(pi.SCROLL,(()=>{const e=t.selection.select;this._move(e.col,e.row)})),t.listen(pi.CHANGED_VALUE,(e=>{if(!t.hasFocusGrid())return;const n=t.selection.select;n.col===e.col&&n.row===e.row&&o(e)})),t.listen(pi.FOCUS_GRID,(e=>{const n=t.selection.select;o(n)})),t.listen(pi.BLUR_GRID,(t=>{this._detach()}))}_getMessageInstanceOfMessage(t){const e=this._messageInstances,{type:o}=Ei(t);return e[o]||(e[o]=vi[o](this._grid))}}const Bi={};function Ii(t){return parseInt(t,16)}function Si(t,e,o,n=1){return{r:t,g:e,b:o,a:n}}function Ti({r:t,g:e,b:o,a:n}){return 0<=t&&t<=255&&0<=e&&e<=255&&0<=o&&o<=255&&0<=n&&n<=1}function ki(t){return Math.ceil(255*t/100)}function Ai(t){if(/^#[0-9a-f]{3}$/i.exec(t))return function({1:t,2:e,3:o}){return Si(Ii(t+t),Ii(e+e),Ii(o+o))}(t);if(/^#[0-9a-f]{6}$/i.exec(t))return function({1:t,2:e,3:o,4:n,5:r,6:s}){return Si(Ii(t+e),Ii(o+n),Ii(r+s))}(t);let e=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(t);if(e){const t=Si(Number(e[1]),Number(e[2]),Number(e[3]));if(Ti(t))return t}if(e=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t),e){const t=Si(Number(e[1]),Number(e[2]),Number(e[3]),Number(e[4]));if(Ti(t))return t}if(e=/^rgb\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*\)$/i.exec(t),e){const t=Si(ki(Number(e[1])),ki(Number(e[3])),ki(Number(e[5])));if(Ti(t))return t}if(e=/^rgba\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t),e){const t=Si(ki(Number(e[1])),ki(Number(e[3])),ki(Number(e[5])),Number(e[7]));if(Ti(t))return t}return null}function Oi(t){return"string"!=typeof t?Si(0,0,0,0):(t=t.toLowerCase().trim(),Bi[t]?Bi[t]:Ai(t)||(Bi[t]=function(t){const e=document.createElement("div"),{style:o}=e;o.color=t,o.position="fixed",o.height="1px",o.width="1px",o.opacity="0",document.body.appendChild(e);const{color:n}=(document.defaultView||window).getComputedStyle(e,"");return document.body.removeChild(e),Ai(n||"")}(t)))}const{toBoxArray:Mi}=R,Di=is("â€¦");function Fi(t,e,o,n,r){return _(t,{col:e,row:o,grid:n,context:r})}function Wi(t,e,o,n,r){if(null!=t)return _(t,{col:e,row:o,grid:n,context:r})}function Pi(t,...e){const o=f(t.theme,...e);if(null==o)return f(Os(),...e);if("function"!=typeof o)return o;let n;return t=>{const r=o(t);return null!=r?r:(n=n||f(Os(),...e),_(n,t))}}function Hi(t,e,o,n,r,s,i,l,c){function a(e,a,h){if(e.canDraw()){t.save();try{t.fillStyle=Fi(e.color()||t.fillStyle,i,l,c,t),t.font=e.font()||t.font,e.draw({ctx:t,canvashelper:Xs,rect:o,offset:n,offsetLeft:a,offsetRight:h,offsetTop:r,offsetBottom:s})}finally{t.restore()}}else e.onReady((()=>c.invalidateCell(i,l)))}if(1===e.length){a(e[0],0,0)}else{const o=e.map((e=>(e.width({ctx:t})||0)-0));let n=o.reduce(((t,e)=>t+e)),r=0;e.forEach(((t,e)=>{const s=o[e];n-=s,a(t,r,n),r+=s}))}}function zi(t,e){return ls(t,e||"")}function Vi(t){return function(t){return ls(void 0,t).join("")}(t)}function $i(t){return Ni(t)&&"ellipsis"!==t&&1===(t=t.trim()).length?is(t[0]):Di}function Ni(t){return Boolean(t&&"clip"!==t&&"string"==typeof t)}function Ui(t,e,o){const n=o-3;let r=0;for(let o=0;o<e.length;o++){const s=(e[o].width({ctx:t})||0)-0;if(r+s>n)return{index:o,lineWidth:r,remWidth:n-r};r+=s}return null}function ji(t,e,o){const n=Ui(t,e,o);if(!n)return{beforeInlines:e,overflow:!1,afterInlines:[]};const{index:r,remWidth:s}=n,i=e[r],l=e.slice(0,r),c=[];if(i.canBreak()){let{before:o,after:n}=i.breakWord(t,s);o||l.length||({before:o,after:n}=i.breakAll(t,s)),o||l.length||({before:o,after:n}=i.splitIndex(1)),o&&l.push(o),n&&c.push(n),c.push(...e.slice(r+1))}else l.length||l.push(i),c.push(...e.slice(l.length));return{beforeInlines:l,overflow:!0,afterInlines:c}}function Ki(t,e,o,n){const r=Ui(t,e,o);if(!r)return{inlines:e,overflow:!1};const{index:s,lineWidth:i}=r,l=e[s],c=$i(n),a=o-i-c.width({ctx:t}),h=e.slice(0,s);if(l.canBreak()){const{before:e}=l.breakAll(t,a);e&&h.push(e)}return h.push(c),{inlines:h,overflow:!0}}function Gi(t,e,o,n,r,s,{offset:i,color:l,textAlign:c,textBaseline:a,font:h,textOverflow:u,icons:d,trailingIcon:g}){e.fillStyle=Fi(l||e.fillStyle,r,s,t,e),e.textAlign=c,e.textBaseline=a,e.font=h||e.font;let f=zi(d,o);const _=g?ss(g):null;let C=n,{width:p}=n,w=0;if(_&&(w=_.width({ctx:e}),p-=w,C=new tn(n.left,n.top,p,n.height)),Ni(u)&&function(t,e,o){return!!Ui(t,e,o)}(e,f,p)){const{inlines:n,overflow:i}=Ki(e,f,p,u);f=n,t.setCellOverflowText(r,s,i&&Vi(o))}else t.setCellOverflowText(r,s,!1);if(Hi(e,f,C,i,0,0,r,s,t),_){let o=0;f.forEach((t=>{o+=t.width({ctx:e})}));const l=new tn(n.left,n.top,n.width,n.height),c=l.copy();p<o?c.left=c.right-w-i:c.left+=o,c.right=l.right,Hi(e,[_],c,i,0,0,r,s,t)}}function Yi(t,e,o){const n=Oi(t),r=Oi(e),s=t=>{const e=n[t],s=r[t];if(o>=1)return s;if(o<=0)return e;const i=e-s;return Math.ceil(e-i*o)};return`rgb(${s("r")}, ${s("g")}, ${s("b")})`}function qi(t,e,o,n,r,s,{animElapsedTime:i=1,uncheckBgColor:l=s.theme.checkbox.uncheckBgColor,checkBgColor:c=s.theme.checkbox.checkBgColor,borderColor:a=s.theme.checkbox.borderColor,textAlign:h="center",textBaseline:u="middle"},d={}){const g=js(t).width;t.textAlign=h,t.textBaseline=u;const f=ze(t,e,g+1,g+1,d);l=s.getColor(l,o,n,t),c=s.getColor(c,o,n,t),a=s.getColor(a,o,n,t),0<i&&i<1&&(l=r?l:Yi(c,l,i),c=r?Yi(l,c,i):c),Gs(t,f.x,f.y,!!r&&i,{uncheckBgColor:l,checkBgColor:c,borderColor:a})}class Xi{_grid;_checkbox=null;_radioButton=null;_button=null;_header=null;_messages=null;constructor(t){this._grid=t}getThemeColor(...t){return Pi(this._grid,...t)}get font(){return Pi(this._grid,"font")}get underlayBackgroundColor(){return Pi(this._grid,"underlayBackgroundColor")}get color(){return Pi(this._grid,"color")}get frozenRowsColor(){return Pi(this._grid,"frozenRowsColor")}get defaultBgColor(){return Pi(this._grid,"defaultBgColor")}get frozenRowsBgColor(){return Pi(this._grid,"frozenRowsBgColor")}get selectionBgColor(){return Pi(this._grid,"selectionBgColor")}get highlightBgColor(){return Pi(this._grid,"highlightBgColor")}get borderColor(){return Pi(this._grid,"borderColor")}get frozenRowsBorderColor(){return Pi(this._grid,"frozenRowsBorderColor")}get highlightBorderColor(){return Pi(this._grid,"highlightBorderColor")}get checkbox(){const t=this._grid;return this._checkbox||(this._checkbox={get uncheckBgColor(){return Pi(t,"checkbox","uncheckBgColor")},get checkBgColor(){return Pi(t,"checkbox","checkBgColor")},get borderColor(){return Pi(t,"checkbox","borderColor")}})}get radioButton(){const t=this._grid;return this._radioButton||(this._radioButton={get checkColor(){return Pi(t,"radioButton","checkColor")},get uncheckBorderColor(){return Pi(t,"radioButton","uncheckBorderColor")},get checkBorderColor(){return Pi(t,"radioButton","checkBorderColor")},get uncheckBgColor(){return Pi(t,"radioButton","uncheckBgColor")},get checkBgColor(){return Pi(t,"radioButton","checkBgColor")}})}get button(){const t=this._grid;return this._button||(this._button={get color(){return Pi(t,"button","color")},get bgColor(){return Pi(t,"button","bgColor")}})}get header(){const t=this._grid;return this._header||(this._header={get sortArrowColor(){return Pi(t,"header","sortArrowColor")}})}get messages(){const t=this._grid;return this._messages||(this._messages={get infoBgColor(){return Pi(t,"messages","infoBgColor")},get errorBgColor(){return Pi(t,"messages","errorBgColor")},get warnBgColor(){return Pi(t,"messages","warnBgColor")},get boxWidth(){return Pi(t,"messages","boxWidth")},get markHeight(){return Pi(t,"messages","markHeight")}})}}function Ji(t,e,o,n,r,s){if(Array.isArray(e)){Hs(t,Mi(e),o,n,r,s)}else e&&(t.strokeStyle=e,t.strokeRect(o,n,r,s))}class Zi{_grid;_theme;constructor(t){this._grid=t,this._theme=new Xi(t)}createCalculator(t,e){return{calcWidth:o=>Uo(o,{get full(){return t.getRect().width},get em(){return He(t.getContext(),e).width}}),calcHeight:o=>Uo(o,{get full(){return t.getRect().height},get em(){return He(t.getContext(),e).height}})}}getColor(t,e,o,n){return Fi(t,e,o,this._grid,n)}toBoxArray(t){return Mi(t)}toBoxPixelArray(t,e,o){if("string"==typeof t||Array.isArray(t)){const n=this.createCalculator(e,o),r=Mi(t);return[n.calcHeight(r[0]),n.calcWidth(r[1]),n.calcHeight(r[2]),n.calcWidth(r[3])]}return Mi(t)}get theme(){return this._theme}drawWithClip(t,e){const o=t.getDrawRect();if(!o)return;const n=t.getContext();n.save();try{n.beginPath(),n.rect(o.left,o.top,o.width,o.height),n.clip(),e(n)}finally{n.restore()}}drawBorderWithClip(t,e){const o=t.getDrawRect();if(!o)return;const n=t.getRect(),r=t.getContext();r.save();try{r.beginPath();let t=o.left,s=o.width;o.left===n.left&&(t+=-1,s+=1);let i=o.top,l=o.height;o.top===n.top&&(i+=-1,l+=1),r.rect(t,i,s,l),r.clip(),e(r)}finally{r.restore()}}text(t,e,{padding:o,offset:n=2,color:r,textAlign:s="left",textBaseline:i="middle",font:l,textOverflow:c="clip",icons:a,trailingIcon:h}={}){let u=e.getRect();const{col:d,row:g}=e;if(!r){({color:r}=this.theme);const t=this._grid.isFrozenCell(d,g);t&&t.row&&(r=this.theme.frozenRowsColor)}this.drawWithClip(e,(f=>{if(l=Wi(l,e.col,e.row,this._grid,f),o){const t=this.toBoxPixelArray(o,e,l),n=u.left+t[3],r=u.top+t[0],s=u.width-t[1]-t[3],i=u.height-t[0]-t[2];u=new tn(n,r,s,i)}Gi(this._grid,f,t,u,d,g,{offset:n,color:r,textAlign:s,textBaseline:i,font:l,textOverflow:c,icons:a,trailingIcon:h})}))}multilineText(t,e,{padding:o,offset:n=2,color:r,textAlign:s="left",textBaseline:i="middle",font:l,lineHeight:c="1em",autoWrapText:a=!1,lineClamp:h=0,textOverflow:u="clip",icons:d,trailingIcon:g}={}){let f=e.getRect();const{col:_,row:C}=e;if(!r){({color:r}=this.theme);const t=this._grid.isFrozenCell(_,C);t&&t.row&&(r=this.theme.frozenRowsColor)}this.drawWithClip(e,(p=>{if(l=Wi(l,e.col,e.row,this._grid,p),o){const t=this.toBoxPixelArray(o,e,l),n=f.left+t[3],r=f.top+t[0],s=f.width-t[1]-t[3],i=f.height-t[0]-t[2];f=new tn(n,r,s,i)}const w=this.createCalculator(e,l);c=w.calcHeight(c),function(t,e,o,n,r,s,{offset:i,color:l,textAlign:c,textBaseline:a,font:h,lineHeight:u,autoWrapText:d,lineClamp:g,textOverflow:f,icons:_,trailingIcon:C}){if(e.fillStyle=Fi(l||e.fillStyle,r,s,t,e),e.textAlign=c,e.textBaseline=a,e.font=h||e.font,"auto"===g){const t=n.height-2*i-2;g=Math.max(Math.floor(t/u),1)}const p=C?ss(C):null;let w,{width:m}=n,y=0;if(p&&(y=p.width({ctx:e}),m-=y),d||g>0||Ni(f)){w=[];const n=g>0?(n,i)=>{if(w.length+1>=g){if(0===n.length&&i)w.push([$i(f)]),t.setCellOverflowText(r,s,o.map(Vi).join("\n"));else{const{inlines:l,overflow:c}=Ki(e,n,m,f);w.push(i&&!c?l.concat([$i(f)]):l),(c||i)&&t.setCellOverflowText(r,s,o.map(Vi).join("\n"))}return!1}return!0}:()=>!0,i=d?(t,o)=>{if(!n(t,o))return!1;for(;t.length;){if(!n(t,o))return!1;const{beforeInlines:r,afterInlines:s}=ji(e,t,m);w.push(r),t=s}return!0}:Ni(f)?(i,l)=>{if(!n(i,l))return!1;const{inlines:c,overflow:a}=Ki(e,i,m,f);return w.push(c),a&&t.setCellOverflowText(r,s,o.map(Vi).join("\n")),!0}:(t,e)=>!!n(t,e)&&(w.push(t),!0);t.setCellOverflowText(r,s,!1);for(let t=0;t<o.length;t++){const e=o[t];if(!i(zi(0===t?_:void 0,e),t+1<o.length))break}}else t.setCellOverflowText(r,s,!1),w=o.map(((t,e)=>zi(0===e?_:void 0,t)));let b=0,x=u*(w.length-1);if("top"===e.textBaseline||"hanging"===e.textBaseline){const t=He(e,e.font).height,o=(u-t)/2;b+=o,x-=o}else if("bottom"===e.textBaseline||"alphabetic"===e.textBaseline||"ideographic"===e.textBaseline){const t=He(e,e.font).height,o=(u-t)/2;b-=o,x+=o}if(w.forEach((o=>{Hi(e,o,n,i,b,x,r,s,t),b+=u,x-=u})),p){let o=0;w.forEach((t=>{let n=0;t.forEach((t=>{n+=t.width({ctx:e})})),o=Math.max(o,n)}));const l=new tn(n.left,n.top,n.width,n.height),c=l.copy();m<o?c.left=c.right-y-i:c.left+=o,c.right=l.right,Hi(e,[p],c,i,0,0,r,s,t)}}(this._grid,p,t,f,_,C,{offset:n,color:r,textAlign:s,textBaseline:i,font:l,lineHeight:c,autoWrapText:a,lineClamp:h,textOverflow:u,icons:d,trailingIcon:g})}))}fillText(t,e,o,n,{color:r,textAlign:s="left",textBaseline:i="top",font:l}={}){const{col:c,row:a}=n;if(!r){({color:r}=this.theme);const t=this._grid.isFrozenCell(c,a);t&&t.row&&(r=this.theme.frozenRowsColor)}const h=n.getContext();h.save();try{l=Wi(l,n.col,n.row,this._grid,h),h.fillStyle=Fi(r,c,a,this._grid,h),h.textAlign=s,h.textBaseline=i,h.font=l||h.font,h.fillText(t,e,o)}finally{h.restore()}}fillCell(t,{fillColor:e=this.theme.defaultBgColor}={}){const o=t.getRect();this.drawWithClip(t,(n=>{const{col:r,row:s}=t;n.fillStyle=Fi(e,r,s,this._grid,n),n.beginPath(),n.rect(o.left,o.top,o.width,o.height),n.fill()}))}fillCellWithState(t,e={}){e.fillColor=this.getFillColorState(t,e),this.fillCell(t,e)}fillRect(t,e,{fillColor:o=this.theme.defaultBgColor}={}){const n=e.getContext();n.save();try{const{col:r,row:s}=e;n.fillStyle=Fi(o,r,s,this._grid,n),n.beginPath(),n.rect(t.left,t.top,t.width,t.height),n.fill()}finally{n.restore()}}fillRectWithState(t,e,o={}){o.fillColor=this.getFillColorState(e,o),this.fillRect(t,e,o)}getFillColorState(t,e={}){const o=t.getSelection(),{col:n,row:r}=t;if(!w(o.select,t)&&m(o.range,n,r))return this.theme.selectionBgColor;if(e.fillColor)return e.fillColor;if(w(o.select,t))return this.theme.highlightBgColor;const s=this._grid.isFrozenCell(n,r);return s&&s.row?this.theme.frozenRowsBgColor:this.theme.defaultBgColor}border(t,{borderColor:e=this.theme.borderColor,lineWidth:o=1}={}){const n=t.getRect();this.drawBorderWithClip(t,(r=>{const{col:s,row:i}=t,l=Fi(e,s,i,this._grid,r);if(1===o)r.lineWidth=1,Ji(r,l,n.left-.5,n.top-.5,n.width,n.height);else if(2===o)r.lineWidth=2,Ji(r,l,n.left,n.top,n.width-1,n.height-1);else{r.lineWidth=o;const t=o/2-1;Ji(r,l,n.left+t,n.top+t,n.width-o+1,n.height-o+1)}}))}borderWithState(t,e={}){const o=t.getRect(),n=t.getSelection(),{col:r,row:s}=t;if(w(n.select,t))e.borderColor=this.theme.highlightBorderColor,e.lineWidth=2,this.border(t,e);else{this._grid.isFrozenCell(r,s)?.row&&(e.borderColor=this.theme.frozenRowsBorderColor),e.lineWidth=1,this.border(t,e);const n=this._grid.selection.select;n.col+1===r&&n.row===s?this.drawBorderWithClip(t,(t=>{const e=Mi(Fi(this.theme.highlightBorderColor,n.col,n.row,this._grid,t));t.lineWidth=1,t.strokeStyle=e[1]||t.strokeStyle,t.beginPath(),t.moveTo(o.left-.5,o.top),t.lineTo(o.left-.5,o.bottom),t.stroke()})):n.col===r&&n.row+1===s&&this.drawBorderWithClip(t,(t=>{const e=Mi(Fi(this.theme.highlightBorderColor,n.col,n.row,this._grid,t));t.lineWidth=1,t.strokeStyle=e[0]||t.strokeStyle,t.beginPath(),t.moveTo(o.left,o.top-.5),t.lineTo(o.right,o.top-.5),t.stroke()}))}}buildCheckBoxInline(t,e,o={}){const n=this,r=js(e.getContext()).width;return new Yr({draw:function({ctx:r,rect:s,offset:i,offsetLeft:l,offsetRight:c,offsetTop:a,offsetBottom:h}){const{col:u,row:d}=e;qi(r,s,u,d,t,n,o,{offset:i+1,padding:{left:l+1,right:c,top:a,bottom:h}})},width:r+3,height:r+1,color:void 0})}checkbox(t,e,{animElapsedTime:o,offset:n=3,uncheckBgColor:r,checkBgColor:s,borderColor:i,textAlign:l,textBaseline:c}={}){this.drawWithClip(e,(a=>{const{col:h,row:u}=e;qi(a,e.getRect(),h,u,t,this,{animElapsedTime:o,uncheckBgColor:r,checkBgColor:s,borderColor:i,textAlign:l,textBaseline:c},{offset:n,padding:{left:1}})}))}radioButton(t,e,{animElapsedTime:o,offset:n=3,checkColor:r,uncheckBorderColor:s,checkBorderColor:i,uncheckBgColor:l,checkBgColor:c,textAlign:a,textBaseline:h}={}){this.drawWithClip(e,(u=>{const{col:d,row:g}=e;!function(t,e,o,n,r,s,{animElapsedTime:i=1,checkColor:l=s.theme.radioButton.checkColor,uncheckBorderColor:c=s.theme.radioButton.uncheckBorderColor,checkBorderColor:a=s.theme.radioButton.checkBorderColor,uncheckBgColor:h=s.theme.radioButton.uncheckBgColor,checkBgColor:u=s.theme.radioButton.checkBgColor,textAlign:d="center",textBaseline:g="middle"},f={}){const _=Ks(t).width;t.textAlign=d,t.textBaseline=g;const C=ze(t,e,_+1,_+1,f);l=s.getColor(l,o,n,t),c=s.getColor(c,o,n,t),a=s.getColor(a,o,n,t),h=s.getColor(h,o,n,t),u=s.getColor(u,o,n,t);let p=r?a:c,w=r?u:h;0<i&&i<1&&(p=r?Yi(c,a,i):Yi(a,c,i),w=r?Yi(h,u,i):Yi(u,h,i)),Ys(t,C.x,C.y,r?i:1-i,{checkColor:l,borderColor:p,bgColor:w})}(u,e.getRect(),d,g,t,this,{animElapsedTime:o,checkColor:r,uncheckBorderColor:s,checkBorderColor:i,uncheckBgColor:l,checkBgColor:c,textAlign:a,textBaseline:h},{offset:n,padding:{left:1}})}))}button(t,e,{bgColor:o=this.theme.button.bgColor,padding:n,offset:r=2,color:s=this.theme.button.color,textAlign:i="center",textBaseline:l="middle",shadow:c,font:a,textOverflow:h="clip",icons:u}={}){const d=e.getRect();this.drawWithClip(e,(g=>{a=Wi(a,e.col,e.row,this._grid,g);const{col:f,row:_}=e,C=this.toBoxPixelArray(n||d.height/8,e,a),p=d.left+C[3],w=d.top+C[0],m=d.width-C[1]-C[3],y=d.height-C[0]-C[2];qs(g,p,w,m,y,{bgColor:o=Fi(o,e.col,e.row,this._grid,g),radius:d.height/8,shadow:c}),Gi(this._grid,g,t,new tn(p,w,m,y),f,_,{offset:r,color:s,textAlign:i,textBaseline:l,font:a,textOverflow:h,icons:u})}))}testFontLoad(t,e,o){return function(t,e,o,n){return!(t&&!Jr(t,e)&&(Xr(t,e,(()=>function(t,e){const{col:o,row:n}=t;e.invalidateCell(o,n)}(o,n))),1))}(t,e,o,this._grid)}}class Qi{_grid;_tooltipElement;constructor(t){this._grid=t}dispose(){this.detachTooltipElement(),this._tooltipElement&&this._tooltipElement.dispose(),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement?this._tooltipElement:this._tooltipElement=this.createTooltipElementInternal()}attachTooltipElement(t,e,o){this._getTooltipElement().attach(this._grid,t,e,o)}moveTooltipElement(t,e){this._getTooltipElement().move(this._grid,t,e)}detachTooltipElement(){this._getTooltipElement()._detach()}}const tl="cheetah-grid__tooltip-element",el=`${tl}__content`,ol=`${tl}--hidden`,nl=`${tl}--shown`;class rl{_handler;_rootElement;_messageElement;constructor(){this._handler=new nt;const t=this._rootElement=function(){require("@/tooltip/internal/TooltipElement.css");const t=rt("div",{classList:[tl,ol]}),e=rt("pre",{classList:[el]});return t.appendChild(e),t}();this._messageElement=t.querySelector(`.${el}`)}dispose(){this.detach();const t=this._rootElement;t.parentElement&&t.parentElement.removeChild(t),this._handler.dispose(),delete this._rootElement,delete this._messageElement}attach(t,e,o,n){const r=this._rootElement,s=this._messageElement;r.classList.remove(nl),r.classList.add(ol),this._attachCell(t,e,o)?(r.classList.add(nl),r.classList.remove(ol),s.textContent=n):this._detach()}move(t,e,o){const n=this._rootElement;this._attachCell(t,e,o)?(n.classList.add(nl),n.classList.remove(ol)):this._detach()}detach(){this._detach()}_detach(){const t=this._rootElement;t.parentElement&&(t.classList.remove(nl),t.classList.add(ol))}_attachCell(t,e,o){const n=this._rootElement,{element:r,rect:s}=t.getAttachCellsArea(t.getCellRange(e,o)),{bottom:i,left:l,width:c}=s,{frozenRowCount:a,frozenColCount:h}=t;if(o>=a&&a>0){const{rect:o}=t.getAttachCellsArea(t.getCellRange(e,a-1));if(i<o.bottom)return!1}else if(i<0)return!1;if(e>=h&&h>0){const{rect:e}=t.getAttachCellsArea(t.getCellRange(h-1,o));if(l<e.right)return!1}else if(l<0)return!1;const{height:u,width:d,left:g,right:f}=r.getBoundingClientRect();if(u<i)return!1;if(d<l)return!1;const _=l+c/2;n.style.top=`${i.toFixed()}px`,n.style.left=`${_.toFixed()}px`,n.style.minWidth=`${c.toFixed()}px`;const C=2*(g+_),p=2*(d-_+(window.innerWidth-f)),w=Math.min(C,p);return n.style.maxWidth=`${w.toFixed()}px`,n.parentElement!==r&&r.appendChild(n),!0}}class sl extends Qi{createTooltipElementInternal(){return new rl}}const il={"overflow-text":t=>new sl(t)};class ll{_grid;_tooltipInstances;_attachInfo;constructor(t){this._grid=t,this._tooltipInstances={},this._bindGridEvent(t)}dispose(){const t=this._tooltipInstances;for(const e in t)t[e].dispose();delete this._tooltipInstances,this._attachInfo=null}_attach(t,e){const o=this._attachInfo,n=this._getTooltipInstanceInfo(t,e);if(!o||n&&o.instance===n.instance||(o.instance.detachTooltipElement(),this._attachInfo=null),!n)return;const{instance:r}=n;r.attachTooltipElement(t,e,n.content);const s=this._grid.getCellRange(t,e);this._attachInfo={range:s,instance:r}}_move(t,e){const o=this._attachInfo;if(!o||!m(o.range,t,e))return;const{instance:n}=o;n.moveTooltipElement(t,e)}_detach(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e.detachTooltipElement(),this._attachInfo=null}_isAttachCell(t,e){const o=this._attachInfo;return!!o&&m(o.range,t,e)}_bindGridEvent(t){t.listen(pi.MOUSEOVER_CELL,(t=>{t.related&&this._isAttachCell(t.col,t.row)||this._attach(t.col,t.row)})),t.listen(pi.MOUSEOUT_CELL,(t=>{t.related&&this._isAttachCell(t.related.col,t.related.row)||this._detach()})),t.listen(pi.SELECTED_CELL,(t=>{this._isAttachCell(t.col,t.row)&&this._detach()})),t.listen(pi.SCROLL,(()=>{const t=this._attachInfo;t&&this._move(t.range.start.col,t.range.start.row)})),t.listen(pi.CHANGED_VALUE,(t=>{this._isAttachCell(t.col,t.row)&&(this._detach(),this._attach(t.col,t.row))}))}_getTooltipInstanceInfo(t,e){const o=this._grid,n=this._tooltipInstances,r=function(t,e,o){const n=t.getCellOverflowText(e,o);return n?{type:"overflow-text",content:n}:null}(o,t,e);if(!r)return null;const{type:s}=r;return{instance:n[s]||(n[s]=il[s](o)),type:s,content:r.content}}}const cl=z();function al(t,e,o){return t[cl].layoutMap.getCellRange(e,o)}function hl(t,e,o,n){n.setRectFilter((n=>{let{left:r,right:s,top:i,bottom:l}=n;const{start:{col:c,row:a},end:{col:h,row:u}}=al(t,e,o);for(let o=e-1;o>=c;o--)r-=t.getColWidth(o);for(let o=e+1;o<=h;o++)s+=t.getColWidth(o);for(let e=o-1;e>=a;e--)i-=t.getRowHeight(e);for(let e=o+1;e<=u;e++)l+=t.getRowHeight(e);return tn.bounds(r,i,s,l)}))}function ul(t,e,o){if(o<t[cl].layoutMap.headerRowCount){const{caption:n}=t[cl].layoutMap.getHeader(e,o);return"function"==typeof n?n():n}{const{field:n}=t[cl].layoutMap.getBody(e,o);return fl(t,n,o)}}function dl(t,e,o){if(o<t[cl].layoutMap.headerRowCount)return null;{const{message:n}=t[cl].layoutMap.getBody(e,o);if(!n)return null;if(!Array.isArray(n))return fl(t,n,o);const r=[];for(let e=0;e<n.length;e++){const s=fl(t,n[e],o);if(C(s))r.push(s);else if(Li(s))return s}return r.length?new Promise(((t,e)=>{r.forEach((o=>{o.then((e=>{Li(e)&&t(e)}),e)}))})):null}}function gl(t,e,o){if(Array.isArray(e))return e.map((e=>gl(t,e,o)));if(!v.isObject(e)||"function"==typeof e)return fl(t,e,o);const n={},r=e;return Ie.forEach((e=>{if(r[e]){const s=fl(t,r[e],o);null!=s?n[e]=s:function(t,e,o){if(null==e)return!1;if(o<t[cl].layoutMap.headerRowCount)return!1;{const n=bl(t,o);return t[cl].dataSource.hasField(n,e)}}(t,r[e],o)||(n[e]=r[e])}})),n}function fl(t,e,o){if(null==e)return null;if(o<t[cl].layoutMap.headerRowCount)return null;{const n=bl(t,o);return t[cl].dataSource.getField(n,e)}}function _l(t,e,o,{col:n,row:r},s,i){const l=t[cl].gridCanvasHelper,c=({bgColor:t}={})=>{const e={fillColor:t};l.fillCellWithState(o,e)},a=()=>{if(o.col===t.frozenColCount-1){const e=o.getRect();l.drawWithClip(o,(n=>{const r=o.row>=t.frozenRowCount?l.theme.borderColor:l.theme.frozenRowsBorderColor,s=l.toBoxArray(l.getColor(r,o.col,o.row,n));s[1]&&(n.lineWidth=1,n.strokeStyle=s[1],n.beginPath(),n.moveTo(e.right-2.5,e.top),n.lineTo(e.right-2.5,e.bottom),n.stroke())}))}!function(t,e,o){const{col:n,row:r}=o,s=t.selection.select,{layoutMap:i}=t[cl],l=o.getRect(),c={},a=i.getRecordIndexByRow(s.row),h=i.getCellId(s.col,s.row);function u(t,e){return t===s.col&&e===s.row||null!=h&&i.getCellId(t,e)===h&&i.getRecordIndexByRow(e)===a}if(u(n,r))c.borderColor=e.theme.highlightBorderColor,c.lineWidth=2,e.border(o,c);else{c.lineWidth=1;t.isFrozenCell(n,r)?.row&&(c.borderColor=e.theme.frozenRowsBorderColor),e.border(o,c),n>0&&u(n-1,r)?e.drawBorderWithClip(o,(t=>{const o=e.toBoxArray(e.getColor(e.theme.highlightBorderColor,s.col,s.row,t));o[1]&&(t.lineWidth=1,t.strokeStyle=o[1],t.beginPath(),t.moveTo(l.left-.5,l.top),t.lineTo(l.left-.5,l.bottom),t.stroke())})):r>0&&u(n,r-1)&&e.drawBorderWithClip(o,(t=>{const o=e.toBoxArray(e.getColor(e.theme.highlightBorderColor,s.col,s.row,t));o[0]&&(t.lineWidth=1,t.strokeStyle=o[0],t.beginPath(),t.moveTo(l.left,l.top-.5),t.lineTo(l.right,l.top-.5),t.stroke())}))}}(t,l,o)},h={getRecord:()=>t.getRowRecord(r),getIcon:()=>function(t,e,o){if(o<t[cl].layoutMap.headerRowCount){const{headerIcon:n}=t[cl].layoutMap.getHeader(e,o);return null==n?null:n}{const{icon:n}=t[cl].layoutMap.getBody(e,o);return null==n?null:gl(t,n,o)}}(t,n,r),getMessage:()=>dl(t,n,r),messageHandler:t[cl].messageHandler,style:s,drawCellBase:({bgColor:t}={})=>{c({bgColor:t}),a()},drawCellBg:c,drawCellBorder:a};return i(e,h,o,t)}function Cl(t){const e=t[cl];e.headerEvents&&e.headerEvents.forEach((e=>t.unlisten(e)));const o=t[cl].headerEvents=[];let n;o.forEach((e=>t.unlisten(e))),n=e.layout&&(!Array.isArray(e.layout)||e.layout.length>0)?e.layoutMap=new ri(e.layout):e.layoutMap=new ei(e.header??[]),n.headerObjects.forEach((e=>{const n=e.headerType.bindGridEvent(t,e.id);if(o.push(...n),e.style&&e.style instanceof Ar){const n=e.style.listen(Ar.EVENT_TYPE.CHANGE_STYLE,(()=>{t.invalidate()}));o.push(n)}if(e.action){const n=e.action.bindGridEvent(t,e.id);o.push(...n)}})),n.columnObjects.forEach((e=>{if(e.action){const n=e.action.bindGridEvent(t,e.id);o.push(...n)}if(e.columnType){const n=e.columnType.bindGridEvent(t,e.id);o.push(...n)}if(e.style&&e.style instanceof Ut){const n=e.style.listen(Ut.EVENT_TYPE.CHANGE_STYLE,(()=>{t.invalidate()}));o.push(n)}}));for(let e=0;e<n.columnWidths.length;e++){const o=n.columnWidths[e],{width:r,minWidth:s,maxWidth:i}=o;r&&(r>0||"string"==typeof r)?t.setColWidth(e,r):t.setColWidth(e,null),s&&(s>0||"string"==typeof s)?t.setMinColWidth(e,s):t.setMinColWidth(e,null),i&&(i>0||"string"==typeof i)?t.setMaxColWidth(e,i):t.setMaxColWidth(e,null)}const{headerRowHeight:r}=t[cl];for(let e=0;e<n.headerRowCount;e++){const o=Array.isArray(r)?r[e]:r;o&&o>0?t.setRowHeight(e,o):t.setRowHeight(e,null)}t.colCount=n.colCount,pl(t),t.frozenRowCount=n.headerRowCount}function pl(t){const{layoutMap:e}=t[cl];t.rowCount=t[cl].dataSource.length*e.bodyRowCount+e.headerRowCount}function wl(t,e){const{dataSourceEventIds:o}=t[cl];o&&o.forEach((e=>t[cl].handler.off(e))),e(t),t[cl].dataSourceEventIds=[t[cl].handler.on(t[cl].dataSource,ar.EVENT_TYPE.UPDATED_LENGTH,(()=>{pl(t),t.invalidate()})),t[cl].handler.on(t[cl].dataSource,ar.EVENT_TYPE.UPDATED_ORDER,(()=>{t.invalidate()}))]}function ml(t,e=[]){wl(t,(()=>{t[cl].records=e;const o=t[cl].dataSource=hr.ofArray(e);t.addDisposable(o)}))}function yl(t,e){wl(t,(()=>{if(e)if(e instanceof ar)t[cl].dataSource=e;else{const o=t[cl].dataSource=new hr(e);t.addDisposable(o)}else t[cl].dataSource=ar.EMPTY;t[cl].records=null}))}function bl(t,e){const{layoutMap:o}=t[cl];return o.getRecordIndexByRow(e)}function xl(t,e=(()=>!0)){const{layoutMap:o}=this[cl],n=this.selection.range,{start:r}=this.getCellRange(n.start.col,n.start.row),{end:s}=this.getCellRange(n.end.col,n.end.row),i=Zo(t,{trimOnPaste:this.trimOnPaste}),l=Math.min(Math.max(s.row-r.row+1,i.rowCount),this.rowCount-r.row),c=Math.min(Math.max(s.col-r.col+1,i.colCount),this.colCount-r.col);let a=!1;const h=[];for(let t=0;t<o.bodyRowCount;t++){const e=[];h.push(e);for(let n=0;n<c;n++){const s=o.getBody(r.col+n,t+o.headerRowCount);e[n]=s,!a&&s.action?.editable&&(a=!0)}}if(!a)return;const u=o.getRecordStartRowByRecordIndex(o.getRecordIndexByRow(r.row)),d=r.row-u;let g=[];const f=(t,e,o,n)=>{g.push({col:t.col,row:t.row,record:e,define:o,pasteValue:n})};let _=null;const C=()=>{_&&clearTimeout(_),_=setTimeout((()=>{g.length>0&&(this.fireListeners(pi.REJECTED_PASTE_VALUES,{detail:g}),g=[])}),100)};let w=f,m={},y=d,b=0;for(let t=0;t<l;t++){let n=0;for(let o=0;o<c;o++){const{action:s,id:l,define:c}=h[y][o];if(!m[l]&&s?.editable){m[l]=!0;const a=r.col+o,h=r.row+t,u=i.getCellValue(n,b);p(this.getRowRecord(h),(t=>{p(ul(this,a,h),(o=>{e({grid:this,record:t,col:a,row:h,value:u,oldValue:o})&&s.onPasteCellRangeBox(this,{col:a,row:h},u,{reject(){w({col:a,row:h},t,c,u)}})}))}))}n++,n>=i.colCount&&(n=0)}y++,y>=o.bodyRowCount&&(y=0,m={}),b++,b>=i.rowCount&&(b=0)}const x={col:r.col+c-1,row:r.row+l-1};this.selection.range={start:r,end:x},this.invalidateCellRange(this.selection.range),C(),w=(t,e,o,n)=>{f(t,e,o,n),C()}}function vl(){const{layoutMap:t}=this[cl],e=this.selection.range,{start:o}=this.getCellRange(e.start.col,e.start.row),{end:n}=this.getCellRange(e.end.col,e.end.row),r=Math.min(n.row-o.row+1,this.rowCount-o.row),s=Math.min(n.col-o.col+1,this.colCount-o.col);let i=!1;const l=[];for(let e=0;e<t.bodyRowCount;e++){const n=[];l.push(n);for(let r=0;r<s;r++){const s=t.getBody(o.col+r,e+t.headerRowCount);n[r]=s,!i&&s.action?.editable&&(i=!0)}}if(!i)return;const c=t.getRecordStartRowByRecordIndex(t.getRecordIndexByRow(o.row));let a={},h=o.row-c;for(let e=0;e<r;e++){for(let t=0;t<s;t++){const{action:n,id:r}=l[h][t];if(!a[r]&&n?.editable){a[r]=!0;const s=o.col+t,i=o.row+e;p(this.getRowRecord(i),(t=>{p(ul(this,s,i),(t=>{n.onDeleteCellRangeBox(this,{col:s,row:i})}))}))}}h++,h>=t.bodyRowCount&&(h=0,a={})}this.invalidateCellRange(e)}class El extends Qn{[cl];disabled=!1;readOnly=!1;static get EVENT_TYPE(){return pi}constructor(t={}){super(function(t,e){const o={};for(const n in t)e.indexOf(n)>=0||Object.defineProperty(o,n,{get:()=>t[n],set(e){t[n]=e},configurable:!0,enumerable:!0});return o}(t,["colCount","rowCount","frozenRowCount"]));const e=this[cl];e.header=t.header||[],e.layout=t.layout||[],e.headerRowHeight=t.headerRowHeight||[],t.dataSource?yl(this,t.dataSource):ml(this,t.records),e.allowRangePaste=t.allowRangePaste??!1,Cl(this),e.sortState={col:-1,row:-1,order:void 0},e.gridCanvasHelper=new Zi(this),e.theme=As(t.theme),e.messageHandler=new Ri(this,((t,e)=>dl(this,t,e))),e.tooltipHandler=new ll(this),this.invalidate(),e.handler.on(window,"resize",(()=>{this.updateSize(),this.updateScroll(),this.invalidate()}))}dispose(){const t=this[cl];t.messageHandler.dispose(),t.tooltipHandler.dispose(),super.dispose()}get header(){return this[cl].header}set header(t){this[cl].header=t,Cl(this)}get layout(){return this[cl].layout}set layout(t){this[cl].layout=t,Cl(this)}get recordRowCount(){return this[cl].layoutMap.bodyRowCount}get records(){return this[cl].records||null}set records(t){null!=t&&(ml(this,t),pl(this),this.invalidate())}get dataSource(){return this[cl].dataSource}set dataSource(t){yl(this,t),pl(this),this.invalidate()}get theme(){return this[cl].theme}set theme(t){this[cl].theme=As(t),this.invalidate()}get allowRangePaste(){return this[cl].allowRangePaste}set allowRangePaste(t){this[cl].allowRangePaste=t}get font(){return super.font||this[cl].gridCanvasHelper.theme.font}set font(t){super.font=t}get underlayBackgroundColor(){return super.underlayBackgroundColor||this[cl].gridCanvasHelper.theme.underlayBackgroundColor}set underlayBackgroundColor(t){super.underlayBackgroundColor=t}get sortState(){return this[cl].sortState}set sortState(t){const e=this.sortState;let o;e.col>=0&&e.row>=0&&(o=this.getHeaderField(e.col,e.row));const n=this[cl].sortState=null!=t?t:{col:-1,row:-1,order:void 0};let r;n.col>=0&&n.row>=0&&(r=this.getHeaderField(n.col,n.row)),null!=o&&o!==r&&this.setHeaderValue(e.col,e.row,void 0),null!=r&&this.setHeaderValue(n.col,n.row,n.order)}get headerValues(){return this[cl].headerValues||(this[cl].headerValues=new Map)}set headerValues(t){this[cl].headerValues=t||new Map}getField(t,e){return this[cl].layoutMap.getBody(t,e??this[cl].layoutMap.headerRowCount).field}getColumnDefine(t,e){return this[cl].layoutMap.getBody(t,e??this[cl].layoutMap.headerRowCount).define}getColumnType(t,e){return this[cl].layoutMap.getBody(t,e).columnType}getHeaderField(t,e){return this[cl].layoutMap.getHeader(t,e).field}getHeaderDefine(t,e){return this[cl].layoutMap.getHeader(t,e).define}getRowRecord(t){return t<this[cl].layoutMap.headerRowCount?void 0:this[cl].dataSource.get(bl(this,t))}getRecordIndexByRow(t){return bl(this,t)}getRecordStartRowByRecordIndex(t){return this[cl].layoutMap.getRecordStartRowByRecordIndex(t)}getColumnIndexByField(t){return this.getCellRangeByField(t,0)?.start.col??null}getCellRangeByField(t,e){const{layoutMap:o}=this[cl],n=o.columnObjects.find((e=>e.field===t));if(n){const t=o.getBodyLayoutRangeById(n.id),r=o.getRecordStartRowByRecordIndex(e);return{start:{col:t.start.col,row:r+t.start.row},end:{col:t.end.col,row:r+t.end.row}}}return null}focusGridCell(t,e){const{start:{col:o,row:n},end:{col:r,row:s}}=this.selection.range,i=this.getCellRangeByField(t,e)?.start;null!=i&&(this.focusCell(i.col,i.row),this.selection.select=i,this.invalidateGridRect(o,n,r,s),this.invalidateCell(i.col,i.row))}makeVisibleGridCell(t,e){const o=this.getCellRangeByField(t,e)?.start;this.makeVisibleCell(o?.col??0,o?.row??this[cl].layoutMap.headerRowCount)}getGridCanvasHelper(){return this[cl].gridCanvasHelper}getCellRange(t,e){return al(this,t,e)}getHeaderCellRange(t,e){return this.getCellRange(t,e)}getCopyCellValue(t,e,o){const n=al(this,t,e),r=o?Math.max(o.start.col,n.start.col):n.start.col,s=o?Math.max(o.start.row,n.start.row):n.start.row;if(r!==t||s!==e)return"";const i=ul(this,t,e);if(e<this[cl].layoutMap.headerRowCount){return this[cl].layoutMap.getHeader(t,e).headerType.getCopyCellValue(i,this,{col:t,row:e})}return this[cl].layoutMap.getBody(t,e).columnType.getCopyCellValue(i,this,{col:t,row:e})}onDrawCell(t,e,o){const{layoutMap:n}=this[cl];let r,s;if(e<n.headerRowCount){const i=n.getHeader(t,e);r=i.headerType.onDrawCell,({style:s}=i),hl(this,t,e,o)}else{const i=n.getBody(t,e);r=i.columnType.onDrawCell,({style:s}=i),hl(this,t,e,o)}const i=ul(this,t,e);if(!(this.rowCount<=e))return _l(this,i,o,{col:t,row:e},s,r)}doGetCellValue(t,e,o){if(e<this[cl].layoutMap.headerRowCount)return!1;{const n=ul(this,t,e);if(C(n))return!1;o(n)}return!0}doChangeValue(t,e,o){if(e<this[cl].layoutMap.headerRowCount)return!1;{const n=this.getRowRecord(e);if(C(n))return!1;const r=ul(this,t,e);if(C(r))return!1;const s=o(r);return void 0!==s&&p(function(t,e,o,n){if(o<t[cl].layoutMap.headerRowCount)return!1;{const{field:r}=t[cl].layoutMap.getBody(e,o);if(null==r)return!1;const s=bl(t,o);return t[cl].dataSource.setField(s,r,n)}}(this,t,e,s),(o=>{if(o){const{field:o}=this[cl].layoutMap.getBody(t,e);this.fireListeners(pi.CHANGED_VALUE,{col:t,row:e,record:n,field:o,value:s,oldValue:r})}return o}))}}doSetPasteValue(t,e){xl.call(this,t,e)}getHeaderValue(t,e){const o=this.getHeaderField(t,e);return this.headerValues.get(o)}setHeaderValue(t,e,o){const n=this.getHeaderField(t,e),r=this.headerValues.get(n);this.headerValues.set(n,o),this.fireListeners(pi.CHANGED_HEADER_VALUE,{col:t,row:e,field:n,value:o,oldValue:r})}getLayoutCellId(t,e){return this[cl].layoutMap.getCellId(t,e)}bindEventsInternal(){const t=this;t.listen(pi.SELECTED_CELL,(t=>{const e=al(this,t.col,t.row),{start:{col:o,row:n},end:{col:r,row:s}}=e;o===r&&n===s||this.invalidateCellRange(e)})),t.listen(pi.PASTE_CELL,(t=>{if(!this[cl].allowRangePaste)return;const{start:e,end:o}=this.selection.range;if(!t.multi&&w(e,o))return;const{layoutMap:n}=this[cl];e.row<n.headerRowCount||(L.cancel(t.event),xl.call(this,t.normalizeValue))})),t.listen(pi.DELETE_CELL,(t=>{const{start:e}=this.selection.range,{layoutMap:o}=this[cl];e.row<o.headerRowCount||(L.cancel(t.event),vl.call(this))}))}getMoveLeftColByKeyDownInternal({col:t,row:e}){const{start:{col:o}}=al(this,t,e);return t=o,super.getMoveLeftColByKeyDownInternal({col:t,row:e})}getMoveRightColByKeyDownInternal({col:t,row:e}){const{end:{col:o}}=al(this,t,e);return t=o,super.getMoveRightColByKeyDownInternal({col:t,row:e})}getMoveUpRowByKeyDownInternal({col:t,row:e}){const{start:{row:o}}=al(this,t,e);return e=o,super.getMoveUpRowByKeyDownInternal({col:t,row:e})}getMoveDownRowByKeyDownInternal({col:t,row:e}){const{end:{row:o}}=al(this,t,e);return e=o,super.getMoveDownRowByKeyDownInternal({col:t,row:e})}getOffsetInvalidateCells(){return 1}getCopyRangeInternal(t){const{start:e}=this.getCellRange(t.start.col,t.start.row),{end:o}=this.getCellRange(t.end.col,t.end.row);return{start:e,end:o}}fireListeners(t,...e){return super.fireListeners(t,...e)}}function Ll(){return Nr()}var Rl={core:tr,tools:Js,ListGrid:El,columns:Oo,headers:ps,themes:Fs,data:gr,GridCanvasHelper:Zi,register:ys,get icons(){return Ll()}};Object.defineProperty(Fs,"default",{enumerable:!1,configurable:!0,get:()=>Os(),set(t){Ms(t)}}),Object.defineProperty(Fs,"choices",{enumerable:!1,configurable:!0,get:()=>Ds()}),exports.GridCanvasHelper=Zi,exports.ListGrid=El,exports._getInternal=function(){return console.warn("use internal!!"),{color:require("./internal/color"),sort:require("./internal/sort"),calc:require("./internal/calc"),symbolManager:require("./internal/symbolManager"),path2DManager:require("./internal/path2DManager"),pasteUtils:require("./internal/paste-utils")}},exports.columns=Oo,exports.core=tr,exports.data=gr,exports.default=Rl,exports.getIcons=Ll,exports.headers=ps,exports.register=ys,exports.themes=Fs,exports.tools=Js;
